### <a name="cspparametersparentwindowhandle-now-expects-hwnd-value"></a><span data-ttu-id="ab996-101">CspParameters.ParentWindowHandle 現在預期有 HWND 值</span><span class="sxs-lookup"><span data-stu-id="ab996-101">CspParameters.ParentWindowHandle now expects HWND value</span></span>

|   |   |
|---|---|
|<span data-ttu-id="ab996-102">詳細資料</span><span class="sxs-lookup"><span data-stu-id="ab996-102">Details</span></span>|<span data-ttu-id="ab996-103">.NET Framework 2.0 中引進的 <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> 值，可讓應用程式註冊父視窗控制代碼值，因而存取金鑰所需的任何 UI (如 PIN 提示或同意對話方塊) 在指定的視窗會開啟為強制回應子項。從以 .NET Framework 4.7 為目標的應用程式開始，Windows Forms 應用程式可以使用如下的程式碼設定 <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> 屬性：</span><span class="sxs-lookup"><span data-stu-id="ab996-103">The <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> value, introduced in .NET Framework 2.0, allows an application to register a parent window handle value such that any UI required to access the key (such as a PIN prompt or consent dialog) opens as a modal child to the specified window.Starting with apps that target the .NET Framework 4.7, a Windows Forms application can set the <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle> property with code like the following:</span></span><pre><code class="lang-csharp">cspParameters.ParentWindowHandle = form.Handle;&#13;&#10;</code></pre><span data-ttu-id="ab996-104">在舊版 .NET Framework 中，值必須為 <xref:System.IntPtr?displayProperty=name>，代表存放 [HWND](https://msdn.microsoft.com/library/windows/desktop/aa383751.aspx#HWND) 值之記憶體中的位置。</span><span class="sxs-lookup"><span data-stu-id="ab996-104">In previous versions of the .NET Framework, the value was expected to be an <xref:System.IntPtr?displayProperty=name> representing a location in memory where the [HWND](https://msdn.microsoft.com/library/windows/desktop/aa383751.aspx#HWND) value resided.</span></span> <span data-ttu-id="ab996-105">在 Windows 7 和舊版中，將屬性設為 form.Handle 不會有任何作用，但在 Windows 8 和更新的版本中，則會導致 &quot;<xref:System.Security.Cryptography.CryptographicException?displayProperty=name>：參數不正確。&quot;</span><span class="sxs-lookup"><span data-stu-id="ab996-105">Setting the property to form.Handle on Windows 7 and earlier versions had no effect, but on Windows 8 and later versions, it results in a &quot;<xref:System.Security.Cryptography.CryptographicException?displayProperty=name>: The parameter is incorrect.&quot;</span></span>|
|<span data-ttu-id="ab996-106">建議</span><span class="sxs-lookup"><span data-stu-id="ab996-106">Suggestion</span></span>|<span data-ttu-id="ab996-107">以 .NET Framework 4.7 或更新版本為目標的應用程式若要註冊父視窗關聯性，建議使用以下的簡化格式︰</span><span class="sxs-lookup"><span data-stu-id="ab996-107">Applications targeting .NET Framework 4.7 or higher wishing to register a parent window relationship are encouraged to use the simplified form:</span></span><pre><code class="lang-csharp">cspParameters.ParentWindowHandle = form.Handle;&#13;&#10;</code></pre><span data-ttu-id="ab996-108">使用者如已發現要傳遞的正確值是 <code>form.Handle</code> 值所在之記憶體位置的位址，可以藉由將 AppContext 參數 <code>Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle</code> 設為 <code>true</code> 以選擇退出行為變更。</span><span class="sxs-lookup"><span data-stu-id="ab996-108">Users who had identified that the correct value to pass was the address of a memory location which held the value <code>form.Handle</code> can opt out of the behavior change by setting the AppContext switch <code>Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle</code> to <code>true</code>.</span></span><ol><li><span data-ttu-id="ab996-109">以程式設計方式設定 AppContext 的相容性參數，如[這裡](https://blogs.msdn.com/b/dotnet/archive/2015/04/29/net-announcements-at-build-2015.aspx#dotnet46)所述。</span><span class="sxs-lookup"><span data-stu-id="ab996-109">By programmatically setting compat switches on the AppContext, as explained [here](https://blogs.msdn.com/b/dotnet/archive/2015/04/29/net-announcements-at-build-2015.aspx#dotnet46)</span></span></li><li><span data-ttu-id="ab996-110">將下列程式行加入至 app.config 檔案的 <code>&lt;runtime&gt;</code> 區段：</span><span class="sxs-lookup"><span data-stu-id="ab996-110">By adding the following line to the <code>&lt;runtime&gt;</code> section of the app.config file:</span></span></li></ol><pre><code class="lang-xml">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle=true&quot;/&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre><span data-ttu-id="ab996-111">相反地，若使用者想在應用程式在舊版 .NET Framework 下載入時，選擇加入 .NET Framework 4.7 執行階段上的新行為，可以將 AppContext 參數設為 <code>false</code>。</span><span class="sxs-lookup"><span data-stu-id="ab996-111">Conversely, users who wish to opt in to the new behavior on the .NET Framework 4.7 runtime when the application loads under older .NET Framework versions can set the AppContext switch to <code>false</code>.</span></span>|
|<span data-ttu-id="ab996-112">範圍</span><span class="sxs-lookup"><span data-stu-id="ab996-112">Scope</span></span>|<span data-ttu-id="ab996-113">次要</span><span class="sxs-lookup"><span data-stu-id="ab996-113">Minor</span></span>|
|<span data-ttu-id="ab996-114">版本</span><span class="sxs-lookup"><span data-stu-id="ab996-114">Version</span></span>|<span data-ttu-id="ab996-115">4.7</span><span class="sxs-lookup"><span data-stu-id="ab996-115">4.7</span></span>|
|<span data-ttu-id="ab996-116">類型</span><span class="sxs-lookup"><span data-stu-id="ab996-116">Type</span></span>|<span data-ttu-id="ab996-117">正在重定目標</span><span class="sxs-lookup"><span data-stu-id="ab996-117">Retargeting</span></span>|
|<span data-ttu-id="ab996-118">受影響的 API</span><span class="sxs-lookup"><span data-stu-id="ab996-118">Affected APIs</span></span>|<ul><li><xref:System.Security.Cryptography.CspParameters.ParentWindowHandle?displayProperty=nameWithType></li></ul>|

