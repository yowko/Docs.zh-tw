### <a name="wpf-grid-allocation-of-space-to-star-columns"></a><span data-ttu-id="3aad3-101">star-column 空間的 WPF 方格配置</span><span class="sxs-lookup"><span data-stu-id="3aad3-101">WPF Grid allocation of space to star-columns</span></span>

|   |   |
|---|---|
|<span data-ttu-id="3aad3-102">詳細資料</span><span class="sxs-lookup"><span data-stu-id="3aad3-102">Details</span></span>|<span data-ttu-id="3aad3-103">從 .NET Framework 4.7 開始，WPF 取代了 <xref:System.Windows.Controls.Grid> 用來配置 \*-column 空間的演算法。</span><span class="sxs-lookup"><span data-stu-id="3aad3-103">Starting with the .NET Framework 4.7, WPF replaces the algorithm that <xref:System.Windows.Controls.Grid> uses to allocate space to \*-columns.</span></span> <span data-ttu-id="3aad3-104">在以下幾種情況下，這會使指派給 \*-column 的實際寬度產生變化：</span><span class="sxs-lookup"><span data-stu-id="3aad3-104">This will change the actual width assigned to \*-columns in a number of cases:</span></span><ul><li><span data-ttu-id="3aad3-105">當一或多個 \*-column 也具有寬度下限或上限，因而會覆寫該資料行的按比例配置時。</span><span class="sxs-lookup"><span data-stu-id="3aad3-105">When one or more \*-columns also have a minimum or maximum width that overrides the proportional allocation for that colum.</span></span> <span data-ttu-id="3aad3-106">(寬度下限可能衍生自明確的 MinWidth 宣告，或衍生自從資料行的內容取得的隱含下限。</span><span class="sxs-lookup"><span data-stu-id="3aad3-106">(The minimum width can derive from an explicit MinWidth declaration, or from an implicit minimum obtained from the column's content.</span></span> <span data-ttu-id="3aad3-107">寬度上限僅能明確地從 MaxWidth 宣告定義)。</span><span class="sxs-lookup"><span data-stu-id="3aad3-107">The maximum width can only be defined explicitly, from a MaxWidth declaration.)</span></span></li><li><span data-ttu-id="3aad3-108">當一或多個 *-column 宣告極大的 *-weight 時 (大於 10^298)。</span><span class="sxs-lookup"><span data-stu-id="3aad3-108">When one or more *-columns declare an extremely large *-weight, greater than 10^298.</span></span></li><li><span data-ttu-id="3aad3-109">當 \*-weight 的差異足以發生浮點不穩定 (溢位、反向溢位、精確度失準) 時。</span><span class="sxs-lookup"><span data-stu-id="3aad3-109">When the \*-weights are sufficiently different to encounter floating-point instability (overflow, underflow, loss of precision).</span></span></li><li><span data-ttu-id="3aad3-110">當版面配置進位已啟用，且有效顯示 DPI 夠高時。</span><span class="sxs-lookup"><span data-stu-id="3aad3-110">When layout rounding is enabled, and the effective display DPI is sufficiently high.</span></span></li></ul><span data-ttu-id="3aad3-111">在前兩個狀況中，新演算法產生的寬度可能明顯不同於舊演算法產生的寬度；在最後一個狀況中，差異最多會是一或兩個像素。</span><span class="sxs-lookup"><span data-stu-id="3aad3-111">In the first two cases, the widths produced by the new algorithm can be significantly different from those produced by the old algorithm; in the last case, the difference will be at most one or two pixels.</span></span><p/><span data-ttu-id="3aad3-112">新的演算法修正了舊演算法中的數個錯誤：</span><span class="sxs-lookup"><span data-stu-id="3aad3-112">The new algorithm fixes several bugs present in the old algorithm:</span></span><ol><li><span data-ttu-id="3aad3-113">資料行的總配置可能會超過方格的寬度。</span><span class="sxs-lookup"><span data-stu-id="3aad3-113">Total allocation to columns can exceed the Grid's width.</span></span> <span data-ttu-id="3aad3-114">資料行的按比例共用若低於其大小下限，配置空間時就可能發生這個狀況。</span><span class="sxs-lookup"><span data-stu-id="3aad3-114">This can occur when allocating space to a column whose proportional share is less than its minimum size.</span></span> <span data-ttu-id="3aad3-115">此演算法會配置大小下限，因此，其他資料行的可用空間會減少。</span><span class="sxs-lookup"><span data-stu-id="3aad3-115">The algorithm allocates the minimum size, which decreases the space available to other columns.</span></span> <span data-ttu-id="3aad3-116">如果沒有要配置的 \*-column，總配置將會過大。</span><span class="sxs-lookup"><span data-stu-id="3aad3-116">If there are no \*-columns left to allocate, the total allocation will be too large.</span></span></li><li><span data-ttu-id="3aad3-117">總配置的方格寬度可能會不足。</span><span class="sxs-lookup"><span data-stu-id="3aad3-117">Total allocation can fall short of the Grid's width.</span></span> <span data-ttu-id="3aad3-118">這是第 1 點的雙重問題，在為資料行配置空間時，若其按比例共用超過大小上限，但缺少可使用剩餘空間的 \*-column 時，就會發生這個狀況。</span><span class="sxs-lookup"><span data-stu-id="3aad3-118">This is the dual problem to #1, arising when allocating to a column whose proportional share is greater than its maximum size, with no \*-columns left to take up the slack.</span></span></li><li><span data-ttu-id="3aad3-119">兩個 *-column 的配置可能不是依其 *-weight 按比例分配。</span><span class="sxs-lookup"><span data-stu-id="3aad3-119">Two *-columns can receive allocations not proportional to their *-weights.</span></span> <span data-ttu-id="3aad3-120">相較於第 1 點/第 2 點，這是程度較輕的錯誤，在為 \*-columns A、B 和 C (依此順序) 配置空間時，若 B 的按比例共用違反其下限 (或上限) 條件約束，就會發生這個狀況。</span><span class="sxs-lookup"><span data-stu-id="3aad3-120">This is a milder version of #1/#2, arising when allocating to \*-columns A, B, and C (in that order), where B's proportional share violates its min (or max) constraint.</span></span> <span data-ttu-id="3aad3-121">如上所述，這會使資料行 C 的可用的空間產生變化，可能會獲得較 A 更少 (或更多) 的比例配置，</span><span class="sxs-lookup"><span data-stu-id="3aad3-121">As above, this changes the space available to column C, who gets less (or more) proportional allocation than A did,</span></span></li><li><span data-ttu-id="3aad3-122">權數極大 (&gt; 10^298) 的資料行一律會視為擁有 10 ^298 的權數。</span><span class="sxs-lookup"><span data-stu-id="3aad3-122">Columns with extremely large weights (&gt; 10^298) are all treated as if they had weight 10^298.</span></span> <span data-ttu-id="3aad3-123">它們之間 (及權數較小的資料行之間) 的比例差異則可忽略。</span><span class="sxs-lookup"><span data-stu-id="3aad3-123">Proportional differences between them (and between columns with slightly smaller weights) are not honored.</span></span></li><li><span data-ttu-id="3aad3-124">無法正確處理擁有無限權數的資料行。</span><span class="sxs-lookup"><span data-stu-id="3aad3-124">Columns with inifinte weights are not handled correctly.</span></span> <span data-ttu-id="3aad3-125">[事實上，您無法將權數設為無限大，但這是人為限制。</span><span class="sxs-lookup"><span data-stu-id="3aad3-125">[Actually you can't set a weight to Infinity, but this is an artificial restriction.</span></span> <span data-ttu-id="3aad3-126">配置程式碼會嘗試處理它，但成效不彰。]</span><span class="sxs-lookup"><span data-stu-id="3aad3-126">The allocation code was trying to handle it, but doing a bad job.]</span></span></li><li><span data-ttu-id="3aad3-127">避免溢位、反向溢位時的幾個小問題、精確度失準及類似的浮點數問題。</span><span class="sxs-lookup"><span data-stu-id="3aad3-127">Several minor problems while avoiding overflow, underflow, loss of precision and similar floating-point issues.</span></span></li><li><span data-ttu-id="3aad3-128">版面配置進位的調整在 DPI 足夠高的情況下不正確。</span><span class="sxs-lookup"><span data-stu-id="3aad3-128">Adjustments for layout rounding are incorrect at sufficiently high DPI.</span></span></li></ol><span data-ttu-id="3aad3-129">新的演算法會產生符合下列準則的結果︰</span><span class="sxs-lookup"><span data-stu-id="3aad3-129">The new algorithm produces results that meet the following criteria:</span></span><p/><span data-ttu-id="3aad3-130">答：</span><span class="sxs-lookup"><span data-stu-id="3aad3-130">A.</span></span> <span data-ttu-id="3aad3-131">指派給 \*-column 的實際寬度永遠不會低於其寬度下限或高於其寬度上限。</span><span class="sxs-lookup"><span data-stu-id="3aad3-131">The actual width assigned to a \*-column is never less than its minimum width nor greater than its maximum width.</span></span><br/><span data-ttu-id="3aad3-132">B.</span><span class="sxs-lookup"><span data-stu-id="3aad3-132">B.</span></span> <span data-ttu-id="3aad3-133">對於尚未指派寬度下限或上限的每個 <em>-column，會依其 <em>-weight 按比例指派寬度。確切而言，若有兩個資料行分別使用寬度 x</em> 和 y</em> 宣告，而任一資料行均未配置其寬度下限和上限，則指派給資料行的實際寬度 v 和 w 所使用的比例相同：v / w == x / y。</span><span class="sxs-lookup"><span data-stu-id="3aad3-133">Each <em>-column that is not assigned its minimum or maximum width is assigned a width proportional to its <em>-weight. To be precise, if two columns are declared with width x</em> and y</em> respectively, and if neither column receives its minimum or maximum width, the actual widths v and w assigned to the columns are in the same proportion: v / w == x / y.</span></span><br/><span data-ttu-id="3aad3-134">C.</span><span class="sxs-lookup"><span data-stu-id="3aad3-134">C.</span></span> <span data-ttu-id="3aad3-135">配置給「按比例」*-column 的總寬度，等於配置給條件約束的資料行 (固定、自動及已配置寬度下限或上限的 *-column) 後的可用空間。</span><span class="sxs-lookup"><span data-stu-id="3aad3-135">The total width allocated to &quot;proportional&quot; *-columns is equal to the space available after allocating to the constrained columns (fixed, auto, and *-columns that are allocated their min or max width).</span></span> <span data-ttu-id="3aad3-136">這可能是零，例如，若寬度下限的總和超過方格可用的寬度。</span><span class="sxs-lookup"><span data-stu-id="3aad3-136">This might be zero, for instance if the sum of the minimum widths exceeds the Grid's availbable width.</span></span><br/><span data-ttu-id="3aad3-137">D.</span><span class="sxs-lookup"><span data-stu-id="3aad3-137">D.</span></span> <span data-ttu-id="3aad3-138">以上所述是就「理想」的版面配置而言。</span><span class="sxs-lookup"><span data-stu-id="3aad3-138">All these statements are to be interpreted with respect to the &quot;ideal&quot; layout.</span></span> <span data-ttu-id="3aad3-139">當版面配置進位作用中時，實際寬度與理想寬度最多會相差一個像素。</span><span class="sxs-lookup"><span data-stu-id="3aad3-139">When layout rounding is in effect, the actual widths can differ from the ideal widths by as much as one pixel.</span></span><br/><span data-ttu-id="3aad3-140">舊的演算法能實現 (A) 準則，卻無法實現上述狀況中的其他準則。</span><span class="sxs-lookup"><span data-stu-id="3aad3-140">The old algorithm honored (A) but failed to honor the other criteria in the cases outlined above.</span></span><p/><span data-ttu-id="3aad3-141">本文中有關資料行和寬度的所有內容也適用於資料列和高度。</span><span class="sxs-lookup"><span data-stu-id="3aad3-141">Everything said about columns and widths in this article applies as well to rows and heights.</span></span>|
|<span data-ttu-id="3aad3-142">建議</span><span class="sxs-lookup"><span data-stu-id="3aad3-142">Suggestion</span></span>|<span data-ttu-id="3aad3-143">根據預設，以 .NET Framework 4.7 開始的 .NET Framework 版本為目標的應用程式會看見新的演算法，而以 .NET Framework 4.6.2 或更舊版本為目標的應用程式會看見舊的演算法。</span><span class="sxs-lookup"><span data-stu-id="3aad3-143">By default, apps that target versions of the .NET Framework starting with the .NET Framework 4.7 will see the new algorithm, while apps that target the .NET Framework 4.6.2 or earlier versions will see the old algorithm.</span></span><p/><span data-ttu-id="3aad3-144">若要覆寫預設值，請使用下列組態設定︰</span><span class="sxs-lookup"><span data-stu-id="3aad3-144">To override the default, use the following configuration setting:</span></span><pre><code class="lang-xml">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Windows.Controls.Grid.StarDefinitionsCanExceedAvailableSpace=true&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre><span data-ttu-id="3aad3-145">值 <code>true</code> 會選取舊的演算法，<code>false</code> 會選取新的演算法。</span><span class="sxs-lookup"><span data-stu-id="3aad3-145">The value <code>true</code> selects the old algorithm, <code>false</code> selects the new algorithm.</span></span>|
|<span data-ttu-id="3aad3-146">範圍</span><span class="sxs-lookup"><span data-stu-id="3aad3-146">Scope</span></span>|<span data-ttu-id="3aad3-147">次要</span><span class="sxs-lookup"><span data-stu-id="3aad3-147">Minor</span></span>|
|<span data-ttu-id="3aad3-148">版本</span><span class="sxs-lookup"><span data-stu-id="3aad3-148">Version</span></span>|<span data-ttu-id="3aad3-149">4.7</span><span class="sxs-lookup"><span data-stu-id="3aad3-149">4.7</span></span>|
|<span data-ttu-id="3aad3-150">類型</span><span class="sxs-lookup"><span data-stu-id="3aad3-150">Type</span></span>|<span data-ttu-id="3aad3-151">正在重定目標</span><span class="sxs-lookup"><span data-stu-id="3aad3-151">Retargeting</span></span>|

