---
title: .NET Framework 4 移轉問題
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 368d5f7fa2eec8f3526a10b4777a862e8334617c
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/08/2019
ms.locfileid: "59210226"
---
# <a name="net-framework-4-migration-issues"></a><span data-ttu-id="fd127-102">.NET Framework 4 移轉問題</span><span class="sxs-lookup"><span data-stu-id="fd127-102">.NET Framework 4 migration issues</span></span>

<span data-ttu-id="fd127-103">本主題描述 .NET Framework 版本 3.5 Service Pack 1 與 .NET Framework 版本 4 之間的移轉問題，包含修正程式、標準合規性和安全性變更，以及根據客戶意見反應的變更。</span><span class="sxs-lookup"><span data-stu-id="fd127-103">This topic describes migration issues between the .NET Framework version 3.5 Service Pack 1 and the .NET Framework version 4, including fixes, changes for standards compliance and security, and changes based on customer feedback.</span></span> <span data-ttu-id="fd127-104">大多數變更都不需要您的應用程式進行任何設計修改。</span><span class="sxs-lookup"><span data-stu-id="fd127-104">Most of these changes do not require any programming modifications in your applications.</span></span> <span data-ttu-id="fd127-105">對於可能涉及修改的變更，請參閱表格的 [建議變更] 欄。</span><span class="sxs-lookup"><span data-stu-id="fd127-105">For those that may involve modifications, see the Recommended changes column of the table.</span></span>

<span data-ttu-id="fd127-106">本主題描述下列領域中值得注意的變更：</span><span class="sxs-lookup"><span data-stu-id="fd127-106">This topic describes notable changes in the following areas:</span></span>

* [<span data-ttu-id="fd127-107">ASP.NET 和 Web</span><span class="sxs-lookup"><span data-stu-id="fd127-107">ASP.NET and Web</span></span>](#aspnet-and-web)

* [<span data-ttu-id="fd127-108">核心</span><span class="sxs-lookup"><span data-stu-id="fd127-108">Core</span></span>](#core)

* [<span data-ttu-id="fd127-109">資料</span><span class="sxs-lookup"><span data-stu-id="fd127-109">Data</span></span>](#data)

* [<span data-ttu-id="fd127-110">Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="fd127-110">Windows Communication Foundation (WCF)</span></span>](#windows-communication-foundation-wcf)

* [<span data-ttu-id="fd127-111">Windows Presentation Foundation (WPF)</span><span class="sxs-lookup"><span data-stu-id="fd127-111">Windows Presentation Foundation (WPF)</span></span>](#windows-presentation-foundation-wpf)

* [<span data-ttu-id="fd127-112">XML</span><span class="sxs-lookup"><span data-stu-id="fd127-112">XML</span></span>](#xml)

<span data-ttu-id="fd127-113">如需本主題中問題的較高階概觀，請參閱 [.NET Framework 4 移轉手冊](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)。</span><span class="sxs-lookup"><span data-stu-id="fd127-113">For an higher-level overview of the issues in this topic, see the [Migration Guide to the .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).</span></span>

<span data-ttu-id="fd127-114">如需新功能的資訊，請參閱 [.NET Framework 4 的新功能](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)。</span><span class="sxs-lookup"><span data-stu-id="fd127-114">For information about new features, see [What's New in the .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).</span></span>

## <a name="aspnet-and-web"></a><span data-ttu-id="fd127-115">ASP.NET 和 Web</span><span class="sxs-lookup"><span data-stu-id="fd127-115">ASP.NET and Web</span></span>

<span data-ttu-id="fd127-116">命名空間：<xref:System.Web>、<xref:System.Web.Mobile>、<xref:System.Web.Security>、<xref:System.Web.UI.WebControls>；組件：System.Web (在 System.Web.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-116">Namespaces: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; assembly: System.Web (in System.Web.dll)</span></span>

| <span data-ttu-id="fd127-117">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-117">Feature</span></span> | <span data-ttu-id="fd127-118">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-118">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-119">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-119">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-120">瀏覽器定義檔</span><span class="sxs-lookup"><span data-stu-id="fd127-120">Browser definition files</span></span>** | <span data-ttu-id="fd127-121">瀏覽器定義檔已更新成包含新增和已更新瀏覽器及裝置的資訊。</span><span class="sxs-lookup"><span data-stu-id="fd127-121">The browser definition files have been updated to include information about new and updated browsers and devices.</span></span> <span data-ttu-id="fd127-122">已移除 Netscape Navigator 這類較舊的瀏覽器和裝置，並已新增 Google Chrome 和 Apple iPhone 這類較新的瀏覽器和裝置。</span><span class="sxs-lookup"><span data-stu-id="fd127-122">Older browsers and devices such as Netscape Navigator have been removed, and newer browsers and devices such as Google Chrome and Apple iPhone have been added.</span></span><br><br><span data-ttu-id="fd127-123">如果您的應用程式包含繼承自其中一個已移除瀏覽器定義的自訂瀏覽器定義，則您會看到錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-123">If your application contains custom browser definitions that inherit from one of the browser definitions that have been removed, you will see an error.</span></span><br><br><span data-ttu-id="fd127-124"><xref:System.Web.HttpBrowserCapabilities> 物件 (由頁面的 `Request.Browse` 屬性所公開) 是透過瀏覽器定義檔所驅動。</span><span class="sxs-lookup"><span data-stu-id="fd127-124">The <xref:System.Web.HttpBrowserCapabilities> object (which is exposed by the page's `Request.Browse` property) is driven by the browser definition files.</span></span> <span data-ttu-id="fd127-125">因此，ASP.NET 4 中存取此物件的屬性所傳回的資訊，可能會與舊版 ASP.NET 中所傳回的資訊不同。</span><span class="sxs-lookup"><span data-stu-id="fd127-125">Therefore, the information that is returned by accessing a property of this object in ASP.NET 4 might be different than the information that was returned in an earlier version of ASP.NET.</span></span> | <span data-ttu-id="fd127-126">如果您的應用程式依賴舊的瀏覽器定義檔，則可以從下列資料夾中複製它們：</span><span class="sxs-lookup"><span data-stu-id="fd127-126">If your application relies on the old browser definition files, you can copy them from the following folder:</span></span><br><br>*<span data-ttu-id="fd127-127">Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers</span><span class="sxs-lookup"><span data-stu-id="fd127-127">Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers</span></span>*<br><br><span data-ttu-id="fd127-128">將檔案複製至 ASP.NET 4 的對應 \\CONFIG\\Browsers 資料夾。</span><span class="sxs-lookup"><span data-stu-id="fd127-128">Copy the files into the corresponding *\\CONFIG\\Browsers* folder for ASP.NET 4.</span></span> <span data-ttu-id="fd127-129">在您複製檔案之後，請執行 [Aspnet_regbrowsers.exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) 命令列工具。</span><span class="sxs-lookup"><span data-stu-id="fd127-129">After you copy the files, run the [Aspnet_regbrowsers.exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) command-line tool.</span></span> <span data-ttu-id="fd127-130">如需詳細資訊，請參閱 [https://www.asp.net/mobile](/aspnet/mobile/overview) 網站。</span><span class="sxs-lookup"><span data-stu-id="fd127-130">For more information, see the [https://www.asp.net/mobile](/aspnet/mobile/overview) Web site.</span></span> |
| **<span data-ttu-id="fd127-131">在混合 ASP.NET 版本下執行的子應用程式</span><span class="sxs-lookup"><span data-stu-id="fd127-131">Child applications running under mixed versions of ASP.NET</span></span>** | <span data-ttu-id="fd127-132">因為發生組態或編譯錯誤，所以可能無法啟動設定為執行舊版 ASP.NET 之應用程式子系的 ASP.NET 4 應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-132">ASP.NET 4 applications that are configured as children of applications that run earlier versions of ASP.NET might fail to start because of configuration or compilation errors.</span></span> <span data-ttu-id="fd127-133">發生的特定錯誤取決於應用程式是在 IIS 6.0 還是 IIS 7 或 IIS 7.5 下執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-133">The specific error that occurs depends on whether the application runs under IIS 6.0, or under IIS 7 or IIS 7.5.</span></span> | <span data-ttu-id="fd127-134">您可以變更受影響應用程式的組態檔，讓組態系統正確地辨識 ASP.NET 4 應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-134">You can make changes to the configuration files of the affected applications so that the configuration system correctly recognizes the ASP.NET 4 application.</span></span> <span data-ttu-id="fd127-135">如需您必須進行之變更的資訊，請參閱 ASP.NET 網站之 [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (ASP.NET 4 最新變更) 文件中的＜ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications＞(在 ASP.NET 2.0 或 ASP.NET 3.5 應用程式下時，無法啟動 ASP.NET 4 子應用程式) 一節。</span><span class="sxs-lookup"><span data-stu-id="fd127-135">For information about the changes you must make, see the section "ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| **<span data-ttu-id="fd127-136">ClientID 變更</span><span class="sxs-lookup"><span data-stu-id="fd127-136">ClientID changes</span></span>** | <span data-ttu-id="fd127-137">ASP.NET 4 中的新 `clientIDMode` 設定可讓您指定 ASP.NET 如何產生 HTML 項目的 `id` 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-137">The new `clientIDMode` setting in ASP.NET 4 lets you specify how ASP.NET generates the `id` attribute for HTML elements.</span></span> <span data-ttu-id="fd127-138">在舊版 ASP.NET 中，預設行為相當於 `clientIDMode` 的 `AutoID` 設定。</span><span class="sxs-lookup"><span data-stu-id="fd127-138">In previous versions of ASP.NET, the default behavior was equivalent to the `AutoID` setting of `clientIDMode`.</span></span> <span data-ttu-id="fd127-139">預設設定現在為 `Predictable`。</span><span class="sxs-lookup"><span data-stu-id="fd127-139">The default setting is now `Predictable`.</span></span> <span data-ttu-id="fd127-140">如需詳細資訊，請參閱 [ASP.NET 網頁伺服器控制項識別](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29)。</span><span class="sxs-lookup"><span data-stu-id="fd127-140">For more information, see [ASP.NET Web Server Control Identification](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29).</span></span> | <span data-ttu-id="fd127-141">如果您使用 Visual Studio 從 ASP.NET 2.0 或 ASP.NET 3.5 升級應用程式，則工具會自動將設定新增至 Web.config 檔案，以保留舊版 .NET Framework 的行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-141">If you use Visual Studio to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves the behavior of earlier versions of the .NET Framework.</span></span> <span data-ttu-id="fd127-142">不過，如果您將 IIS 中的應用程式集區變更成以.NET Framework 4 為目標來升級應用程式，則 ASP.NET 預設會使用新模式。</span><span class="sxs-lookup"><span data-stu-id="fd127-142">However, if you upgrade an application by changing the application pool in IIS to target the .NET Framework 4, ASP.NET uses the new mode by default.</span></span> <span data-ttu-id="fd127-143">若要停用新的用戶端識別碼模式，請在 Web.config 檔案中新增下列設定：</span><span class="sxs-lookup"><span data-stu-id="fd127-143">To disable the new client ID mode, add the following setting to the Web.config file:</span></span><br><br>`<pages clientIDMode="AutoID" />` |
| **<span data-ttu-id="fd127-144">程式碼存取安全性 (CAS)</span><span class="sxs-lookup"><span data-stu-id="fd127-144">Code access security (CAS)</span></span>** | <span data-ttu-id="fd127-145">已在 ASP.NET 3.5 中新增的 ASP.NET 2.0 NET 功能使用 .NET Framework 1.1 和 .NET Framework 2.0 程式碼存取安全性 (CAS) 模型。</span><span class="sxs-lookup"><span data-stu-id="fd127-145">ASP.NET 2.0 NET features that were added in ASP.NET 3.5 use the .NET Framework 1.1 and .NET Framework 2.0 code access security (CAS) model.</span></span> <span data-ttu-id="fd127-146">不過，已大幅全面檢查 ASP.NET 4 中 CAS 的實作。</span><span class="sxs-lookup"><span data-stu-id="fd127-146">However, the implementation of CAS in ASP.NET 4 has been substantially overhauled.</span></span> <span data-ttu-id="fd127-147">因此，如果部分信任 ASP.NET 應用程式依賴在全域組件快取中執行的受信任程式碼，則可能會因各種安全性例外狀況而失敗。</span><span class="sxs-lookup"><span data-stu-id="fd127-147">As a result, partial-trust ASP.NET applications that rely on trusted code running in the global assembly cache might fail with various security exceptions.</span></span> <span data-ttu-id="fd127-148">依賴對電腦 CAS 原則進行大量修改的部分信任應用程式可能也會失敗，並擲回安全性例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd127-148">Partial-trust applications that rely on extensive modifications to machine CAS policy might also fail and throw security exceptions.</span></span> | <span data-ttu-id="fd127-149">在 `trust` 組態項目中使用新 `legacyCasModel` 屬性，即可將部分信任 ASP.NET 4 應用程式還原為 ASP.NET 1.1 和 2.0 的行為，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="fd127-149">You can revert partial-trust ASP.NET 4 applications to the behavior of ASP.NET 1.1 and 2.0 by using the new `legacyCasModel` attribute in the `trust` configuration element, as shown in the following example:</span></span><br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br><span data-ttu-id="fd127-150">重要事項：還原為舊版 CAS 模型可能代表安全性降低。</span><span class="sxs-lookup"><span data-stu-id="fd127-150">Important: Reverting to the older CAS model might represent reduced security.</span></span><br><br><span data-ttu-id="fd127-151">如需新 ASP.NET 4 程式碼存取安全性模型的詳細資訊，請參閱 [ASP.NET 4 應用程式中的程式碼存取安全性](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="fd127-151">For more information about the new ASP.NET 4 code access security model, see [Code Access Security in ASP.NET 4 Applications](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)).</span></span> |
| **<span data-ttu-id="fd127-152">組態檔</span><span class="sxs-lookup"><span data-stu-id="fd127-152">Configuration files</span></span>** | <span data-ttu-id="fd127-153">.NET Framework 和 ASP.NET 4 的根組態檔 (machine.config 檔案和根 Web.config 檔案) 已更新成包含 ASP.NET 3.5 之應用程式 Web.config 檔案中的大部分未定案組態資訊。</span><span class="sxs-lookup"><span data-stu-id="fd127-153">The root configuration files (the machine.config file and the root Web.config file) for the .NET Framework and ASP.NET 4 have been updated to include most of the boilerplate configuration information that was found in the application Web.config files in ASP.NET 3.5.</span></span> <span data-ttu-id="fd127-154">因為受管理 IIS 7 和 IIS 7.5 組態系統的複雜度，所以在 ASP.NET 4 以及 IIS 7 和 IIS 7.5 下執行 ASP.NET 3.5 應用程式可能會導致 ASP.NET 錯誤或 IIS 錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-154">Because of the complexity of the managed IIS 7 and IIS 7.5 configuration systems, running ASP.NET 3.5 applications under ASP.NET 4 and under IIS 7 and IIS 7.5 can result in either ASP.NET errors or IIS errors.</span></span> | <span data-ttu-id="fd127-155">使用 Visual Studio 中的專案升級工具，以將 ASP.NET 3.5 應用程式升級至 ASP.NET 4。</span><span class="sxs-lookup"><span data-stu-id="fd127-155">Upgrade ASP.NET 3.5 applications to ASP.NET 4 by using the project upgrade tools in Visual Studio.</span></span> <span data-ttu-id="fd127-156">Visual Studio 2010 會自動修改 ASP.NET 3.5 應用程式的 Web.config 檔案，以包含 ASP.NET 4 的適當設定。</span><span class="sxs-lookup"><span data-stu-id="fd127-156">Visual Studio 2010 automatically modifies the ASP.NET 3.5 application's Web.config file to contain the appropriate settings for ASP.NET 4.</span></span><br><br><span data-ttu-id="fd127-157">不過，您可以使用 .NET Framework 4 來執行 ASP.NET 3.5 應用程式，而不需要重新編譯。</span><span class="sxs-lookup"><span data-stu-id="fd127-157">However, you can run ASP.NET 3.5 applications using the .NET Framework 4 without recompilation.</span></span> <span data-ttu-id="fd127-158">在該情況下，您可能必須先手動修改應用程式的 Web.config 檔案，才能在 .NET Framework 4 和 IIS 7 或 IIS 7.5 下執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-158">In that case, you might have to manually modify the application's Web.config file before you run the application under the .NET Framework 4 and under IIS 7 or IIS 7.5.</span></span> <span data-ttu-id="fd127-159">您必須進行的特定變更取決於正在使用的軟體組合，包含 Service Pack (SP) 版本。</span><span class="sxs-lookup"><span data-stu-id="fd127-159">The specific change you must make depends on the combination of software you are working with, including Service Pack (SP) releases.</span></span> <span data-ttu-id="fd127-160">如需受這項變更影響的可能軟體組合以及如何解決特定組合的問題的資訊，請參閱 ASP.NET 網站之 [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (ASP.NET 4 最新變更) 文件中的＜Configuration Errors Related to New ASP.NET 4 Root Configuration＞(與新 ASP.NET 4 根組態相關的組態錯誤) 一節。</span><span class="sxs-lookup"><span data-stu-id="fd127-160">For information about the possible software combinations that are affected by this change and how to resolve problems with specific combinations, see the section "Configuration Errors Related to New ASP.NET 4 Root Configuration" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| **<span data-ttu-id="fd127-161">控制項轉譯</span><span class="sxs-lookup"><span data-stu-id="fd127-161">Control rendering</span></span>** | <span data-ttu-id="fd127-162">在舊版 ASP.NET 中，某些控制項已發出您無法停用的標記。</span><span class="sxs-lookup"><span data-stu-id="fd127-162">In previous versions of ASP.NET, some controls emitted markup that you could not disable.</span></span> <span data-ttu-id="fd127-163">根據預設，ASP.NET 4 中不再產生這種類型的標記。</span><span class="sxs-lookup"><span data-stu-id="fd127-163">By default, this type of markup is no longer generated in ASP.NET 4.</span></span> <span data-ttu-id="fd127-164">轉譯變更會影響下列控制項：</span><span class="sxs-lookup"><span data-stu-id="fd127-164">The rendering changes affect the following controls:</span></span><br><br><span data-ttu-id="fd127-165">\* `Image` 和 `ImageButton` 控制項不再轉譯 `border="0"` 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-165">\* The `Image` and `ImageButton` controls no longer render a `border="0"` attribute.</span></span><br><span data-ttu-id="fd127-166">\* `BaseValidator` 類別以及從中衍生的驗證控制項預設不再轉譯紅色文字。</span><span class="sxs-lookup"><span data-stu-id="fd127-166">\* The `BaseValidator` class and validation controls that derive from it no longer render red text by default.</span></span><br><span data-ttu-id="fd127-167">\* `HtmlForm` 控制項不會轉譯 `name` 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-167">\* The `HtmlForm` control does not render a `name` attribute.</span></span><br><span data-ttu-id="fd127-168">\* `Table` 控制項不再轉譯 `border="0"` 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-168">\* The `Table` control no longer renders a `border="0"` attribute.</span></span><br><br><span data-ttu-id="fd127-169">如果未針對使用者輸入設計的控制項 (例如，`Label` 控制項) 的 `Enabled` 屬性設定為 `false` (或者，如果它們從容器控制項繼承此設定)，則它們不再轉譯 `disabled="disabled"` 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-169">Controls that are not designed for user input (for example, the `Label` control) no longer render the `disabled="disabled"` attribute if their `Enabled` property is set to `false` (or if they inherit this setting from a container control).</span></span> | <span data-ttu-id="fd127-170">如果您使用 Visual Studio 從 ASP.NET 2.0 或 ASP.NET 3.5 升級應用程式，則工具會自動將設定新增至 Web.config 檔案，以保留舊版轉譯。</span><span class="sxs-lookup"><span data-stu-id="fd127-170">If you use Visual Studio to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves legacy rendering.</span></span> <span data-ttu-id="fd127-171">不過，如果您將 IIS 中的應用程式集區變更成以.NET Framework 4 為目標來升級應用程式，則 ASP.NET 預設會使用新轉譯模式。</span><span class="sxs-lookup"><span data-stu-id="fd127-171">However, if you upgrade an application by changing the application pool in IIS to target the .NET Framework 4, ASP.NET uses the new rendering mode by default.</span></span> <span data-ttu-id="fd127-172">若要停用新的轉譯模式，請在 Web.config 檔案中新增下列設定：</span><span class="sxs-lookup"><span data-stu-id="fd127-172">To disable the new rendering mode, add the following setting to the Web.config file:</span></span><br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **<span data-ttu-id="fd127-173">預設文件中的事件處理常式</span><span class="sxs-lookup"><span data-stu-id="fd127-173">Event handlers in default documents</span></span>** | <span data-ttu-id="fd127-174">已要求具有與其對應之預設文件的無副檔名 URL 時，ASP.NET 4 會將 HTML `form` 項目的 `action` 屬性值轉譯為空字串。</span><span class="sxs-lookup"><span data-stu-id="fd127-174">ASP.NET  4 renders the HTML `form` element's `action` attribute value as an empty string when a request is made to an extensionless URL that has a default document mapped to it.</span></span> <span data-ttu-id="fd127-175">在舊版 ASP.NET 中，`http://contoso.com` 要求會導致 Default.aspx 要求。</span><span class="sxs-lookup"><span data-stu-id="fd127-175">In earlier releases of ASP.NET, a request to `http://contoso.com` would result in a request to Default.aspx.</span></span> <span data-ttu-id="fd127-176">在該文件中，會轉譯開啟 `form` 標記，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="fd127-176">In that document, the opening `form` tag would be rendered as in the following example:</span></span><br><br>`<form action="Default.aspx" />`<br><br><span data-ttu-id="fd127-177">在 ASP.NET 4 中，`http://contoso.com` 要求也會導致 Default.aspx 要求，但 ASP.NET 現在會轉譯 HTML 開啟 `form` 標記，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="fd127-177">In ASP.NET 4, a request to `http://contoso.com` also results in a request to Default.aspx, but ASP.NET now renders the HTML opening `form` tag as in the following example:</span></span><br><br>`<form action="" />`<br><br><span data-ttu-id="fd127-178">`action` 屬性是空字串時，IIS `DefaultDocumentModule` 物件會建立 Default.aspx 的子要求。</span><span class="sxs-lookup"><span data-stu-id="fd127-178">When the `action` attribute is an empty string, the IIS `DefaultDocumentModule` object creates a child request to Default.aspx.</span></span> <span data-ttu-id="fd127-179">在大部分的情況下，應用程式碼可以辨識此子要求，Default.aspx 頁面則會正常執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-179">Under most conditions, this child request is transparent to application code, and the Default.aspx page runs normally.</span></span> <span data-ttu-id="fd127-180">不過，Managed 程式碼與 IIS 7 或 IIS 7.5 整合模式之間的可能互動可能會在子要求期間讓受管理 .aspx 頁面適當地停止運作。</span><span class="sxs-lookup"><span data-stu-id="fd127-180">However, a potential interaction between managed code and IIS 7 or IIS 7.5 Integrated mode can cause managed .aspx pages to stop working properly during the child request.</span></span> <span data-ttu-id="fd127-181">如果發生下列狀況，預設 .aspx 文件的子要求將會導致錯誤或未預期的行為：</span><span class="sxs-lookup"><span data-stu-id="fd127-181">If the following conditions occur, the child request to a default .aspx document will result in an error or in unexpected behavior:</span></span><br><br><span data-ttu-id="fd127-182">\* 在 `form` 項目的 `action` 屬性設定為 "" 的情況下，會將 .aspx 頁面傳送至瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="fd127-182">\* An .aspx page is sent to the browser with the `form` element's `action` attribute set to "".</span></span><br><span data-ttu-id="fd127-183">\* 表單會回傳至 ASP.NET。</span><span class="sxs-lookup"><span data-stu-id="fd127-183">\* The form is posted back to ASP.NET.</span></span><br><span data-ttu-id="fd127-184">\* 受管理 HTTP 模組會讀取實體主體的某個部分，例如 `Request.Form` 或 `Request.Params`。</span><span class="sxs-lookup"><span data-stu-id="fd127-184">\* A managed HTTP module reads some part of the entity body, such as `Request.Form` or `Request.Params`.</span></span> <span data-ttu-id="fd127-185">這會將 POST 要求的實體主體讀入受管理記憶體中。</span><span class="sxs-lookup"><span data-stu-id="fd127-185">This causes the entity body of the POST request to be read into managed memory.</span></span> <span data-ttu-id="fd127-186">因此，任何以 IIS 7 或 IIS 7.5 整合模式執行的機器碼模組都無法再使用實體主體。</span><span class="sxs-lookup"><span data-stu-id="fd127-186">As a result, the entity body is no longer available to any native code modules that are running in IIS 7 or IIS 7.5 Integrated mode.</span></span><br><span data-ttu-id="fd127-187">\* IIS `DefaultDocumentModule` 物件最後會執行並建立對 Default.aspx 文件的子要求。</span><span class="sxs-lookup"><span data-stu-id="fd127-187">\* The IIS `DefaultDocumentModule` object eventually runs and creates a child request to the Default.aspx document.</span></span> <span data-ttu-id="fd127-188">不過，因為 Managed 程式碼的某個部分已經讀取實體主體，所以沒有實體主體可用來傳送至子要求。</span><span class="sxs-lookup"><span data-stu-id="fd127-188">However, because the entity body has already been read by a piece of managed code, there is no entity body available to send to the child request.</span></span><br><span data-ttu-id="fd127-189">\* 針對子要求執行 HTTP 管線時，會在處理常式執行階段期間執行 .aspx 檔案的處理常式。</span><span class="sxs-lookup"><span data-stu-id="fd127-189">\* When the HTTP pipeline runs for the child request, the handler for .aspx files runs during the handler-execute phase.</span></span><br><br><span data-ttu-id="fd127-190">因為沒有實體主體，所以沒有表單變數和檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="fd127-190">Because there is no entity body, there are no form variables and no view state.</span></span> <span data-ttu-id="fd127-191">因此，沒有可用的 .aspx 頁面處理常式資訊，可用來判斷應該引發的事件 (如果有的話)。</span><span class="sxs-lookup"><span data-stu-id="fd127-191">Therefore there is no information available for the .aspx page handler to determine what event (if any) should be raised.</span></span> <span data-ttu-id="fd127-192">因此，未執行受影響 .aspx 頁面的回傳事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="fd127-192">As a result, none of the postback event handlers for the affected .aspx page run.</span></span> | <span data-ttu-id="fd127-193">如需這項變更所引發問題之解決方式的資訊，請參閱 ASP.NET 網站之 [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (ASP.NET 4 最新變更) 文件中的＜Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode＞(在預設文件中可能未以 IIS 7 或 IIS 7.5 整合模式引發事件處理常式)。</span><span class="sxs-lookup"><span data-stu-id="fd127-193">For information about ways to work around problems that might arise as a result of this change, see "Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| **<span data-ttu-id="fd127-194">雜湊演算法</span><span class="sxs-lookup"><span data-stu-id="fd127-194">Hashing algorithm</span></span>** | <span data-ttu-id="fd127-195">ASP.NET 使用加密和雜湊演算法來協助保護資料，例如表單驗證 Cookie 和檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="fd127-195">ASP.NET uses both encryption and hashing algorithms to help secure data such as forms authentication cookies and view state.</span></span> <span data-ttu-id="fd127-196">ASP.NET 4 預設會將 <xref:System.Security.Cryptography.HMACSHA256> 演算法用於對 Cookie 和檢視狀態的雜湊作業。</span><span class="sxs-lookup"><span data-stu-id="fd127-196">By default, ASP.NET 4 uses the <xref:System.Security.Cryptography.HMACSHA256> algorithm for hash operations on cookies and view state.</span></span> <span data-ttu-id="fd127-197">舊版 ASP.NET 使用較舊的 <xref:System.Security.Cryptography.HMACSHA1> 演算法。</span><span class="sxs-lookup"><span data-stu-id="fd127-197">Earlier versions of ASP.NET used the older <xref:System.Security.Cryptography.HMACSHA1> algorithm.</span></span> | <span data-ttu-id="fd127-198">如果您執行混合使用 ASP.NET 2.0 和 ASP.NET 4 的應用程式，其中，表單驗證 Cookie 這類資料必須跨 .NET Framework 版本作用，請在 Web.config 檔案中新增下列設定，以設定 ASP.NET 4 Web 應用程式使用較舊的 <xref:System.Security.Cryptography.HMACSHA1> 演算法：</span><span class="sxs-lookup"><span data-stu-id="fd127-198">If you run applications that mix ASP.NET 2.0 and ASP.NET 4, where data such as forms authentication cookies must work across .NET Framework versions, configure an ASP.NET 4 Web application to use the older <xref:System.Security.Cryptography.HMACSHA1> algorithm by adding the following setting in the Web.config file:</span></span><br><br>`<machineKey validation="SHA1" />` |
| **<span data-ttu-id="fd127-199">在 Internet Explorer 中裝載控制項</span><span class="sxs-lookup"><span data-stu-id="fd127-199">Hosting controls in Internet Explorer</span></span>** | <span data-ttu-id="fd127-200">您無法再於 Internet Explorer 中裝載 Windows Form 控制項，因為在 Web 上裝載控制項有更好的方案。</span><span class="sxs-lookup"><span data-stu-id="fd127-200">You can no longer host Windows Forms controls in the Internet Explorer, because there are better solutions for hosting controls on the Web.</span></span> <span data-ttu-id="fd127-201">因此，IEHost.dll 和 IEExec.exe 組件已經從 .NET Framework 中予以移除。</span><span class="sxs-lookup"><span data-stu-id="fd127-201">Therefore, the IEHost.dll and IEExec.exe assemblies have been removed from the .NET Framework.</span></span> | <span data-ttu-id="fd127-202">您可以使用下列技術，在 Web 應用程式進行自訂控制項開發：</span><span class="sxs-lookup"><span data-stu-id="fd127-202">You can use the following technologies for custom control development in Web applications:</span></span><br><br><span data-ttu-id="fd127-203">\* 您可以建立 Silverlight 應用程式，並將它設定成在瀏覽器外部執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-203">\* You can create a Silverlight application and configure it to run outside the browser.</span></span> <span data-ttu-id="fd127-204">如需詳細資訊，請參閱 [Out-of-Browser Support](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29) (瀏覽器外用支援)。</span><span class="sxs-lookup"><span data-stu-id="fd127-204">For more information, see [Out-of-Browser Support](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29).</span></span><br><span data-ttu-id="fd127-205">\* 您可以建置 XAML 瀏覽器應用程式 (XBAP) 來利用 WPF 功能 (用戶端電腦上需要 .NET Framework)。</span><span class="sxs-lookup"><span data-stu-id="fd127-205">\* You can build a XAML browser application (XBAP) to take advantage of WPF capabilities (requires the .NET Framework on client machines).</span></span> <span data-ttu-id="fd127-206">如需詳細資訊，請參閱 [WPF XAML 瀏覽器應用程式概觀](../../../docs/framework/wpf/app-development/wpf-xaml-browser-applications-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="fd127-206">For more information, see [WPF XAML Browser Applications Overview](../../../docs/framework/wpf/app-development/wpf-xaml-browser-applications-overview.md).</span></span> |
| **<span data-ttu-id="fd127-207">HtmlEncode 和 UrlEncode 方法</span><span class="sxs-lookup"><span data-stu-id="fd127-207">HtmlEncode and UrlEncode methods</span></span>** | <span data-ttu-id="fd127-208"><xref:System.Web.HttpUtility> 和 <xref:System.Web.HttpServerUtility> 類別的 `HtmlEncode` 和 `UrlEncode` 方法已更新成編碼單引號字元 (')，如下所示：</span><span class="sxs-lookup"><span data-stu-id="fd127-208">The `HtmlEncode` and `UrlEncode` methods of the <xref:System.Web.HttpUtility> and <xref:System.Web.HttpServerUtility> classes have been updated to encode the single quotation mark character (') as follows:</span></span><br><br><span data-ttu-id="fd127-209">\* `HtmlEncode` 方法會將單引號的執行個體編碼為</span><span class="sxs-lookup"><span data-stu-id="fd127-209">\* The `HtmlEncode` method encodes instances of the single quotation mark as</span></span> `&#39;`<br><span data-ttu-id="fd127-210">\* `UrlEncode` 方法會將單引號的執行個體編碼為</span><span class="sxs-lookup"><span data-stu-id="fd127-210">\* The `UrlEncode` method encodes instances of the single quotation mark as</span></span> `%27` | <span data-ttu-id="fd127-211">檢查您的程式碼，找出使用 `HtmlEncode` 和 `UrlEncode` 方法的位置，並確定編碼變更不會導致影響應用程式的變更。</span><span class="sxs-lookup"><span data-stu-id="fd127-211">Examine your code for places where you use the `HtmlEncode` and `UrlEncode` methods, and make sure that the change in encoding does not result in a change that would affect your application.</span></span> |
| **<span data-ttu-id="fd127-212">ASP.NET 2.0 應用程式中的 HttpException 錯誤</span><span class="sxs-lookup"><span data-stu-id="fd127-212">HttpException errors in ASP.NET 2.0 applications</span></span>** | <span data-ttu-id="fd127-213">在 IIS 6 上啟用 ASP.NET 4 之後，IIS 6 上執行的 ASP.NET 2.0 應用程式 (在 Windows Server 2003 或 Windows Server 2003 R2 中) 可能會產生下列這類錯誤：</span><span class="sxs-lookup"><span data-stu-id="fd127-213">After ASP.NET 4 has been enabled on IIS 6, ASP.NET 2.0 applications that run on IIS 6 (in either Windows Server 2003 or Windows Server 2003 R2) might generate errors such as the following:</span></span> `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | <span data-ttu-id="fd127-214">\* 如果不需要 ASP.NET 4 即可執行網站，請重新對應網站以改成使用 ASP.NET 2.0。</span><span class="sxs-lookup"><span data-stu-id="fd127-214">\* If ASP.NET 4 is not required in order to run the Web site, remap the site to use ASP.NET 2.0 instead.</span></span><br><br><span data-ttu-id="fd127-215">-或-</span><span class="sxs-lookup"><span data-stu-id="fd127-215">-or-</span></span><br><br><span data-ttu-id="fd127-216">\* 如果需要 ASP.NET 4 才能執行網站，請將任何子 ASP.NET 2.0 虛擬目錄移至對應至 ASP.NET 2.0 的不同網站。</span><span class="sxs-lookup"><span data-stu-id="fd127-216">\* If ASP.NET 4 is required in order to run the Web site, move any child ASP.NET 2.0 virtual directories to a different Web site that is mapped to ASP.NET 2.0.</span></span><br><br><span data-ttu-id="fd127-217">-或-</span><span class="sxs-lookup"><span data-stu-id="fd127-217">-or-</span></span><br><br><span data-ttu-id="fd127-218">\* 停用無副檔名 URL。</span><span class="sxs-lookup"><span data-stu-id="fd127-218">\* Disable extensionless URLs.</span></span> <span data-ttu-id="fd127-219">如需詳細資訊，請參閱 ASP.NET 網站之 [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (ASP.NET 4 最新變更) 文件中的＜ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd＞(ASP.NET 2.0 應用程式可以產生可參考 eurl.axd 的 HttpException 錯誤)。</span><span class="sxs-lookup"><span data-stu-id="fd127-219">For more information, see "ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site.</span></span> |
| **<span data-ttu-id="fd127-220">成員資格類型</span><span class="sxs-lookup"><span data-stu-id="fd127-220">Membership types</span></span>** | <span data-ttu-id="fd127-221">ASP.NET 成員資格中使用的某些類型 (例如，<xref:System.Web.Security.MembershipProvider>) 已從 System.Web.dll 移至 System.Web.ApplicationServices.dll 組件。</span><span class="sxs-lookup"><span data-stu-id="fd127-221">Some types (for example, <xref:System.Web.Security.MembershipProvider>) that are used in ASP.NET membership have been moved from System.Web.dll to the System.Web.ApplicationServices.dll assembly.</span></span> <span data-ttu-id="fd127-222">已移動類型，以解析用戶端和擴充 .NET Framework SKU 中類型之間的架構層相依性。</span><span class="sxs-lookup"><span data-stu-id="fd127-222">The types were moved in order to resolve architectural layering dependencies between types in the client and in extended .NET Framework SKUs.</span></span> | <span data-ttu-id="fd127-223">在 ASP.NET 4 專案中使用時，可能無法編譯已從舊版 ASP.NET 升級並使用已移動之成員資格類型的類別庫。</span><span class="sxs-lookup"><span data-stu-id="fd127-223">Class libraries that have been upgraded from earlier versions of ASP.NET and that use membership types that have been moved might fail to compile when used in an ASP.NET 4 project.</span></span> <span data-ttu-id="fd127-224">如果是這樣，請將類別庫專案中的參考新增至 System.Web.ApplicationServices.dll。</span><span class="sxs-lookup"><span data-stu-id="fd127-224">If so, add a reference in the class library project to System.Web.ApplicationServices.dll.</span></span> |
| **<span data-ttu-id="fd127-225">功能表控制項變更</span><span class="sxs-lookup"><span data-stu-id="fd127-225">Menu control changes</span></span>** | <span data-ttu-id="fd127-226"><xref:System.Web.UI.WebControls.Menu> 控制項變更會導致下列行為：</span><span class="sxs-lookup"><span data-stu-id="fd127-226">Changes to the <xref:System.Web.UI.WebControls.Menu> control result in the following behavior:</span></span><br><br><span data-ttu-id="fd127-227">\* 如果 <xref:System.Web.UI.WebControls.MenuRenderingMode> 設定為 `List`，或者 <xref:System.Web.UI.WebControls.MenuRenderingMode> 設定為 `Default` 以及 <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> 設定為 `4.0` 或更新版本，則 <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> 屬性沒有作用。</span><span class="sxs-lookup"><span data-stu-id="fd127-227">\* If <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `List`, or if <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `Default` and <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> is set to `4.0` or later, the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property has no effect.</span></span><br><span data-ttu-id="fd127-228">\* 如果 <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> 和 <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> 屬性中所設定的路徑包含反斜線 (\\)，則不會轉譯映像</span><span class="sxs-lookup"><span data-stu-id="fd127-228">\* If the path that is set in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> and <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> properties contains a backslash (\\), the images do not render.</span></span> <span data-ttu-id="fd127-229">(在舊版 ASP.NET 中，路徑可以包含反斜線)。</span><span class="sxs-lookup"><span data-stu-id="fd127-229">(In earlier versions of ASP.NET, the path could include a backslash.)</span></span> | <span data-ttu-id="fd127-230">\* 設定父代 <xref:System.Web.UI.WebControls.Menu> 控制項的 <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> 或 <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl>，而不是設定個別功能表項目的 <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-230">\* Instead of setting the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property for individual menu items, set the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> of the parent <xref:System.Web.UI.WebControls.Menu> control.</span></span><br><br><span data-ttu-id="fd127-231">-或-</span><span class="sxs-lookup"><span data-stu-id="fd127-231">-or-</span></span><br><br><span data-ttu-id="fd127-232">將 <xref:System.Web.UI.WebControls.MenuRenderingMode> 設定為 `Table`，或將 <xref:System.Web.UI.WebControls.MenuRenderingMode> 設定為 `Default` 並將 <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> 設定為 `3.5`。</span><span class="sxs-lookup"><span data-stu-id="fd127-232">Set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Table`, or set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Default` and set <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> to `3.5`.</span></span> <span data-ttu-id="fd127-233">這些設定可讓 <xref:System.Web.UI.WebControls.Menu> 控制項使用舊版 ASP.NET 中所使用的 HTML 表格型配置。</span><span class="sxs-lookup"><span data-stu-id="fd127-233">These settings cause the <xref:System.Web.UI.WebControls.Menu> control to use the HTML table-based layout that it used in earlier versions of ASP.NET.</span></span><br><span data-ttu-id="fd127-234">\* 如果 <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> 或 <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> 屬性中的路徑包含反斜線 (\\)，請替代斜線字元 (/)。</span><span class="sxs-lookup"><span data-stu-id="fd127-234">\* If the path in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> property contains a backslash (\\), substitute a slash character (/).</span></span> |
| **<span data-ttu-id="fd127-235">Web.config 檔案中的行動組件</span><span class="sxs-lookup"><span data-stu-id="fd127-235">Mobile assembly in Web.config file</span></span>** | <span data-ttu-id="fd127-236">在舊版 ASP.NET 中，System.Web.Mobile.dll 組件參考包含在 `system.web`/`compilation` 之 `assemblies` 區段的根 Web.config 檔案中。</span><span class="sxs-lookup"><span data-stu-id="fd127-236">In previous versions of ASP.NET, a reference to the System.Web.Mobile.dll assembly was included in the root Web.config file in the `assemblies` section under `system.web`/`compilation`.</span></span> <span data-ttu-id="fd127-237">為了改善效能，已移除此組件的參考。</span><span class="sxs-lookup"><span data-stu-id="fd127-237">To improve performance, the reference to this assembly has been removed.</span></span><br><br><span data-ttu-id="fd127-238">注意:System.Web.Mobile.dll 組件和 ASP.NET 行動控制項包含在 ASP.NET 4 中，但已淘汰。</span><span class="sxs-lookup"><span data-stu-id="fd127-238">Note: The System.Web.Mobile.dll assembly and the ASP.NET mobile controls are included in ASP.NET 4, but they are deprecated.</span></span> | <span data-ttu-id="fd127-239">如果您想要使用此組件中的類型，請在根 Web.config 檔案或應用程式 Web.config 檔案中新增組件參考。</span><span class="sxs-lookup"><span data-stu-id="fd127-239">If you want to use types from this assembly, add a reference to the assembly in either the root Web.config file or in an application Web.config file.</span></span> |
| **<span data-ttu-id="fd127-240">輸出快取</span><span class="sxs-lookup"><span data-stu-id="fd127-240">Output caching</span></span>** | <span data-ttu-id="fd127-241">在 ASP.NET 1.0 中，Bug 會讓將 `Location="ServerAndClient"` 指定為輸出快取設定的已快取頁面在回應中發出 `Vary:*` HTTP 標頭。</span><span class="sxs-lookup"><span data-stu-id="fd127-241">In ASP.NET 1.0, a bug caused cached pages that specified `Location="ServerAndClient"` as an output€“cache setting to emit a `Vary:*` HTTP header in the response.</span></span> <span data-ttu-id="fd127-242">這會影響如何告知用戶端瀏覽器永遠不要在本機快取頁面。</span><span class="sxs-lookup"><span data-stu-id="fd127-242">This had the effect of telling client browsers to never cache the page locally.</span></span> <span data-ttu-id="fd127-243">在 ASP.NET 1.1 中，已新增 <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> 方法，其呼叫目的是要隱藏 `Vary:*` 標頭。</span><span class="sxs-lookup"><span data-stu-id="fd127-243">In ASP.NET 1.1, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method was added, which could be called in order to suppress the `Vary:*` header.</span></span> <span data-ttu-id="fd127-244">不過，Bug 報告會指出開發人員不知道現有 `SetOmitVaryStar` 行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-244">However, bug reports suggest that developers are unaware of the existing `SetOmitVaryStar` behavior.</span></span><br><br><span data-ttu-id="fd127-245">在 ASP.NET 4 中，不再從指定下列指示詞的回應中發出 `Vary:*` HTTP 標頭：</span><span class="sxs-lookup"><span data-stu-id="fd127-245">In ASP.NET 4, the `Vary:*` HTTP header is no longer emitted from responses that specify the following directive:</span></span><br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br><span data-ttu-id="fd127-246">因此，不再需要 <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> 方法，即可隱藏 `Vary:*` 標頭。</span><span class="sxs-lookup"><span data-stu-id="fd127-246">As a result, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method is no longer needed in order to suppress the `Vary:*` header.</span></span> <span data-ttu-id="fd127-247">在針對 `Location` 屬性指定 "ServerAndClient" 的應用程式中，將會在瀏覽器中快取頁面，而不需要您呼叫 <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>。</span><span class="sxs-lookup"><span data-stu-id="fd127-247">In applications that specify "ServerAndClient" for the `Location` attribute, pages will be cacheable in the browser without requiring that you call <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>.</span></span> | <span data-ttu-id="fd127-248">如果應用程式中的頁面必須發出 `Vary:*`，則請呼叫 <xref:System.Web.HttpResponse.AppendHeader%2A> 方法，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="fd127-248">If pages in the application must emit `Vary:*`, call the <xref:System.Web.HttpResponse.AppendHeader%2A> method as shown in the following example:</span></span><br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br><span data-ttu-id="fd127-249">或者，您可以將輸出快取 `Location` 屬性的值變更為 "Server"。</span><span class="sxs-lookup"><span data-stu-id="fd127-249">Alternatively, you can change the value of the output caching `Location` attribute to "Server".</span></span> |
| **<span data-ttu-id="fd127-250">頁面剖析</span><span class="sxs-lookup"><span data-stu-id="fd127-250">Page parsing</span></span>** | <span data-ttu-id="fd127-251">在 ASP.NET 4 中，ASP.NET 網頁 (.aspx 檔案) 和使用者控制項 (.ascx 檔案) 的頁面剖析器會比舊版 ASP.NET 更為嚴格，而且標示為無效的標記數目會多於舊版本。</span><span class="sxs-lookup"><span data-stu-id="fd127-251">The page parser for ASP.NET Web pages (.aspx files) and user controls (.ascx files) is stricter in ASP.NET 4 than in earlier versions of ASP.NET, and it flags more markup as invalid than in earlier versions.</span></span> | <span data-ttu-id="fd127-252">檢查頁面執行時所產生的錯誤訊息，並修正從無效標記導致的錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-252">Examine error messages that are produced when a page runs and fix errors that result from invalid markup.</span></span> |
| **<span data-ttu-id="fd127-253">Passport 類型</span><span class="sxs-lookup"><span data-stu-id="fd127-253">Passport types</span></span>** | <span data-ttu-id="fd127-254">基於 Passport 中的變更，ASP.NET 2.0 內建的 Passport 支援過時且不再支援 (現在為 Live ID SDK)。</span><span class="sxs-lookup"><span data-stu-id="fd127-254">The Passport support built into ASP.NET 2.0 is obsolete and is unsupported due to changes in Passport (now Live ID SDK).</span></span> <span data-ttu-id="fd127-255">因此，現在會使用 `ObsoleteAttribute` 屬性標示 <xref:System.Web.Security> 中與 Passport 有關的類型。</span><span class="sxs-lookup"><span data-stu-id="fd127-255">As a result, the types related to Passport in <xref:System.Web.Security> are now marked with the `ObsoleteAttribute` attribute.</span></span> | <span data-ttu-id="fd127-256">變更在 <xref:System.Web.Security> 命名空間中使用 Passport 類型的任何程式碼 (例如，<xref:System.Web.Security.PassportIdentity>) 使用 [SDK](https://go.microsoft.com/fwlink/?LinkId=106346)。</span><span class="sxs-lookup"><span data-stu-id="fd127-256">Change any code you have that uses Passport types in the <xref:System.Web.Security> namespace (for example, <xref:System.Web.Security.PassportIdentity>) to use the [SDK](https://go.microsoft.com/fwlink/?LinkId=106346).</span></span> |
| **<span data-ttu-id="fd127-257">FilePath 屬性中的 PathInfo 資訊</span><span class="sxs-lookup"><span data-stu-id="fd127-257">PathInfo information in the FilePath property</span></span>** | <span data-ttu-id="fd127-258">ASP.NET 4 不再將 `PathInfo` 值包含在 <xref:System.Web.HttpRequest.FilePath>、<xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath> 和 <xref:System.Web.HttpRequest.CurrentExecutionFilePath> 這類屬性的傳回值中。</span><span class="sxs-lookup"><span data-stu-id="fd127-258">ASP.NET 4 no longer includes the `PathInfo` value in the return values from properties such as <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>, and <xref:System.Web.HttpRequest.CurrentExecutionFilePath>.</span></span> <span data-ttu-id="fd127-259">相反地，<xref:System.Web.HttpRequest.PathInfo> 中提供 `PathInfo` 資訊。</span><span class="sxs-lookup"><span data-stu-id="fd127-259">Instead, the `PathInfo` information is available in <xref:System.Web.HttpRequest.PathInfo>.</span></span> <span data-ttu-id="fd127-260">例如，假設有下列 URL 片段：</span><span class="sxs-lookup"><span data-stu-id="fd127-260">For example, imagine the following URL fragment:</span></span><br><br>`/testapp/Action.mvc/SomeAction`<br><br><span data-ttu-id="fd127-261">在舊版 ASP.NET 中，<xref:System.Web.HttpRequest> 屬性具有下列值：</span><span class="sxs-lookup"><span data-stu-id="fd127-261">In earlier versions of ASP.NET, <xref:System.Web.HttpRequest> properties have the following values:</span></span><br><br><span data-ttu-id="fd127-262">\* <xref:System.Web.HttpRequest.FilePath>：</span><span class="sxs-lookup"><span data-stu-id="fd127-262">\* <xref:System.Web.HttpRequest.FilePath>:</span></span> `/testapp/Action.mvc/SomeAction`<br><span data-ttu-id="fd127-263">\* <xref:System.Web.HttpRequest.PathInfo>：(空白)</span><span class="sxs-lookup"><span data-stu-id="fd127-263">\* <xref:System.Web.HttpRequest.PathInfo>: (empty)</span></span><br><br><span data-ttu-id="fd127-264">在 ASP.NET 4 中，<xref:System.Web.HttpRequest> 屬性改為具有下列值：</span><span class="sxs-lookup"><span data-stu-id="fd127-264">In ASP.NET 4, <xref:System.Web.HttpRequest> properties instead have the following values:</span></span><br><br><span data-ttu-id="fd127-265">\* <xref:System.Web.HttpRequest.FilePath>：</span><span class="sxs-lookup"><span data-stu-id="fd127-265">\* <xref:System.Web.HttpRequest.FilePath>:</span></span> `/testapp/Action.mvc`<br><span data-ttu-id="fd127-266">\* <xref:System.Web.HttpRequest.PathInfo>：</span><span class="sxs-lookup"><span data-stu-id="fd127-266">\* <xref:System.Web.HttpRequest.PathInfo>:</span></span> `SomeAction` | <span data-ttu-id="fd127-267">檢查您的程式碼，找出依賴 <xref:System.Web.HttpRequest> 類別之屬性來傳回路徑資訊的位置；請變更程式碼以反映路徑資訊傳回方式的變更。</span><span class="sxs-lookup"><span data-stu-id="fd127-267">Examine your code for places where you rely on properties of the <xref:System.Web.HttpRequest> class to return path information; change the code to reflect the changes in how path information is returned.</span></span> |
| **<span data-ttu-id="fd127-268">要求驗證</span><span class="sxs-lookup"><span data-stu-id="fd127-268">Request validation</span></span>** | <span data-ttu-id="fd127-269">為了改善要求驗證，會在要求生命週期稍早叫用 ASP.NET 要求驗證。</span><span class="sxs-lookup"><span data-stu-id="fd127-269">To improve request validation, the ASP.NET request validation is invoked earlier in the request life cycle.</span></span> <span data-ttu-id="fd127-270">因此，會針對不適用於 .aspx 檔案的要求執行要求驗證，例如 Web 服務和自訂處理常式。</span><span class="sxs-lookup"><span data-stu-id="fd127-270">As a result, request validation runs for requests that are not for .aspx files, such as for Web service calls and for custom handlers.</span></span> <span data-ttu-id="fd127-271">自訂 HTTP 模組在要求處理管線中執行時，要求驗證也會使用中。</span><span class="sxs-lookup"><span data-stu-id="fd127-271">Request validation will also be active when custom HTTP modules are running in the request processing pipeline.</span></span><br><br><span data-ttu-id="fd127-272">基於這項變更，.aspx 檔案以外之資源的要求可能會擲回要求驗證錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-272">As a result of this change, requests for resources other than .aspx files might throw request validation errors.</span></span> <span data-ttu-id="fd127-273">要求管線中所執行的自訂程式碼 (例如，自訂 HTTP 模組) 也可能會擲回要求驗證錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-273">Custom code that runs in the request pipeline (for example, custom HTTP modules) might also throw request validation errors.</span></span> | <span data-ttu-id="fd127-274">如果必要，您可以使用 Web 組態檔中的下列設定，還原為只有觸發要求驗證之 .aspx 頁面的舊行為：</span><span class="sxs-lookup"><span data-stu-id="fd127-274">If necessary, you can revert to the old behavior of having only .aspx pages triggering request validation by using the following setting in the Web configuration file:</span></span><br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br><span data-ttu-id="fd127-275">警告：如果您還原為舊版行為，請確認現有處理常式、模組和其他自訂程式碼中的所有程式碼都會檢查可能為 XSS 攻擊媒介的潛在不安全 HTTP 輸入。</span><span class="sxs-lookup"><span data-stu-id="fd127-275">Warning: If you revert to the old behavior, make sure that all code in existing handlers, modules, and other custom code performs checks for potentially unsafe HTTP inputs that could be XSS attack vectors.</span></span> |
| **<span data-ttu-id="fd127-276">路由</span><span class="sxs-lookup"><span data-stu-id="fd127-276">Routing</span></span>** | <span data-ttu-id="fd127-277">如果您在 Visual Studio 2010 中建立檔案系統網站，而且網站位於資料夾名稱中包含點 (.) 的資料夾，則無法可靠地進行 URL 路由傳送。</span><span class="sxs-lookup"><span data-stu-id="fd127-277">If you create a file system Web site in Visual Studio 2010 and the Web site is in a folder that contains a dot (.) in the folder name, URL routing will not work reliably.</span></span> <span data-ttu-id="fd127-278">從某些虛擬路徑傳回 HTTP 404 錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-278">An HTTP 404 error is returned from some virtual paths.</span></span> <span data-ttu-id="fd127-279">發生原因是 Visual Studio 2010 使用根虛擬目錄的不正確路徑來啟動 Visual Studio 程式開發伺服器。</span><span class="sxs-lookup"><span data-stu-id="fd127-279">This occurs because Visual Studio 2010 launches the Visual Studio Development Server using an incorrect path for the root virtual directory.</span></span> | <span data-ttu-id="fd127-280">\* 在檔案式網站的 [屬性] 頁面中，將 [虛擬路徑] 屬性變更為 "/"。</span><span class="sxs-lookup"><span data-stu-id="fd127-280">\* In the **Properties** page for the file-based Web site, change the **Virtual Path** attribute to "/".</span></span><br><br><span data-ttu-id="fd127-281">-或-</span><span class="sxs-lookup"><span data-stu-id="fd127-281">-or-</span></span><br><br><span data-ttu-id="fd127-282">\* 建立 Web 應用程式專案，而不是網站專案。</span><span class="sxs-lookup"><span data-stu-id="fd127-282">\* Create a Web application project instead of a Web site project.</span></span> <span data-ttu-id="fd127-283">Web 應用程式專案沒有這個問題，而且 URL 路由傳送會運作，即使專案資料夾的名稱中有一個點也是一樣。</span><span class="sxs-lookup"><span data-stu-id="fd127-283">Web application projects do not have this issue, and URL routing works even if the project folder has a dot in its name.</span></span><br><br><span data-ttu-id="fd127-284">-或-</span><span class="sxs-lookup"><span data-stu-id="fd127-284">-or-</span></span><br><br><span data-ttu-id="fd127-285">\* 建立裝載於 IIS 中的 HTTP 網站。</span><span class="sxs-lookup"><span data-stu-id="fd127-285">\* Create an HTTP-based Web site that is hosted in IIS.</span></span> <span data-ttu-id="fd127-286">在虛擬路徑和專案檔資料夾中，裝載 IIS 的網站可以有點。</span><span class="sxs-lookup"><span data-stu-id="fd127-286">IIS-hosted Web sites can have dots in the virtual path as well as in the project file folder.</span></span> |
| **<span data-ttu-id="fd127-287">SharePoint 網站</span><span class="sxs-lookup"><span data-stu-id="fd127-287">SharePoint sites</span></span>** | <span data-ttu-id="fd127-288">如果您嘗試執行的 ASP.NET 4 網站部署為 SharePoint 網站的子系，而其包含名為 `WSS_Minimal` 的自訂部分信任層級，則會看到下列錯誤：</span><span class="sxs-lookup"><span data-stu-id="fd127-288">If you try to run an ASP.NET 4 Web site that is deployed as a child of a SharePoint Web site that contains a custom partial-trust level named `WSS_Minimal`, you will see the following error:</span></span><br><br>`Could not find permission set named 'ASP.Net'.` | <span data-ttu-id="fd127-289">目前，沒有 SharePoint 版本與 ASP.NET 相容。</span><span class="sxs-lookup"><span data-stu-id="fd127-289">Currently, no versions of SharePoint are compatible with ASP.NET.</span></span> <span data-ttu-id="fd127-290">因此，您不應該嘗試將 ASP.NET 4 網站執行為 SharePoint 網站子系。</span><span class="sxs-lookup"><span data-stu-id="fd127-290">As a result, you should not attempt to run an ASP.NET 4 Web site as a child of a SharePoint Web site.</span></span> |
| **<span data-ttu-id="fd127-291">XHTML 1.1 標準</span><span class="sxs-lookup"><span data-stu-id="fd127-291">XHTML 1.1 standards</span></span>** | <span data-ttu-id="fd127-292">若要啟用新網站的 XHTML 1.1 合規性，.NET Framework 4 中的 ASP.NET 控制項會產生符合 XHTML 1.1 標準的 HTML。</span><span class="sxs-lookup"><span data-stu-id="fd127-292">To enable XHTML 1.1 compliance for new Web sites, the ASP.NET controls in the .NET Framework 4 will generate XHTML 1.1 compliant HTML.</span></span> <span data-ttu-id="fd127-293">在 `<system.Web>` 項目的 Web.config 檔案中使用下列選項，以啟用這項轉譯：</span><span class="sxs-lookup"><span data-stu-id="fd127-293">This rendering is enabled using the following option in the Web.config file inside the `<system.Web>` element:</span></span><br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br><span data-ttu-id="fd127-294">此選項預設為 4.0。</span><span class="sxs-lookup"><span data-stu-id="fd127-294">This option is set by default to 4.0.</span></span> <span data-ttu-id="fd127-295">基於相容性，從 Visual Studio 2008 升級的 Web 專案會啟用 3.5 設定。</span><span class="sxs-lookup"><span data-stu-id="fd127-295">Web projects that are upgraded from Visual Studio 2008 have the 3.5 setting enabled for compatibility.</span></span> | <span data-ttu-id="fd127-296">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-296">None.</span></span> |

## <a name="core"></a><span data-ttu-id="fd127-297">核心</span><span class="sxs-lookup"><span data-stu-id="fd127-297">Core</span></span>

### <a name="general-features"></a><span data-ttu-id="fd127-298">一般功能</span><span class="sxs-lookup"><span data-stu-id="fd127-298">General features</span></span>

| <span data-ttu-id="fd127-299">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-299">Feature</span></span> | <span data-ttu-id="fd127-300">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-300">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-301">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-301">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-302">CardSpace</span><span class="sxs-lookup"><span data-stu-id="fd127-302">CardSpace</span></span>** | <span data-ttu-id="fd127-303">Windows CardSpace 不再包含於 .NET Framework 中；它會個別予以提供。</span><span class="sxs-lookup"><span data-stu-id="fd127-303">Windows CardSpace is no longer included in the .NET Framework; it is provided separately.</span></span> | <span data-ttu-id="fd127-304">請從 [Microsoft 下載中心](https://go.microsoft.com/fwlink/?LinkId=199868)下載 Windows CardSpace。</span><span class="sxs-lookup"><span data-stu-id="fd127-304">Download Windows CardSpace from the [Microsoft Download Center](https://go.microsoft.com/fwlink/?LinkId=199868).</span></span> |
| **<span data-ttu-id="fd127-305">組態檔</span><span class="sxs-lookup"><span data-stu-id="fd127-305">Configuration files</span></span>** | <span data-ttu-id="fd127-306">已更正 .NET Framework 如何存取應用程式組態檔。</span><span class="sxs-lookup"><span data-stu-id="fd127-306">Corrections have been made in how the .NET Framework accesses application configuration files.</span></span> | <span data-ttu-id="fd127-307">如果您的應用程式組態檔命名為 *application-name.config*，請將它重新命名為 *application-name.exe.config*。例如，將 *MyApp.config* 重新命名為 *MyApp.exe.config*。</span><span class="sxs-lookup"><span data-stu-id="fd127-307">If your application configuration file is named *application-name.config*, rename it to *application-name.exe.config*. For example, rename *MyApp.config* to *MyApp.exe.config*.</span></span> |
| **<span data-ttu-id="fd127-308">C# 程式碼編譯器</span><span class="sxs-lookup"><span data-stu-id="fd127-308">C# code compiler</span></span>** | <span data-ttu-id="fd127-309">已在 <xref:Microsoft.CSharp> 命名空間中的 `Compiler`、`CompilerError` 和 `ErrorLevel` 類別不再可用，而其組件 (cscompmgd.dll) 不再包含於 .NET Framework 中。</span><span class="sxs-lookup"><span data-stu-id="fd127-309">The `Compiler`, `CompilerError`, and `ErrorLevel` classes that were in the <xref:Microsoft.CSharp> namespace are no longer available, and their assembly (cscompmgd.dll) is no longer included in the .NET Framework.</span></span> | <span data-ttu-id="fd127-310">在 <xref:System.CodeDom.Compiler> 命名空間中使用 <xref:System.CodeDom.Compiler.CodeDomProvider> 類別和其他類別。</span><span class="sxs-lookup"><span data-stu-id="fd127-310">Use the <xref:System.CodeDom.Compiler.CodeDomProvider> class and other classes in the <xref:System.CodeDom.Compiler> namespace.</span></span> <span data-ttu-id="fd127-311">如需詳細資訊，請參閱[使用 CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29)。</span><span class="sxs-lookup"><span data-stu-id="fd127-311">For more information, see [Using the CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29).</span></span> |
| <span data-ttu-id="fd127-312">**裝載** (Unmanaged API)</span><span class="sxs-lookup"><span data-stu-id="fd127-312">**Hosting** (unmanaged API)</span></span> | <span data-ttu-id="fd127-313">為了改善裝載功能，有些裝載啟用 API 已遭取代。</span><span class="sxs-lookup"><span data-stu-id="fd127-313">To improve hosting capabilities, some of the hosting activation APIs have been deprecated.</span></span> <span data-ttu-id="fd127-314">同處理序並存執行功能可讓應用程式在相同的處理序中載入和啟動多個版本的 .NET Framework。</span><span class="sxs-lookup"><span data-stu-id="fd127-314">In-process side-by-side execution features enable an application to load and start multiple versions of the .NET Framework in the same process.</span></span> <span data-ttu-id="fd127-315">例如，您可以執行的應用程式會在相同的處理序中載入根據 .NET Framework 2.0 SP1 的增益集 (或元件) 以及根據 .NET Framework 4 的增益集。</span><span class="sxs-lookup"><span data-stu-id="fd127-315">For example, you can run applications that load add-ins (or components) that are based on the .NET Framework 2.0 SP1 and add-ins that are based on the .NET Framework 4 in the same process.</span></span> <span data-ttu-id="fd127-316">舊元件會繼續使用舊版 .NET Framework，新元件則會使用新版 .NET Framework。</span><span class="sxs-lookup"><span data-stu-id="fd127-316">Older components continue to use the older .NET Framework version, and new components use the new .NET Framework version.</span></span> | <span data-ttu-id="fd127-317">使用[同處理序並存執行](../../../docs/framework/deployment/in-process-side-by-side-execution.md)中所述的組態。</span><span class="sxs-lookup"><span data-stu-id="fd127-317">Use the configurations described in [In-Process Side-by-Side Execution](../../../docs/framework/deployment/in-process-side-by-side-execution.md).</span></span> |
| **<span data-ttu-id="fd127-318">新的安全性模型</span><span class="sxs-lookup"><span data-stu-id="fd127-318">New security model</span></span>** | <span data-ttu-id="fd127-319">程式碼存取安全性 (CAS) 原則已關閉並取代為簡化模型，如 [.NET Framework 4 中的安全性變更](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29)中所述。</span><span class="sxs-lookup"><span data-stu-id="fd127-319">The code access security (CAS) policy has been turned off and replaced with a simplified model, as described in [Security Changes in the .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29).</span></span> | <span data-ttu-id="fd127-320">如果您取決於應用程式中的 CAS，則可能需要修改。</span><span class="sxs-lookup"><span data-stu-id="fd127-320">Modifications may be required if you depend on CAS in your applications.</span></span> <span data-ttu-id="fd127-321">如需詳細資訊，請參閱[程式碼存取安全性原則相容性和移轉](../../../docs/framework/misc/code-access-security-policy-compatibility-and-migration.md)。</span><span class="sxs-lookup"><span data-stu-id="fd127-321">For more information, see [Code Access Security Policy Compatibility and Migration](../../../docs/framework/misc/code-access-security-policy-compatibility-and-migration.md).</span></span> |

### <a name="date-and-time"></a><span data-ttu-id="fd127-322">日期和時間</span><span class="sxs-lookup"><span data-stu-id="fd127-322">Date and time</span></span>

<span data-ttu-id="fd127-323">命名空間：<xref:System>；組件：mscorlib (在 mscorlib.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-323">Namespace: <xref:System>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="fd127-324">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-324">Feature</span></span> | <span data-ttu-id="fd127-325">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-325">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-326">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-326">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-327">日光節約時間</span><span class="sxs-lookup"><span data-stu-id="fd127-327">Daylight savings</span></span>** | <span data-ttu-id="fd127-328">為了與系統時鐘一致，時間屬性 (例如 <xref:System.TimeZoneInfo.Local> 和 <xref:System.DateTime.Now>) 現在會使用作業系統規則，而不是日光節約時間作業的其他 .NET Framework 資料。</span><span class="sxs-lookup"><span data-stu-id="fd127-328">To be consistent with the system clock, time properties (such as <xref:System.TimeZoneInfo.Local> and <xref:System.DateTime.Now>) now use operating system rules instead of other .NET Framework data for daylight saving time operations.</span></span> | <span data-ttu-id="fd127-329">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-329">None.</span></span> |
| **<span data-ttu-id="fd127-330">格式字串</span><span class="sxs-lookup"><span data-stu-id="fd127-330">Formatting strings</span></span>** | <span data-ttu-id="fd127-331">為了支援區分文化特性格式，除了新 `ParseExact` 和 `TryParseExact` 方法之外，<xref:System.TimeSpan> 結構還包含 `ToString`、`Parse` 和 `TryParse` 方法的新多載。</span><span class="sxs-lookup"><span data-stu-id="fd127-331">To support culture-sensitive formatting, the <xref:System.TimeSpan> structure includes new overloads of the `ToString`, `Parse`, and `TryParse` methods in addition to new `ParseExact` and `TryParseExact` methods.</span></span> | <span data-ttu-id="fd127-332">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-332">None.</span></span> |

### <a name="globalization"></a><span data-ttu-id="fd127-333">全球化</span><span class="sxs-lookup"><span data-stu-id="fd127-333">Globalization</span></span>

<span data-ttu-id="fd127-334">如需新中性和特定文化特性的清單，請參閱[全球化和當地語系化的新功能](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29)。</span><span class="sxs-lookup"><span data-stu-id="fd127-334">For a list of new neutral and specific cultures, see [What's New in Globalization and Localization](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).</span></span>

<span data-ttu-id="fd127-335">命名空間：<xref:System.Globalization>；組件：mscorlib (在 mscorlib.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-335">Namespace: <xref:System.Globalization>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="fd127-336">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-336">Feature</span></span> | <span data-ttu-id="fd127-337">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-337">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-338">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-338">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-339">文化特性名稱</span><span class="sxs-lookup"><span data-stu-id="fd127-339">Culture names</span></span>** | <span data-ttu-id="fd127-340">下列名稱變更會影響德文、迪維西文和非洲文文化特性：</span><span class="sxs-lookup"><span data-stu-id="fd127-340">The following name changes affect the German, Divehi, and African cultures:</span></span><br><br><span data-ttu-id="fd127-341">\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>：德文 (瑞士) (de-CH) 文化特性的貨幣名稱已從 "sFr." 變更</span><span class="sxs-lookup"><span data-stu-id="fd127-341">\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: The currency name for the German (Switizerland) (de-CH) culture has changed from "sFr."</span></span> <span data-ttu-id="fd127-342">為 "Fr."。</span><span class="sxs-lookup"><span data-stu-id="fd127-342">to "Fr.".</span></span><br><span data-ttu-id="fd127-343">\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>：迪維西文 (馬爾地夫) (dv-MV) 文化特性的完整日期模式已從 "dd/MMMM/yyyy" 變更為 "dd/MM/yyyy"。</span><span class="sxs-lookup"><span data-stu-id="fd127-343">\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: The long date pattern for the Divehi (Maldives) (dv-MV) culture has changed from "dd/MMMM/yyyy" to "dd/MM/yyyy".</span></span><br><span data-ttu-id="fd127-344">\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>：南非荷蘭文 </span><span class="sxs-lookup"><span data-stu-id="fd127-344">\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: The P.M.</span></span> <span data-ttu-id="fd127-345">南非荷蘭文 (南非) (af-ZA) 文化特性的 P.M. 指示項已從 "nm" 變更為 "PM"。</span><span class="sxs-lookup"><span data-stu-id="fd127-345">designator of the Afrikaans (South Africa) (af-ZA) culture has changed from "nm" to "PM".</span></span> | <span data-ttu-id="fd127-346">請注意文化特性名稱的變更。</span><span class="sxs-lookup"><span data-stu-id="fd127-346">Note culture name changes.</span></span> |
| **<span data-ttu-id="fd127-347">LCID 參數</span><span class="sxs-lookup"><span data-stu-id="fd127-347">LCID parameter</span></span>** | <span data-ttu-id="fd127-348">為了與自動化伺服器設定中的預期行為一致，CLR 不再將 `LCID` 參數的目前文化特性 (Culture) 傳遞給未受管理的 COM 應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-348">To be consistent with expected behavior in automation server settings, the CLR no longer passes the current culture for the `LCID` parameter to unmanaged COM-based applications.</span></span> <span data-ttu-id="fd127-349">相反地，它會傳遞文化特性的 1033 (en-us)。</span><span class="sxs-lookup"><span data-stu-id="fd127-349">Instead, it passes 1033 (en-us) for the culture.</span></span> | <span data-ttu-id="fd127-350">不需要進行任何修改，但需要所指定文化特性的原生應用程式除外。</span><span class="sxs-lookup"><span data-stu-id="fd127-350">No modifications necessary except for native applications that require a specified culture.</span></span> |
| **<span data-ttu-id="fd127-351">過時的文化特性類型</span><span class="sxs-lookup"><span data-stu-id="fd127-351">Obsolete culture types</span></span>** | <span data-ttu-id="fd127-352"><xref:System.Globalization.CultureTypes> 和 <xref:System.Globalization.CultureTypes> 文化特性類型現在已過時。</span><span class="sxs-lookup"><span data-stu-id="fd127-352">The <xref:System.Globalization.CultureTypes> and <xref:System.Globalization.CultureTypes> culture types are now obsolete.</span></span><br><br><span data-ttu-id="fd127-353">基於回溯相容性，<xref:System.Globalization.CultureTypes> 現在會傳回舊版 .NET Framework 所含的中性和特定文化特性，<xref:System.Globalization.CultureTypes> 現在則會傳回空清單。</span><span class="sxs-lookup"><span data-stu-id="fd127-353">For backward compatibility, <xref:System.Globalization.CultureTypes> now returns neutral and specific cultures that were included with the previous .NET Framework, and <xref:System.Globalization.CultureTypes> now returns an empty list.</span></span> | <span data-ttu-id="fd127-354">使用 <xref:System.Globalization.CultureTypes> 列舉的其他值。</span><span class="sxs-lookup"><span data-stu-id="fd127-354">Use other values of the <xref:System.Globalization.CultureTypes> enumeration.</span></span> |
| **<span data-ttu-id="fd127-355">擷取文化特性</span><span class="sxs-lookup"><span data-stu-id="fd127-355">Retrieving culture</span></span>** | <span data-ttu-id="fd127-356">從 Windows 7 開始，.NET Framework 4 會從作業系統擷取文化特性資訊，而不是儲存資料本身。</span><span class="sxs-lookup"><span data-stu-id="fd127-356">Beginning with Windows 7, the .NET Framework 4 retrieves culture information from the operating system instead of storing the data itself.</span></span> <span data-ttu-id="fd127-357">此外，.NET Framework 會與 Windows 同步，以排序資料以及設定資料大小寫。</span><span class="sxs-lookup"><span data-stu-id="fd127-357">In addition, the .NET Framework synchronizes with Windows for sorting and casing data.</span></span> | <span data-ttu-id="fd127-358">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-358">None.</span></span> |
| **<span data-ttu-id="fd127-359">Unicode 5.1 標準</span><span class="sxs-lookup"><span data-stu-id="fd127-359">Unicode 5.1 standards</span></span>** | <span data-ttu-id="fd127-360">.NET Framework 現在支援所有 Unicode 5.1 字元，大約新增 1400 個字元。</span><span class="sxs-lookup"><span data-stu-id="fd127-360">The .NET Framework now supports all Unicode 5.1 characters -- an addition of approximately 1400 characters.</span></span> <span data-ttu-id="fd127-361">其他字元包含新的符號、箭號、變音符號、標點符號、數學符號、CJK 筆劃和表意字元、其他馬來亞拉姆文和特拉古文數字字元，以及各種緬甸、拉丁、阿拉伯文、希臘文、蒙古文和斯拉夫字元。</span><span class="sxs-lookup"><span data-stu-id="fd127-361">The additional characters include new symbols, arrows, diacritics, punctuation, mathematical symbols, CJK strokes and ideographs, additional Malayalam and Telugu numeric characters, and various Myanmar, Latin, Arabic, Greek, Mongolian, and Cyrillic characters.</span></span> <span data-ttu-id="fd127-362">Unicode 5.1 支援下列新的指令碼：巽丹文、雷布查文、桑塔爾文、范文、紹拉斯徹文、開亞里文、拉讓文、果魯穆奇文、歐迪亞文、坦米爾文、泰盧固文，以及馬來亞拉姆文字元及查姆文。</span><span class="sxs-lookup"><span data-stu-id="fd127-362">The following new scripts are supported with Unicode 5.1: Sundanese, Lepcha, Ol Chiki, Vai, Saurashtra, Kayah Li, Rejang, Gurmukhi, Odia, Tamil, Telugu, and Malayalam characters and Cham.</span></span> | <span data-ttu-id="fd127-363">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-363">None.</span></span> |

### <a name="exceptions"></a><span data-ttu-id="fd127-364">例外狀況</span><span class="sxs-lookup"><span data-stu-id="fd127-364">Exceptions</span></span>

<span data-ttu-id="fd127-365">命名空間：<xref:System>、<xref:System.Runtime.ExceptionServices>；組件：mscorlib (在 mscorlib.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-365">Namespaces: <xref:System>, <xref:System.Runtime.ExceptionServices>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="fd127-366">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-366">Feature</span></span> | <span data-ttu-id="fd127-367">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-367">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-368">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-368">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-369">損毀處理序狀態的例外狀況</span><span class="sxs-lookup"><span data-stu-id="fd127-369">Exceptions for corrupted process state</span></span>** | <span data-ttu-id="fd127-370">CLR 不再將損毀處理序狀態的例外狀況傳遞給 Managed 程式碼中的例外狀況處理常式。</span><span class="sxs-lookup"><span data-stu-id="fd127-370">The CLR no longer delivers exceptions for corrupted process state to exception handlers in managed code.</span></span> | <span data-ttu-id="fd127-371">這些例外狀況指出處理序狀態已損毀。</span><span class="sxs-lookup"><span data-stu-id="fd127-371">These exceptions indicate that the state of a process has been corrupted.</span></span> <span data-ttu-id="fd127-372">不建議您在此狀態下執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-372">We do not recommend that you run your application in this state.</span></span><br><br><span data-ttu-id="fd127-373">如需詳細資訊，請參閱 <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> 以及 CLR Inside Out 部落格中的項目[Handling Corrupted State Exceptions](https://go.microsoft.com/fwlink/?LinkID=179681) (處理損毀的狀態例外狀況)。</span><span class="sxs-lookup"><span data-stu-id="fd127-373">For more information, see the <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> and the entry [Handling Corrupted State Exceptions](https://go.microsoft.com/fwlink/?LinkID=179681) in the CLR Inside Out blog.</span></span> |
| **<span data-ttu-id="fd127-374">執行引擎例外狀況</span><span class="sxs-lookup"><span data-stu-id="fd127-374">Execution engine exceptions</span></span>** | <xref:System.ExecutionEngineException> <span data-ttu-id="fd127-375">現在已過時，因為可攔截的例外狀況允許不穩定的處理序繼續執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-375">is now obsolete, because a catchable exception will allow an unstable process to continue to run.</span></span> <span data-ttu-id="fd127-376">這項變更可改善執行階段中的預測性和可靠性。</span><span class="sxs-lookup"><span data-stu-id="fd127-376">This change improves predictability and reliability in the runtime.</span></span> | <span data-ttu-id="fd127-377">使用 <xref:System.InvalidOperationException> 對條件發出信號。</span><span class="sxs-lookup"><span data-stu-id="fd127-377">Use an <xref:System.InvalidOperationException> to signal the condition.</span></span> |

### <a name="reflection"></a><span data-ttu-id="fd127-378">反射</span><span class="sxs-lookup"><span data-stu-id="fd127-378">Reflection</span></span>

<span data-ttu-id="fd127-379">命名空間：<xref:System.Reflection>；組件：mscorlib (在 mscorlib.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-379">Namespace: <xref:System.Reflection>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="fd127-380">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-380">Feature</span></span> | <span data-ttu-id="fd127-381">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-381">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-382">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-382">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-383">組件雜湊演算法</span><span class="sxs-lookup"><span data-stu-id="fd127-383">Assembly hash algorithms</span></span>** | <span data-ttu-id="fd127-384">因為執行階段在未載入所參考組件時不知道組件的雜湊演算法，所以 <xref:System.Reflection.AssemblyName.HashAlgorithm> 屬性現在會傳回 <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm></span><span class="sxs-lookup"><span data-stu-id="fd127-384">The <xref:System.Reflection.AssemblyName.HashAlgorithm> property now returns <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, because the runtime does not know the hash algorithm of the referenced assembly when the assembly is not loaded.</span></span> <span data-ttu-id="fd127-385">(這指的是使用 <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> 方法所傳回的所參考組件的屬性)。</span><span class="sxs-lookup"><span data-stu-id="fd127-385">(This refers to using the property on a referenced assembly such as that returned by the <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> method.)</span></span> | <span data-ttu-id="fd127-386">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-386">None.</span></span> |
| **<span data-ttu-id="fd127-387">組件載入</span><span class="sxs-lookup"><span data-stu-id="fd127-387">Assembly loading</span></span>** | <span data-ttu-id="fd127-388">為了避免重複載入組件，以及儲存虛擬位址空間，CLR 現在只會使用 Win32 `MapViewOfFile` 函式載入組件。</span><span class="sxs-lookup"><span data-stu-id="fd127-388">To prevent redundant loading of assemblies and to save virtual address space, the CLR now loads assemblies by using only the Win32 `MapViewOfFile` function.</span></span> <span data-ttu-id="fd127-389">它也不再呼叫 `LoadLibrary` 函式。</span><span class="sxs-lookup"><span data-stu-id="fd127-389">It no longer also calls the `LoadLibrary` function.</span></span><br><br><span data-ttu-id="fd127-390">這項變更會以下列方式影響診斷應用程式：</span><span class="sxs-lookup"><span data-stu-id="fd127-390">This change affects diagnostic applications in the following ways:</span></span><br><br><span data-ttu-id="fd127-391">\* <xref:System.Diagnostics.ProcessModuleCollection> 將不再包含從 `Process.GetCurrentProcess().Modules` 呼叫取得之類別庫 (.dll 檔案) 中的任何模組。</span><span class="sxs-lookup"><span data-stu-id="fd127-391">\* A <xref:System.Diagnostics.ProcessModuleCollection> will no longer contain any modules from a class library (.dll file), as obtained from a call to `Process.GetCurrentProcess().Modules`.</span></span><br><span data-ttu-id="fd127-392">\* 使用 `EnumProcessModules` 函式的 Win32 應用程式看不到所有列出的受管理模組。</span><span class="sxs-lookup"><span data-stu-id="fd127-392">\* Win32 applications that use the `EnumProcessModules` function will not see all managed modules listed.</span></span> | <span data-ttu-id="fd127-393">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-393">None.</span></span> |
| **<span data-ttu-id="fd127-394">宣告類型</span><span class="sxs-lookup"><span data-stu-id="fd127-394">Declaring type</span></span>** | <span data-ttu-id="fd127-395">類型沒有宣告類型時，<xref:System.Type.DeclaringType> 屬性現在會正確地傳回 Null。</span><span class="sxs-lookup"><span data-stu-id="fd127-395">The <xref:System.Type.DeclaringType> property now correctly returns null when the type does not have a declaring type.</span></span> | <span data-ttu-id="fd127-396">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-396">None.</span></span> |
| **<span data-ttu-id="fd127-397">委派</span><span class="sxs-lookup"><span data-stu-id="fd127-397">Delegates</span></span>** | <span data-ttu-id="fd127-398">將 Null 值傳遞給委派的建構函式時，委派現在會擲回 <xref:System.ArgumentNullException>，而不是 <xref:System.NullReferenceException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-398">A delegate now throws an <xref:System.ArgumentNullException> instead of a <xref:System.NullReferenceException> when a null value is passed to the delegate's constructor.</span></span> | <span data-ttu-id="fd127-399">請確定任何例外狀況處理攔截到 <xref:System.ArgumentNullException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-399">Ensure that any exception handling catches <xref:System.ArgumentNullException>.</span></span> |
| **<span data-ttu-id="fd127-400">全域組件快取位置變更</span><span class="sxs-lookup"><span data-stu-id="fd127-400">Global assembly cache location change</span></span>** | <span data-ttu-id="fd127-401">針對 .NET Framework 4 組件，已將全域組件快取從 Windows 目錄 (%WINDIR%) 移至 Microsoft.Net 子目錄 (*%WINDIR%\\Microsoft.Net*)。</span><span class="sxs-lookup"><span data-stu-id="fd127-401">For .NET Framework 4 assemblies, the global assembly cache has been moved from the Windows directory (%WINDIR%) to the Microsoft.Net subdirectory (*%WINDIR%\\Microsoft.Net*).</span></span> <span data-ttu-id="fd127-402">舊版本中的組件會保留在較舊的目錄中。</span><span class="sxs-lookup"><span data-stu-id="fd127-402">Assemblies from earlier versions remain in the older directory.</span></span><br><br><span data-ttu-id="fd127-403">未受管理的 [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) 列舉包含新的 `ASM_CACHE_ROOT_EX` 旗標。</span><span class="sxs-lookup"><span data-stu-id="fd127-403">The unmanaged [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) enumeration contains the new `ASM_CACHE_ROOT_EX` flag.</span></span> <span data-ttu-id="fd127-404">此旗標會取得 .NET Framework 4 組件的快取位置，而快取位置可以透過 [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md) 函式取得。</span><span class="sxs-lookup"><span data-stu-id="fd127-404">This flag gets the cache location for .NET Framework 4 assemblies, which can be obtained by the [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md) function.</span></span> | <span data-ttu-id="fd127-405">無，假設應用程式未使用組件的明確路徑，這不是建議的作法。</span><span class="sxs-lookup"><span data-stu-id="fd127-405">None, assuming that applications do not use explicit paths to assemblies, which is not a recommended practice.</span></span> |
| **<span data-ttu-id="fd127-406">全域組件快取工具</span><span class="sxs-lookup"><span data-stu-id="fd127-406">Global assembly cache tool</span></span>** | <span data-ttu-id="fd127-407">[Gacutil.exe (全域組件快取工具)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) 不再支援殼層外掛程式檢視器。</span><span class="sxs-lookup"><span data-stu-id="fd127-407">The [Gacutil.exe (Global Assembly Cache Tool)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) no longer supports the shell plugin viewer.</span></span> | <span data-ttu-id="fd127-408">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-408">None.</span></span> |

### <a name="interoperability"></a><span data-ttu-id="fd127-409">互通性</span><span class="sxs-lookup"><span data-stu-id="fd127-409">Interoperability</span></span>

<span data-ttu-id="fd127-410">命名空間：<xref:System.Runtime.InteropServices>；組件：mscorlib (在 mscorlib.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-410">Namespace: <xref:System.Runtime.InteropServices>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="fd127-411">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-411">Feature</span></span> | <span data-ttu-id="fd127-412">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-412">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-413">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-413">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="fd127-414">**緩衝區長度** (Unmanaged API)</span><span class="sxs-lookup"><span data-stu-id="fd127-414">**Buffer length** (unmanaged API)</span></span> | <span data-ttu-id="fd127-415">為了節省記憶體，[ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) 方法之 `pBufferLengthOffset` 參數的功能已變更成符合 `pStringLengthOffset` 參數。</span><span class="sxs-lookup"><span data-stu-id="fd127-415">To save memory, the functionality for the `pBufferLengthOffset` parameter for the [ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) method has been changed to match the `pStringLengthOffset` parameter.</span></span> <span data-ttu-id="fd127-416">這兩個參數現在會指向字串長度的位移位置。</span><span class="sxs-lookup"><span data-stu-id="fd127-416">Both parameters now point to the offset location of the string's length.</span></span> <span data-ttu-id="fd127-417">已從字串類別呈現移除緩衝區長度。</span><span class="sxs-lookup"><span data-stu-id="fd127-417">Buffer length has been removed from the representation of the string class.</span></span> | <span data-ttu-id="fd127-418">移除緩衝區長度的任何相依性。</span><span class="sxs-lookup"><span data-stu-id="fd127-418">Remove any dependency on the buffer length.</span></span> |
| **<span data-ttu-id="fd127-419">JIT 偵錯</span><span class="sxs-lookup"><span data-stu-id="fd127-419">JIT debugging</span></span>** | <span data-ttu-id="fd127-420">若要簡化 Just-In-Time (JIT) 偵錯的註冊，.NET Framework 偵錯工具現在只會使用 AeDebug 登錄機碼，以控制機器碼的 JIT 偵錯行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-420">To simplify registration for just-in-time (JIT) debugging, the .NET Framework debugger now uses only the AeDebug registry key, which controls the JIT debugging behavior for native code.</span></span> <span data-ttu-id="fd127-421">這項變更會導致下列各項：</span><span class="sxs-lookup"><span data-stu-id="fd127-421">This change results in the following:</span></span><br><br><span data-ttu-id="fd127-422">\* 您無法再針對 Managed 和機器碼註冊兩個不同的偵錯工具。</span><span class="sxs-lookup"><span data-stu-id="fd127-422">\* You can no longer register two different debuggers for managed and native code.</span></span><br><span data-ttu-id="fd127-423">\* 您可以不再針對非互動式處理序自動啟動偵錯工具，但可以提示使用者進行互動式處理序。</span><span class="sxs-lookup"><span data-stu-id="fd127-423">\* You can no longer start the debugger automatically for a non-interactive process, but you can prompt the user for an interactive process.</span></span><br><span data-ttu-id="fd127-424">\* 在無法啟動偵錯工具時，或沒有應該啟動的註冊偵錯工具時，不再通知您。</span><span class="sxs-lookup"><span data-stu-id="fd127-424">\* You are no longer notified when the debugger fails to start, or when there is no registered debugger that should be started.</span></span><br><span data-ttu-id="fd127-425">\* 不再支援取決於應用程式互動性的自動啟動原則。</span><span class="sxs-lookup"><span data-stu-id="fd127-425">\* Auto-launch policies that depend on the interactivity of the application are no longer supported.</span></span> | <span data-ttu-id="fd127-426">依需要調整偵錯作業。</span><span class="sxs-lookup"><span data-stu-id="fd127-426">Adjust debugging operations as required.</span></span> |
| **<span data-ttu-id="fd127-427">平台叫用</span><span class="sxs-lookup"><span data-stu-id="fd127-427">Platform invoke</span></span>** | <span data-ttu-id="fd127-428">為了改善與 Unmanaged 程式碼之互通性的效能，平台叫用中的不正確呼叫慣例現在會讓應用程式失敗。</span><span class="sxs-lookup"><span data-stu-id="fd127-428">To improve performance in interoperability with unmanaged code, incorrect calling conventions in a platform invoke now cause the application to fail.</span></span> <span data-ttu-id="fd127-429">在舊版本中，封送處理層會解析堆疊中的這些錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-429">In previous versions, the marshaling layer resolved these errors up the stack.</span></span> | <span data-ttu-id="fd127-430">對 Microsoft Visual Studio 中的應用程式進行偵錯將會警告您發生這些錯誤，因此您可以更正它們。</span><span class="sxs-lookup"><span data-stu-id="fd127-430">Debugging your applications in Microsoft Visual Studio alerts you to these errors so you can correct them.</span></span><br><br><span data-ttu-id="fd127-431">如果您有無法更新的二進位檔，則可以將 [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) 項目包含在您應用程式的組態檔中，以解決舊版堆疊中的呼叫錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-431">If you have binaries that cannot be updated, you can include the [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) element in your application's configuration file to enable calling errors to be resolved up the stack as in earlier versions.</span></span> <span data-ttu-id="fd127-432">不過，這可能會影響應用程式的效能。</span><span class="sxs-lookup"><span data-stu-id="fd127-432">However, this may affect the performance of your application.</span></span> |
| <span data-ttu-id="fd127-433">**已移除介面** (Unmanaged API)</span><span class="sxs-lookup"><span data-stu-id="fd127-433">**Removed interfaces** (unmanaged API)</span></span> | <span data-ttu-id="fd127-434">為了避免開發人員混淆，已移除下列介面，因為它們未提供任何有用的執行階段案例，而且 CLR 未提供或接受任何實作：</span><span class="sxs-lookup"><span data-stu-id="fd127-434">To avoid developer confusion, the following interfaces were removed, because they did not provide any useful run-time scenarios, and the CLR did not provide or accept any implementations:</span></span><br><br><span data-ttu-id="fd127-435">\* **INativeImageINativeImageDependency**</span><span class="sxs-lookup"><span data-stu-id="fd127-435">\* **INativeImageINativeImageDependency**</span></span><br><span data-ttu-id="fd127-436">\* **INativeImageInstallInfo**</span><span class="sxs-lookup"><span data-stu-id="fd127-436">\* **INativeImageInstallInfo**</span></span><br><span data-ttu-id="fd127-437">\* **INativeImageEvaluate**</span><span class="sxs-lookup"><span data-stu-id="fd127-437">\* **INativeImageEvaluate**</span></span><br><span data-ttu-id="fd127-438">\* **INativeImageConverter**</span><span class="sxs-lookup"><span data-stu-id="fd127-438">\* **INativeImageConverter**</span></span><br><span data-ttu-id="fd127-439">\* **ICorModule**</span><span class="sxs-lookup"><span data-stu-id="fd127-439">\* **ICorModule**</span></span><br><span data-ttu-id="fd127-440">\* **IMetaDataConverter**</span><span class="sxs-lookup"><span data-stu-id="fd127-440">\* **IMetaDataConverter**</span></span> | <span data-ttu-id="fd127-441">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-441">None.</span></span> |

## <a name="data"></a><span data-ttu-id="fd127-442">資料</span><span class="sxs-lookup"><span data-stu-id="fd127-442">Data</span></span>

<span data-ttu-id="fd127-443">本節描述使用資料集和 SQL 用戶端、Entity Framework、LINQ to SQL 和 WCF Data Servers (先前稱為 ADO.NET Data Services) 的移轉問題。</span><span class="sxs-lookup"><span data-stu-id="fd127-443">This section describes migration issues for using data sets and SQL clients, the Entity Framework, LINQ to SQL, and WCF Data Servers (formerly known as ADO.NET Data Services).</span></span>

### <a name="dataset-and-sql-client"></a><span data-ttu-id="fd127-444">DataSet 和 SQL 用戶端</span><span class="sxs-lookup"><span data-stu-id="fd127-444">DataSet and SQL Client</span></span>

<span data-ttu-id="fd127-445">下表描述先前有限制或其他問題之功能的改善。</span><span class="sxs-lookup"><span data-stu-id="fd127-445">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="fd127-446">命名空間：<xref:System.Data>、<xref:System.Data.Objects.DataClasses>、<xref:System.Data.SqlClient>；組件：System.Data (在 System.Data.dll 中)、System.Data.Entity (在 System.Data.Entity.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-446">Namespaces: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; assemblies: System.Data (in System.Data.dll), System.Data.Entity (in System.Data.Entity.dll)</span></span>

| <span data-ttu-id="fd127-447">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-447">Feature</span></span> | <span data-ttu-id="fd127-448">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-448">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-449">POCO 案例</span><span class="sxs-lookup"><span data-stu-id="fd127-449">POCO Scenarios</span></span>** | <span data-ttu-id="fd127-450"><xref:System.Data.Objects.DataClasses.IRelatedEnd> 介面有新的方法可改善其在簡單的 CLR 物件 (POCO) 案例中的使用性。</span><span class="sxs-lookup"><span data-stu-id="fd127-450">The <xref:System.Data.Objects.DataClasses.IRelatedEnd> interface has new methods to improve its usability in Plain Old CLR Object (POCO) scenarios.</span></span> <span data-ttu-id="fd127-451">這些新方法接受 <xref:System.Object> 作為參數，而不接受 <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> 實體。</span><span class="sxs-lookup"><span data-stu-id="fd127-451">These new methods take an <xref:System.Object> instead of an <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> entity as a parameter.</span></span> |
| **<span data-ttu-id="fd127-452">編輯資料列</span><span class="sxs-lookup"><span data-stu-id="fd127-452">Editing Rows</span></span>** | <span data-ttu-id="fd127-453"><xref:System.Data.DataView> 類別所實作的 <xref:System.Collections.IList.IndexOf%2A> 方法現在會正確地傳回所編輯資料列的值，而不是傳回 -1。</span><span class="sxs-lookup"><span data-stu-id="fd127-453">The <xref:System.Collections.IList.IndexOf%2A> method, as implemented by the <xref:System.Data.DataView> class, now correctly returns the value of a row that is being edited, instead of returning -1.</span></span> |
| **<span data-ttu-id="fd127-454">事件</span><span class="sxs-lookup"><span data-stu-id="fd127-454">Events</span></span>** | <span data-ttu-id="fd127-455">現在，資料列處於已修改狀態並呼叫 <xref:System.Data.DataRow.RejectChanges%2A> 方法時，會引發 <xref:System.Data.DataRowView.PropertyChanged> 事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-455">The <xref:System.Data.DataRowView.PropertyChanged> event is now raised when a row is in a modified state and the <xref:System.Data.DataRow.RejectChanges%2A> method is called.</span></span> <span data-ttu-id="fd127-456">這項變更可讓您更輕鬆地建立可公開 <xref:System.Data.DataSet> 物件內容的 UI 控制項。</span><span class="sxs-lookup"><span data-stu-id="fd127-456">This change makes it easier to create UI controls that expose the contents of a <xref:System.Data.DataSet> object.</span></span> |
| **<span data-ttu-id="fd127-457">例外狀況</span><span class="sxs-lookup"><span data-stu-id="fd127-457">Exceptions</span></span>** | <span data-ttu-id="fd127-458">未設定或開啟連線時，<xref:System.Data.SqlClient.SqlCommand.Prepare%2A> 方法現在會擲回 <xref:System.InvalidOperationException>，而不是 <xref:System.NullReferenceException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-458">The <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> method now throws an <xref:System.InvalidOperationException> when a connection is not set or open instead of a <xref:System.NullReferenceException>.</span></span> |
| **<span data-ttu-id="fd127-459">對應檢視</span><span class="sxs-lookup"><span data-stu-id="fd127-459">Mapping Views</span></span>** | <span data-ttu-id="fd127-460">現在會在設計階段攔截查詢檢視對應錯誤，而不是在執行階段擲回 <xref:System.NullReferenceException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-460">Query view mapping errors are now caught at design time instead of throwing a <xref:System.NullReferenceException> at run time.</span></span><br><br><span data-ttu-id="fd127-461">對應驗證現在會攔截概念結構描述 (CSDL) 中的兩個關聯集對應至相同資料行的錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-461">Mapping validation now catches the error in which two association sets in Conceptual Schema (CSDL) are mapped to the same column.</span></span> |
| **<span data-ttu-id="fd127-462">異動</span><span class="sxs-lookup"><span data-stu-id="fd127-462">Transactions</span></span>** | <span data-ttu-id="fd127-463">如果應用程式在交易完成 (包含已中止或已回復) 之後嘗試對連線執行陳述式，現在就會擲回 <xref:System.InvalidOperationException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-463">If an application tries to execute a statement on a connection after a transaction has been completed (including aborted or rolled back), an <xref:System.InvalidOperationException> is now thrown.</span></span> <span data-ttu-id="fd127-464">舊版本未擲回例外狀況，並可讓您執行其他命令，即使交易已中止也是一樣。</span><span class="sxs-lookup"><span data-stu-id="fd127-464">Previous versions did not throw an exception and let you execute additional commands even if a transaction was aborted.</span></span> |

### <a name="entity-framework"></a><span data-ttu-id="fd127-465">Entity Framework</span><span class="sxs-lookup"><span data-stu-id="fd127-465">Entity Framework</span></span>

<span data-ttu-id="fd127-466">下表描述先前有限制或其他問題之功能的改善。</span><span class="sxs-lookup"><span data-stu-id="fd127-466">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="fd127-467">命名空間：<xref:System.Data>、<xref:System.Data.Objects>、<xref:System.Data.Objects.DataClasses>；組件：System.Data.Entity (在 System.Data.Entity.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-467">Namespaces: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; assembly: System.Data.Entity (in System.Data.Entity.dll)</span></span>

| <span data-ttu-id="fd127-468">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-468">Feature</span></span> | <span data-ttu-id="fd127-469">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-469">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-470">實體物件</span><span class="sxs-lookup"><span data-stu-id="fd127-470">Entity objects</span></span>** | <span data-ttu-id="fd127-471">呼叫 <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> 方法時，現在在 <xref:System.Data.Objects.ObjectContext.Detach%2A> 方法與實體物件狀態之間具有同位檢查。</span><span class="sxs-lookup"><span data-stu-id="fd127-471">There is now parity between the <xref:System.Data.Objects.ObjectContext.Detach%2A> method and the state of the entity object when the <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="fd127-472">這項改善的一致性可避免擲回未預期的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd127-472">This improved consistency prevents unexpected exceptions from being thrown.</span></span> |
| **<span data-ttu-id="fd127-473">Entity SQL</span><span class="sxs-lookup"><span data-stu-id="fd127-473">Entity SQL</span></span>** | <span data-ttu-id="fd127-474">已針對 Entity SQL 中的識別項解析改善規則。</span><span class="sxs-lookup"><span data-stu-id="fd127-474">Rules have been improved for identifier resolutions in Entity SQL.</span></span><br><br><span data-ttu-id="fd127-475">Entity SQL 剖析器具有用於解析多組件識別項的改善邏輯。</span><span class="sxs-lookup"><span data-stu-id="fd127-475">The Entity SQL parser has improved logic for resolving multipart identifiers.</span></span> |
| **<span data-ttu-id="fd127-476">結構化註解</span><span class="sxs-lookup"><span data-stu-id="fd127-476">Structural annotations</span></span>** | <span data-ttu-id="fd127-477">Entity Framework 現在可辨識結構化註解。</span><span class="sxs-lookup"><span data-stu-id="fd127-477">The Entity Framework now recognizes structural annotations.</span></span> |
| **<span data-ttu-id="fd127-478">查詢</span><span class="sxs-lookup"><span data-stu-id="fd127-478">Queries</span></span>** | <span data-ttu-id="fd127-479">查詢中已進行下列改善：</span><span class="sxs-lookup"><span data-stu-id="fd127-479">The following improvements were made in queries:</span></span><br><br><span data-ttu-id="fd127-480">\* 不論查詢中是否有任何其他選取，在空集合上使用 Null 索引鍵的 `GroupBy` 查詢都不會傳回任何資料列。</span><span class="sxs-lookup"><span data-stu-id="fd127-480">\* A `GroupBy` query using a null key over an empty collection will not return any rows, regardless if there are any additional selects in the query.</span></span><br><span data-ttu-id="fd127-481">\* LINQ 和 Entity-SQL 查詢中的已產生 SQL 現在預設會將字串參數視為非 Unicode 值。</span><span class="sxs-lookup"><span data-stu-id="fd127-481">\* Generated SQL in LINQ and Entity-SQL queries now treat string parameters as non-Unicode values by default.</span></span> |

### <a name="linq-to-sql"></a><span data-ttu-id="fd127-482">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="fd127-482">LINQ to SQL</span></span>

<span data-ttu-id="fd127-483">下表描述先前有限制或其他問題之功能的改善。</span><span class="sxs-lookup"><span data-stu-id="fd127-483">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="fd127-484">命名空間：<xref:System.Data.Linq>；組件：System.Data.Linq (在 System.Data.Linq.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-484">Namespace: <xref:System.Data.Linq>; assembly: System.Data.Linq (in System.Data.Linq.dll)</span></span>

| <span data-ttu-id="fd127-485">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-485">Feature</span></span> | <span data-ttu-id="fd127-486">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-486">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-487">事件</span><span class="sxs-lookup"><span data-stu-id="fd127-487">Events</span></span>** | <span data-ttu-id="fd127-488">除了在載入集合時引發事件之外，如果卸載 <xref:System.Data.Linq.EntitySet%601>，<xref:System.Data.Linq.EntitySet%601> 集合現在還會對新增和移除作業引發 <xref:System.Data.Linq.EntitySet%601.ListChanged> 事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-488">A <xref:System.Data.Linq.EntitySet%601> collection now raises the <xref:System.Data.Linq.EntitySet%601.ListChanged> event for add and remove operations if the <xref:System.Data.Linq.EntitySet%601> is unloaded, in addition to raising the event when the collection is loaded.</span></span> |
| **<span data-ttu-id="fd127-489">查詢</span><span class="sxs-lookup"><span data-stu-id="fd127-489">Queries</span></span>** | `Skip(0)` <span data-ttu-id="fd127-490">在 LINQ to SQL 查詢中不再忽略。</span><span class="sxs-lookup"><span data-stu-id="fd127-490">is no longer ignored in LINQ to SQL queries.</span></span> <span data-ttu-id="fd127-491">因此，具有此方法之查詢的行為可能會不同。</span><span class="sxs-lookup"><span data-stu-id="fd127-491">As a result, queries that have this method might behave differently.</span></span> <span data-ttu-id="fd127-492">例如，在某些情況下，`OrderBy` 子句需要具有 `Skip(0)`，而且，如果未包含 `OrderBy` 子句，則查詢現在會擲回 <xref:System.NotSupportedException> 例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd127-492">For example in some cases, an `OrderBy` clause is required with `Skip(0)`, and the query will now throw a <xref:System.NotSupportedException> exception if the `OrderBy` clause was not included.</span></span> |

### <a name="wcf-data-services"></a><span data-ttu-id="fd127-493">WCF 資料服務</span><span class="sxs-lookup"><span data-stu-id="fd127-493">WCF Data Services</span></span>

<span data-ttu-id="fd127-494">下表描述先前有限制或其他問題之功能的改善。</span><span class="sxs-lookup"><span data-stu-id="fd127-494">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="fd127-495">命名空間：<xref:System.Data.Services>、<xref:System.Data.Services.Client>、<xref:System.Data.Services.Common>、<xref:System.Data.Services.Providers>；組件：System.Data.Services (在 System.Data.Services.dll 中)、System.Data.Services.Client (在 System.Data.Services.Client.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-495">Namespaces: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; assemblies: System.Data.Services (in System.Data.Services.dll), System.Data.Services.Client (in System.Data.Services.Client.dll)</span></span>

| <span data-ttu-id="fd127-496">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-496">Feature</span></span> | <span data-ttu-id="fd127-497">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-497">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-498">批次二進位內容</span><span class="sxs-lookup"><span data-stu-id="fd127-498">Batched Binary Content</span></span>** | <span data-ttu-id="fd127-499">WCF Data Services 現在支援要求和回應中的批次二進位內容。</span><span class="sxs-lookup"><span data-stu-id="fd127-499">WCF Data Services now supports batched binary content in requests and responses.</span></span> |
| **<span data-ttu-id="fd127-500">變更攔截器</span><span class="sxs-lookup"><span data-stu-id="fd127-500">Change interceptors</span></span>** | <span data-ttu-id="fd127-501">變更攔截器現在是針對刪除要求所執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-501">Change interceptors are now executed for a delete request.</span></span><br><br><span data-ttu-id="fd127-502">變更攔截器是一種方法，會在每次伺服器收到修改實體集中實體的要求時執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-502">A change interceptor is a method that runs every time a request is received by the server to modify an entity in the entity set.</span></span> <span data-ttu-id="fd127-503">它會在執行內送要求之前執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-503">It runs before the incoming request is executed.</span></span> <span data-ttu-id="fd127-504">變更攔截器可存取所變更的實體以及對其執行的作業。</span><span class="sxs-lookup"><span data-stu-id="fd127-504">The change interceptor provides access to the entity that is being changed and the operation that is being performed on it.</span></span> |
| **<span data-ttu-id="fd127-505">例外狀況</span><span class="sxs-lookup"><span data-stu-id="fd127-505">Exceptions</span></span>** | <span data-ttu-id="fd127-506">下列情況現在會擲回更有用的例外狀況，而不是 <xref:System.NullReferenceException>：</span><span class="sxs-lookup"><span data-stu-id="fd127-506">The following conditions now throw more useful exceptions instead of a <xref:System.NullReferenceException>:</span></span><br><br><span data-ttu-id="fd127-507">\* 資料服務呼叫逾時時的 <xref:System.ServiceProcess.TimeoutException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-507">\* A <xref:System.ServiceProcess.TimeoutException> when a call to a data service times out.</span></span><br><span data-ttu-id="fd127-508">\* 對資料服務進行不正確要求時的 <xref:System.Data.Services.Client.DataServiceRequestException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-508">\* A <xref:System.Data.Services.Client.DataServiceRequestException> when a bad request is made to a data service.</span></span><br><br><span data-ttu-id="fd127-509">在應用程式中，您應該變更用來攔截新例外狀況的例外狀況處理。</span><span class="sxs-lookup"><span data-stu-id="fd127-509">In your applications, you should change exception handling to catch the new exceptions.</span></span> |
| **<span data-ttu-id="fd127-510">頁首</span><span class="sxs-lookup"><span data-stu-id="fd127-510">Headers</span></span>** | <span data-ttu-id="fd127-511">已對標頭進行下列改善：</span><span class="sxs-lookup"><span data-stu-id="fd127-511">The following improvements were made to headers:</span></span><br><br><span data-ttu-id="fd127-512">\* WCF Data Services 現在會正確地拒絕具有未指定值的 `eTag` 標頭。</span><span class="sxs-lookup"><span data-stu-id="fd127-512">\* WCF Data Services now correctly rejects an `eTag` header that has an unspecified value.</span></span><br><span data-ttu-id="fd127-513">\* WCF Data Services 現在會傳回錯誤，而且 `if-*` 標頭位在要求時，不會執行連結之刪除要求的要求。</span><span class="sxs-lookup"><span data-stu-id="fd127-513">\* WCF Data Services now returns an error and does not execute the request for a delete request to a link when an `if-*` header is in the request.</span></span><br><span data-ttu-id="fd127-514">\* WCF Data Services 現在會以用戶端在 Accept 標頭中指定的格式 (Atom, JSON) 將錯誤傳回給用戶端。</span><span class="sxs-lookup"><span data-stu-id="fd127-514">\* WCF Data Services now returns an error to the client in the format (Atom, JSON) that the client specified in the Accept header.</span></span> |
| **<span data-ttu-id="fd127-515">JSON 讀取器</span><span class="sxs-lookup"><span data-stu-id="fd127-515">JSON Reader</span></span>** | <span data-ttu-id="fd127-516">現在，JavaScript 物件標記法 (JSON) 讀取器在處理傳送至 WCF 資料服務的 JSON 承載時，會於讀取單一反斜線 ("\\") 逸出字元時正確地傳回錯誤。</span><span class="sxs-lookup"><span data-stu-id="fd127-516">The JavaScript Object Notation (JSON) reader now correctly returns an error when it reads the single backslash ("\\") escape character, when it processes JSON payloads sent to a WCF Data Service.</span></span> |
| **<span data-ttu-id="fd127-517">合併</span><span class="sxs-lookup"><span data-stu-id="fd127-517">Merges</span></span>** | <span data-ttu-id="fd127-518">已對 <xref:System.Data.Services.Client.MergeOption> 列舉進行下列改善：</span><span class="sxs-lookup"><span data-stu-id="fd127-518">The following improvements were made to the <xref:System.Data.Services.Client.MergeOption> enumeration:</span></span><br><br><span data-ttu-id="fd127-519">\* 在資料服務的任何後續回應之後，<xref:System.Data.Services.Client.MergeOption> 合併選項不再修改用戶端上的實體。</span><span class="sxs-lookup"><span data-stu-id="fd127-519">\* The <xref:System.Data.Services.Client.MergeOption> merge option no longer modifies the entity on the client as a result of any subsequent response from a data service.</span></span><br><span data-ttu-id="fd127-520">\* 在動態 SQL 與預存程序更新之間，<xref:System.Data.Services.Client.MergeOption> 選項現在會一致。</span><span class="sxs-lookup"><span data-stu-id="fd127-520">\* The <xref:System.Data.Services.Client.MergeOption> option is now consistent between dynamic SQL and stored procedure-based updates.</span></span> |
| **<span data-ttu-id="fd127-521">要求</span><span class="sxs-lookup"><span data-stu-id="fd127-521">Requests</span></span>** | <span data-ttu-id="fd127-522">現在，在處理資料服務的要求之前，會呼叫 <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="fd127-522">The <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> method is now called before a request to data services is processed.</span></span> <span data-ttu-id="fd127-523">這可讓 <xref:System.Data.Services.Providers.ServiceOperation> 服務的要求正常運作。</span><span class="sxs-lookup"><span data-stu-id="fd127-523">This enables the request to work correctly for <xref:System.Data.Services.Providers.ServiceOperation> services.</span></span> |
| **<span data-ttu-id="fd127-524">資料流</span><span class="sxs-lookup"><span data-stu-id="fd127-524">Streams</span></span>** | <span data-ttu-id="fd127-525">WCF Data Services 不再關閉進行讀取和寫入作業的基礎資料流。</span><span class="sxs-lookup"><span data-stu-id="fd127-525">WCF Data Services no longer closes the underlying stream for read and write operations.</span></span> |
| **<span data-ttu-id="fd127-526">URI</span><span class="sxs-lookup"><span data-stu-id="fd127-526">URIs</span></span>** | <span data-ttu-id="fd127-527">已修正 WCF Data Services 用戶端的 URI 逸出。</span><span class="sxs-lookup"><span data-stu-id="fd127-527">The escaping of URIs by WCF Data Services client has been corrected.</span></span> |

## <a name="windows-communication-foundation-wcf"></a><span data-ttu-id="fd127-528">Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="fd127-528">Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="fd127-529">下表描述先前有限制或其他問題之功能的改善。</span><span class="sxs-lookup"><span data-stu-id="fd127-529">The following table describes improvements to features that previously had limitations or other issues.</span></span>

| <span data-ttu-id="fd127-530">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-530">Feature</span></span> | <span data-ttu-id="fd127-531">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-531">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-532">組態檔</span><span class="sxs-lookup"><span data-stu-id="fd127-532">Configuration files</span></span>** | <span data-ttu-id="fd127-533">為了透過組態檔階層啟用行為繼承，WCF 現在支援跨組態檔合併。</span><span class="sxs-lookup"><span data-stu-id="fd127-533">To enable inheritance of behaviors through the configuration file hierarchy, WCF now supports merging across configuration files.</span></span><br><br><span data-ttu-id="fd127-534">現在已擴充組態繼承模型，讓使用者定義將套用至在電腦上執行之所有服務的行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-534">The configuration inheritance model is now expanded to let users define behaviors that will be applied to all the services that are running on the computer.</span></span><br><br><span data-ttu-id="fd127-535">如果在不同的階層層級有同名的行為，您可能會遇到行為變更。</span><span class="sxs-lookup"><span data-stu-id="fd127-535">You may encounter behavioral changes if there are behaviors with the same name at different levels of the hierarchy.</span></span> |
| **<span data-ttu-id="fd127-536">服務裝載</span><span class="sxs-lookup"><span data-stu-id="fd127-536">Service hosting</span></span>** | <span data-ttu-id="fd127-537">將 `allowDefinition="MachineToApplication"` 屬性新增至項目定義，就無法再於服務層級指定 `<serviceHostingEnvironment>` 組態項目。</span><span class="sxs-lookup"><span data-stu-id="fd127-537">You can no longer specify the `<serviceHostingEnvironment>` configuration element at the service level by adding the attribute `allowDefinition="MachineToApplication"` to the element definition.</span></span><br><br><span data-ttu-id="fd127-538">在服務層級指定 `<serviceHostingEnvironment>` 項目就技術上而言不正確，而且會導致不一致的行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-538">Specifying the `<serviceHostingEnvironment>` element at the service level is technically incorrect and causes inconsistent behavior.</span></span> |

## <a name="windows-presentation-foundation-wpf"></a><span data-ttu-id="fd127-539">Windows Presentation Foundation (WPF)</span><span class="sxs-lookup"><span data-stu-id="fd127-539">Windows Presentation Foundation (WPF)</span></span>

### <a name="applications"></a><span data-ttu-id="fd127-540">應用程式</span><span class="sxs-lookup"><span data-stu-id="fd127-540">Applications</span></span>

<span data-ttu-id="fd127-541">命名空間：<xref:System.Windows>、<xref:System.Windows.Controls>；組件：PresentationFramework (在 PresentationFramework.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-541">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>; assembly: PresentationFramework (in PresentationFramework.dll)</span></span>

| <span data-ttu-id="fd127-542">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-542">Feature</span></span> | <span data-ttu-id="fd127-543">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-543">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-544">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-544">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-545">例外狀況處理</span><span class="sxs-lookup"><span data-stu-id="fd127-545">Exception handling</span></span>** | <span data-ttu-id="fd127-546">若要早期偵測到錯誤，WPF 會擲回 <xref:System.Reflection.TargetInvocationException> 並將 <xref:System.Exception.InnerException> 屬性設定為重大例外狀況，例如 <xref:System.NullReferenceException>、<xref:System.OutOfMemoryException>、<xref:System.StackOverflowException> 和 <xref:System.Security.SecurityException>，而不是攔截原始例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fd127-546">To enable errors to be detected earlier, WPF throws a <xref:System.Reflection.TargetInvocationException> and sets the <xref:System.Exception.InnerException> property to critical exceptions, such as <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException>, and <xref:System.Security.SecurityException>, instead of catching the original exception.</span></span> | <span data-ttu-id="fd127-547">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-547">None.</span></span> |
| **<span data-ttu-id="fd127-548">連結的資源</span><span class="sxs-lookup"><span data-stu-id="fd127-548">Linked resources</span></span>** | <span data-ttu-id="fd127-549">為了讓連結更為簡單，建置應用程式時，位於專案資料夾結構以外之位置中的資源檔 (例如影像) 會使用資源檔的完整路徑，而不是將其檔案名稱作為資源識別碼。</span><span class="sxs-lookup"><span data-stu-id="fd127-549">To make linking easier, resource files (such as images) that are located in a location other than the project's folder structure use the resource file's full path instead of just its file name as the resource ID when the application is built.</span></span> <span data-ttu-id="fd127-550">應用程式將能夠在執行階段找出檔案。</span><span class="sxs-lookup"><span data-stu-id="fd127-550">The application will be able to locate the files at run time.</span></span> | <span data-ttu-id="fd127-551">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-551">None.</span></span> |
| **<span data-ttu-id="fd127-552">部分信任應用程式</span><span class="sxs-lookup"><span data-stu-id="fd127-552">Partial-trust applications</span></span>** | <span data-ttu-id="fd127-553">基於安全性考量，如果 Windows 應用程式是以部分信任執行並包含內含 HTML 的 <xref:System.Windows.Controls.WebBrowser> 控制項或 <xref:System.Windows.Controls.Frame> 控制項，則會在建立控制項時擲回 <xref:System.Security.SecurityException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-553">For security considerations, Windows-based applications that run in partial trust and contain a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML will throw a <xref:System.Security.SecurityException> when the control is created.</span></span><br><br><span data-ttu-id="fd127-554">如果符合下列所有條件，則瀏覽器應用程式會擲回例外狀況，並顯示一則訊息：</span><span class="sxs-lookup"><span data-stu-id="fd127-554">Browser applications will throw an exception and display a message if all of the following conditions are met:</span></span><br><br><span data-ttu-id="fd127-555">\* 應用程式正在 Firefox 中執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-555">\* The application is running in Firefox.</span></span><br><span data-ttu-id="fd127-556">\* 應用程式是以部分信任在非受信任網站的網際網路區域中執行。</span><span class="sxs-lookup"><span data-stu-id="fd127-556">\* The application is running in partial trust in the Internet zone from non-trusted sites.</span></span><br><span data-ttu-id="fd127-557">\* 應用程式包含內含 HTML 的 <xref:System.Windows.Controls.WebBrowser> 控制項或 <xref:System.Windows.Controls.Frame> 控制項。</span><span class="sxs-lookup"><span data-stu-id="fd127-557">\* The application contains a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML.</span></span><br><br><span data-ttu-id="fd127-558">請注意，從信任的網站或內部網路區域執行的應用程式不會受到影響。</span><span class="sxs-lookup"><span data-stu-id="fd127-558">Note that applications that run from trusted sites or from the intranet zone will not be affected.</span></span> | <span data-ttu-id="fd127-559">在您的瀏覽器應用程式中，您可以執行下列其中一項來簡化這項變更：</span><span class="sxs-lookup"><span data-stu-id="fd127-559">In your browser applications, you can ease this change by doing one of the following:</span></span><br><br><span data-ttu-id="fd127-560">\* 以完全信任執行瀏覽器應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-560">\* Run the browser application in full trust.</span></span><br><span data-ttu-id="fd127-561">\* 讓客戶將應用程式的網站新增至信任的網站區域。</span><span class="sxs-lookup"><span data-stu-id="fd127-561">\* Have customers add the application's site to the trusted sites zone.</span></span><br><span data-ttu-id="fd127-562">\* 讓客戶在 Internet Explorer 中執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-562">\* Have customers run the application in Internet Explorer.</span></span> |
| **<span data-ttu-id="fd127-563">資源字典</span><span class="sxs-lookup"><span data-stu-id="fd127-563">Resource dictionaries</span></span>** | <span data-ttu-id="fd127-564">為了改善佈景主題層級資源字典，並防止變更它們，資源字典中所定義和合併至佈景主題層級字典的可凍結資源現在一律會標示為凍結且為不變的。</span><span class="sxs-lookup"><span data-stu-id="fd127-564">To improve theme-level resource dictionaries and prevent them from changing, freezable resources that are defined in a resource dictionary and merged into a theme-level dictionary are now always marked as frozen and are immutable.</span></span> <span data-ttu-id="fd127-565">這是可凍結資源的預期行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-565">This is the expected behavior for freezable resources.</span></span> | <span data-ttu-id="fd127-566">修改佈景主題層級合併字典中所定義資源的應用程式應該會複製資源，並修改複製的複本。</span><span class="sxs-lookup"><span data-stu-id="fd127-566">Applications that modify a resource that is defined in a theme-level merged dictionary should clone the resource and modify the cloned copy.</span></span> <span data-ttu-id="fd127-567">或者，資源可以標上 `x:Shared="false"`，因此 <xref:System.Windows.ResourceDictionary> 會在每次查詢資源時建立新的複本。</span><span class="sxs-lookup"><span data-stu-id="fd127-567">Alternatively, the resource can be marked `x:Shared="false"` so that the <xref:System.Windows.ResourceDictionary> creates a new copy every time the resource is queried.</span></span> |
| **<span data-ttu-id="fd127-568">Windows 7</span><span class="sxs-lookup"><span data-stu-id="fd127-568">Windows 7</span></span>** | <span data-ttu-id="fd127-569">為了讓 WPF 應用程式在 Windows 7 上運作地更好，已進行下列改善，來更正視窗的行為：</span><span class="sxs-lookup"><span data-stu-id="fd127-569">To make WPF applications work better on Windows 7, the following improvements were made to correct the behavior of a window:</span></span><br><br><span data-ttu-id="fd127-570">\* 根據使用者互動，停駐和手勢狀態現在會如預期運作。</span><span class="sxs-lookup"><span data-stu-id="fd127-570">\* Dock and gesture states now work as expected based on user interactions.</span></span><br><span data-ttu-id="fd127-571">\* **重疊顯示視窗、堆疊顯示視窗**和**並排顯示視窗**工作列命令現在有正確的行為，並更新適當的屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-571">\* The taskbar commands **Cascade windows, Show windows stacked**, and **Show windows side-by-side** now have the correct behavior and update the appropriate properties.</span></span><br><span data-ttu-id="fd127-572">\* 最大化或最小化視窗的 `Top`、`Left`, `Width` 和 `Height` 屬性現在包含視窗的正確還原位置，而不是其他值，視監視器而定。</span><span class="sxs-lookup"><span data-stu-id="fd127-572">\* The `Top`, `Left`, `Width`, and `Height` properties for a maximized or minimized window now contain the correct restore location of the window instead of other values, depending on the monitor.</span></span> | <span data-ttu-id="fd127-573">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-573">None.</span></span> |
| **<span data-ttu-id="fd127-574">Windows 樣式和透明度</span><span class="sxs-lookup"><span data-stu-id="fd127-574">Windows style and transparency</span></span>** | <span data-ttu-id="fd127-575"><xref:System.Windows.Window.AllowsTransparency> 為 `true` 且 <xref:System.Windows.WindowState> 為 <xref:System.Windows.WindowState> 時，如果您嘗試將 <xref:System.Windows.Window.WindowStyle> 設定為 <xref:System.Windows.WindowStyle> 以外的值，則會擲回 <xref:System.InvalidOperationException>。</span><span class="sxs-lookup"><span data-stu-id="fd127-575">An <xref:System.InvalidOperationException> is thrown if you try to set <xref:System.Windows.Window.WindowStyle> to a value other than <xref:System.Windows.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true` and <xref:System.Windows.WindowState> is <xref:System.Windows.WindowState>.</span></span> | <span data-ttu-id="fd127-576">如果您必須在 <xref:System.Windows.Window.AllowsTransparency> 為 `true` 時變更 <xref:System.Windows.Window.WindowStyle>，則可以呼叫 Win32 `SetWindowLongPtr` 函式。</span><span class="sxs-lookup"><span data-stu-id="fd127-576">If you must change the <xref:System.Windows.Window.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true`, you can call the Win32 `SetWindowLongPtr` function.</span></span> |
| **<span data-ttu-id="fd127-577">XPS 檢視器</span><span class="sxs-lookup"><span data-stu-id="fd127-577">XPS Viewer</span></span>** | <span data-ttu-id="fd127-578">WPF 不包含 Microsoft XML Paper Specification Essentials Pack (XPSEP)。</span><span class="sxs-lookup"><span data-stu-id="fd127-578">WPF does not include the Microsoft XML Paper Specification Essentials Pack (XPSEP).</span></span> <span data-ttu-id="fd127-579">XPSEP 包含於 Windows 7 和 Windows Vista 中。</span><span class="sxs-lookup"><span data-stu-id="fd127-579">XPSEP is included with Windows 7 and Windows Vista.</span></span><br><br><span data-ttu-id="fd127-580">在執行未安裝 .NET Framework 3.5 SP1 之 Windows XP 的電腦上，使用 <xref:System.Windows.Controls.PrintDialog> 中以外的 WPF API 進行列印將會依賴 WINSPOOL。</span><span class="sxs-lookup"><span data-stu-id="fd127-580">On a computer that is running Windows XP without the .NET Framework 3.5 SP1 installed, printing by using a WPF API other than those in <xref:System.Windows.Controls.PrintDialog> will rely on the WINSPOOL.</span></span> <span data-ttu-id="fd127-581">將不會報告某些印表機功能，而且在列印期間不會套用某些印表機設定。</span><span class="sxs-lookup"><span data-stu-id="fd127-581">Some printer capabilities will not be reported and some printer settings will not be applied during printing.</span></span> | <span data-ttu-id="fd127-582">如果必要，請安裝 [Microsoft XML Paper Specification Essentials Pack](https://go.microsoft.com/fwlink/?LinkId=178895)。</span><span class="sxs-lookup"><span data-stu-id="fd127-582">If needed, install the [Microsoft XML Paper Specification Essentials Pack](https://go.microsoft.com/fwlink/?LinkId=178895).</span></span> |

### <a name="controls"></a><span data-ttu-id="fd127-583">控制項</span><span class="sxs-lookup"><span data-stu-id="fd127-583">Controls</span></span>

<span data-ttu-id="fd127-584">命名空間：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>；組件：PresentationFramework (在 PresentationFramework.dll 中)、PresentationCore (在 PresentationCore.dll 中)、WindowsBase (在 WindowsBase.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-584">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="fd127-585">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-585">Feature</span></span> | <span data-ttu-id="fd127-586">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-586">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-587">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-587">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-588">對話方塊</span><span class="sxs-lookup"><span data-stu-id="fd127-588">Dialog boxes</span></span>** | <span data-ttu-id="fd127-589">為了改善可靠性，會在已建立 <xref:Microsoft.Win32.FileDialog> 控制項的相同執行緒上呼叫 <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="fd127-589">To improve reliability, the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method is called on the same thread that created the <xref:Microsoft.Win32.FileDialog> control.</span></span> | <span data-ttu-id="fd127-590">請務必建立 <xref:Microsoft.Win32.FileDialog> 控制項，並在相同的執行緒上呼叫 <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="fd127-590">Be sure to create a <xref:Microsoft.Win32.FileDialog> control and call the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method on the same thread.</span></span> |
| **<span data-ttu-id="fd127-591">浮動視窗</span><span class="sxs-lookup"><span data-stu-id="fd127-591">Floating windows</span></span>** | <span data-ttu-id="fd127-592">為了修正不正確地持續重新啟用浮動視窗的焦點還原邏輯 (讓它看起來像是強制回應對話方塊)，現在，如果候選項目不是視窗的子系，則會避免焦點還原。</span><span class="sxs-lookup"><span data-stu-id="fd127-592">To fix focus restoration logic that incorrectly keeps reactivating a floating window (making it appear like a modal dialog box), focus restoration is now prevented if the candidate is not a child of the window.</span></span> | <span data-ttu-id="fd127-593">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-593">None.</span></span> |
| **<span data-ttu-id="fd127-594">集合中的項目</span><span class="sxs-lookup"><span data-stu-id="fd127-594">Items in collections</span></span>** | <span data-ttu-id="fd127-595">如果未排序 <xref:System.Windows.Data.CollectionView>，則項目在移動或新增至基礎集合後會出現在相同相對位置的 <xref:System.Windows.Data.CollectionView> 中。</span><span class="sxs-lookup"><span data-stu-id="fd127-595">When an item is moved or added to an underlying collection, it appears in the <xref:System.Windows.Data.CollectionView> in the same relative location if the <xref:System.Windows.Data.CollectionView> is not sorted.</span></span> <span data-ttu-id="fd127-596">這會提供項目在集合中的位置與在相關聯 <xref:System.Windows.Data.CollectionView> 中的位置之間的一致性。</span><span class="sxs-lookup"><span data-stu-id="fd127-596">This provides consistency between the item's position in the collection and in the associated <xref:System.Windows.Data.CollectionView>.</span></span> | <span data-ttu-id="fd127-597">請使用 <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> 或 <xref:System.Windows.Data.CollectionView.IndexOf%2A> 方法找到項目在 <xref:System.Windows.Data.CollectionView> 中的位置，而不是依賴項目的固定位置。</span><span class="sxs-lookup"><span data-stu-id="fd127-597">Use the <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> or <xref:System.Windows.Data.CollectionView.IndexOf%2A> method to find the location of an item in a <xref:System.Windows.Data.CollectionView> instead of relying on a fixed location of an item.</span></span> |
| **<span data-ttu-id="fd127-598">版面配置</span><span class="sxs-lookup"><span data-stu-id="fd127-598">Layouts</span></span>** | <span data-ttu-id="fd127-599">若要去除不必要的重新版面配置，則變更 <xref:System.Windows.Controls.Page.ShowsNavigationUI> 不再讓版面配置失效，或導致另一個版面配置階段。</span><span class="sxs-lookup"><span data-stu-id="fd127-599">To eliminate unnecessary re-layouts, changing the <xref:System.Windows.Controls.Page.ShowsNavigationUI> no longer invalidates layout or causes another layout pass.</span></span> | <span data-ttu-id="fd127-600">如果您預期變更 <xref:System.Windows.Controls.Page.ShowsNavigationUI> 會導致另一個版面配置階段，請在設定屬性之後呼叫 <xref:System.Windows.UIElement.InvalidateVisual%2A>。</span><span class="sxs-lookup"><span data-stu-id="fd127-600">If you expect that changing <xref:System.Windows.Controls.Page.ShowsNavigationUI> will cause another layout pass, call <xref:System.Windows.UIElement.InvalidateVisual%2A> after you set the property.</span></span> |
| **<span data-ttu-id="fd127-601">Menus</span><span class="sxs-lookup"><span data-stu-id="fd127-601">Menus</span></span>** | <span data-ttu-id="fd127-602">若要在功能表快顯視窗中啟用 ClearType 文字，則已修改 <xref:System.Windows.Controls.ControlTemplate> 類別和 <xref:System.Windows.Controls.MenuItem> 控制項以及其他控制項。</span><span class="sxs-lookup"><span data-stu-id="fd127-602">To enable ClearType text in menu pop-ups, modifications were made to the <xref:System.Windows.Controls.ControlTemplate> class and to the <xref:System.Windows.Controls.MenuItem> control and other controls.</span></span> | <span data-ttu-id="fd127-603">應用程式不應該依賴控制項範本的視覺效果結構。</span><span class="sxs-lookup"><span data-stu-id="fd127-603">Applications should not rely on the visual structure of control templates.</span></span> <span data-ttu-id="fd127-604">只有 <xref:System.Windows.Controls.ControlTemplate> 的具名部分才是公用合約的一部分。</span><span class="sxs-lookup"><span data-stu-id="fd127-604">Only named parts of a <xref:System.Windows.Controls.ControlTemplate> are part of the public contract.</span></span> <span data-ttu-id="fd127-605">如果應用程式必須在 <xref:System.Windows.Controls.ControlTemplate> 中找到特定物件，請搜尋視覺化樹狀結構中是否有特定類型，而不是依賴樹狀結構中某個物件的固定位置。</span><span class="sxs-lookup"><span data-stu-id="fd127-605">If an application must find a certain object in a <xref:System.Windows.Controls.ControlTemplate>, search the visual tree for a specific type instead of relying on a fixed location of an object in the tree.</span></span> |
| **<span data-ttu-id="fd127-606">瀏覽</span><span class="sxs-lookup"><span data-stu-id="fd127-606">Navigating</span></span>** | <span data-ttu-id="fd127-607">如果 <xref:System.Windows.Controls.Frame> 直接瀏覽至某個位置，則在初始瀏覽之後，<xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> 屬性是 `true`。</span><span class="sxs-lookup"><span data-stu-id="fd127-607">If a <xref:System.Windows.Controls.Frame> directly navigates to a location, the <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> property is `true` after the initial navigation.</span></span> <span data-ttu-id="fd127-608">這項變更可防止在啟動案例期間引發其他事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-608">This change prevents additional events from being raised during startup scenarios.</span></span> | <span data-ttu-id="fd127-609">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-609">None.</span></span> |
| **<span data-ttu-id="fd127-610">快顯視窗</span><span class="sxs-lookup"><span data-stu-id="fd127-610">Pop-ups</span></span>** | <span data-ttu-id="fd127-611">在版面配置階段期間，現在可以呼叫 <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> 委派多次，而不是只呼叫一次。</span><span class="sxs-lookup"><span data-stu-id="fd127-611">The <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate can now be called multiple times during a layout pass instead of only once.</span></span> | <span data-ttu-id="fd127-612">如果您的 <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> 委派會根據先前的位置計算 <xref:System.Windows.Controls.Primitives.Popup> 的位置，則只有在 `popupSize`、`targetSize` 或 `offset` 參數的值變更時，才會重新計算位置。</span><span class="sxs-lookup"><span data-stu-id="fd127-612">If your <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate calculates the position of a <xref:System.Windows.Controls.Primitives.Popup> based on its previous position, recalculate the position only if the values of the `popupSize`, `targetSize`, or `offset` parameters change.</span></span> |
| **<span data-ttu-id="fd127-613">屬性值</span><span class="sxs-lookup"><span data-stu-id="fd127-613">Property values</span></span>** | <span data-ttu-id="fd127-614"><xref:System.Windows.DependencyObject.SetCurrentValue%2A> 方法現在可讓您將屬性設定為有效值，但仍然會接受影響該屬性的任何繫結、樣式或觸發程序。</span><span class="sxs-lookup"><span data-stu-id="fd127-614">The <xref:System.Windows.DependencyObject.SetCurrentValue%2A> method now lets you set a property to an effective value, although it continues to respects any binding, style, or trigger that affects the property.</span></span> | <span data-ttu-id="fd127-615">只要屬性值變更為某個其他動作的副作用 (包含使用者操作)，控制項作者應該就會使用 <xref:System.Windows.DependencyObject.SetCurrentValue%2A>。</span><span class="sxs-lookup"><span data-stu-id="fd127-615">Control authors should use <xref:System.Windows.DependencyObject.SetCurrentValue%2A> whenever the property value changes as a side-effect of some other action, including user manipulation.</span></span> |
| **<span data-ttu-id="fd127-616">文字方塊</span><span class="sxs-lookup"><span data-stu-id="fd127-616">Text boxes</span></span>** | <span data-ttu-id="fd127-617">基於安全性考量，<xref:System.Windows.Forms.TextBoxBase.Copy%2A> 和 <xref:System.Windows.Forms.TextBoxBase.Cut%2A> 方法以部分信任呼叫時會以無訊息模式失敗。</span><span class="sxs-lookup"><span data-stu-id="fd127-617">For security considerations, the <xref:System.Windows.Forms.TextBoxBase.Copy%2A> and <xref:System.Windows.Forms.TextBoxBase.Cut%2A> methods silently fail when they are called in partial trust.</span></span><br><br><span data-ttu-id="fd127-618">此外，以程式設計方式在繼承自 <xref:System.Windows.Controls.Primitives.TextBoxBase> 的控制項上執行 <xref:System.Windows.Input.ApplicationCommands.Copy> 或 <xref:System.Windows.Input.ApplicationCommands.Cut> 屬性，將會在部分信任中予以封鎖。</span><span class="sxs-lookup"><span data-stu-id="fd127-618">In addition, programmatic execution of the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> property on a control that inherits from <xref:System.Windows.Controls.Primitives.TextBoxBase> will be blocked in partial trust.</span></span> <span data-ttu-id="fd127-619">不過，使用者啟動的複製和剪下命令 (例如，按一下其 <xref:System.Windows.Controls.Primitives.ButtonBase.Command> 屬性繫結至其中一個命令的按鈕) 將會運作。</span><span class="sxs-lookup"><span data-stu-id="fd127-619">However, user-initiated copy and cut commands, such as clicking a button whose <xref:System.Windows.Controls.Primitives.ButtonBase.Command> property is bound to one of these commands, will work.</span></span> <span data-ttu-id="fd127-620">透過鍵盤快速鍵和操作功能表的標準複製和剪下，仍然會如之前在部分信任中運作。</span><span class="sxs-lookup"><span data-stu-id="fd127-620">Standard copy and cut through keyboard shortcuts and the context menu will still work as before in partial trust.</span></span> | <span data-ttu-id="fd127-621">將 <xref:System.Windows.Input.ApplicationCommands.Copy> 或 <xref:System.Windows.Input.ApplicationCommands.Cut> 命令繫結至使用者起始的動作，例如按一下按鈕。</span><span class="sxs-lookup"><span data-stu-id="fd127-621">Bind the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> command to a user-initiated action, such as clicking a button.</span></span> |

### <a name="graphics"></a><span data-ttu-id="fd127-622">圖形</span><span class="sxs-lookup"><span data-stu-id="fd127-622">Graphics</span></span>

<span data-ttu-id="fd127-623">命名空間：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>、<xref:System.Windows.Media.Effects>；組件：PresentationFramework (在 PresentationFramework.dll 中)、PresentationCore (在 PresentationCore.dll 中)、WindowsBase (在 WindowsBase.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-623">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="fd127-624">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-624">Feature</span></span> | <span data-ttu-id="fd127-625">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-625">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-626">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-626">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-627">點陣圖效果</span><span class="sxs-lookup"><span data-stu-id="fd127-627">Bitmap effects</span></span>** | <span data-ttu-id="fd127-628">為了改善效能，<xref:System.Windows.Media.Effects.BitmapEffect> 類別以及繼承自 <xref:System.Windows.Media.Effects.BitmapEffect> 類別的類別雖然仍然存在，但已予以停用。</span><span class="sxs-lookup"><span data-stu-id="fd127-628">To improve performance, the <xref:System.Windows.Media.Effects.BitmapEffect> class and the classes that inherit from the <xref:System.Windows.Media.Effects.BitmapEffect> class, although still present, are disabled.</span></span> <span data-ttu-id="fd127-629">如果下列條件成立，則會使用硬體加速轉譯管線來轉譯效果：</span><span class="sxs-lookup"><span data-stu-id="fd127-629">The effect will render by using the hardware-accelerated rendering pipeline if the following conditions are true:</span></span><br><br><span data-ttu-id="fd127-630">\* 應用程式使用半徑屬性集小於 100 DIU 的 <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> 或 <xref:System.Windows.Media.Effects.BlurBitmapEffect>。</span><span class="sxs-lookup"><span data-stu-id="fd127-630">\* The application uses a <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> or a <xref:System.Windows.Media.Effects.BlurBitmapEffect> that has a radius property set less than 100 DIU.</span></span><br><span data-ttu-id="fd127-631">\* 執行應用程式之電腦上的視訊卡支援像素著色器 2.0。</span><span class="sxs-lookup"><span data-stu-id="fd127-631">\* The video card on the computer that runs the application supports pixel shader 2.0.</span></span><br><br><span data-ttu-id="fd127-632">如果不符合這些條件，則 <xref:System.Windows.Media.Effects.BitmapEffect> 物件不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="fd127-632">If these conditions are not met, a <xref:System.Windows.Media.Effects.BitmapEffect> object will have no effect.</span></span><br><br><span data-ttu-id="fd127-633">此外，Visual Studio 在遇到 <xref:System.Windows.Media.Effects.BitmapEffect> 物件或子類別時將會產生編譯器警告。</span><span class="sxs-lookup"><span data-stu-id="fd127-633">Also, Visual Studio produces a compiler warning when it encounters the <xref:System.Windows.Media.Effects.BitmapEffect> object or a subclass.</span></span><br><br><span data-ttu-id="fd127-634"><xref:System.Windows.Media.DrawingContext.PushEffect%2A> 方法已標示為過時。</span><span class="sxs-lookup"><span data-stu-id="fd127-634">The <xref:System.Windows.Media.DrawingContext.PushEffect%2A> method is marked obsolete.</span></span> | <span data-ttu-id="fd127-635">停止使用舊版 <xref:System.Windows.Media.Effects.BitmapEffect> 和衍生類別，而是改成使用衍生自 <xref:System.Windows.Media.Effects.Effect> 的新類別：<xref:System.Windows.Media.Effects.BlurEffect>、<xref:System.Windows.Media.Effects.DropShadowEffect> 和 <xref:System.Windows.Media.Effects.ShaderEffect>。</span><span class="sxs-lookup"><span data-stu-id="fd127-635">Discontinue using the legacy <xref:System.Windows.Media.Effects.BitmapEffect> and derived classes and instead use the new classes derived from <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect>, and <xref:System.Windows.Media.Effects.ShaderEffect>.</span></span><br><br><span data-ttu-id="fd127-636">您也可以繼承自 <xref:System.Windows.Media.Effects.ShaderEffect> 類別，來建立自己的效果。</span><span class="sxs-lookup"><span data-stu-id="fd127-636">You can also create your own effects by inheriting from the <xref:System.Windows.Media.Effects.ShaderEffect> class.</span></span> |
| **<span data-ttu-id="fd127-637">點陣圖框架</span><span class="sxs-lookup"><span data-stu-id="fd127-637">Bitmap frames</span></span>** | <span data-ttu-id="fd127-638">複製的 <xref:System.Windows.Media.Imaging.BitmapFrame> 物件現在會收到 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>、<xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> 和 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> 事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-638">The cloned <xref:System.Windows.Media.Imaging.BitmapFrame> objects now receive the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, and <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> events.</span></span> <span data-ttu-id="fd127-639">這可讓從 Web 下載並透過 <xref:System.Windows.Style> 套用至 <xref:System.Windows.Controls.Image> 控制項的映像正常運作。</span><span class="sxs-lookup"><span data-stu-id="fd127-639">This enables images that are downloaded from the Web and applied to the <xref:System.Windows.Controls.Image> control through a <xref:System.Windows.Style> to work correctly.</span></span><br><br><span data-ttu-id="fd127-640">只有在下列所有陳述式都成立時，您才會看到行為變更：</span><span class="sxs-lookup"><span data-stu-id="fd127-640">You will see a change in behavior only if all of the following statements are true:</span></span><br><br><span data-ttu-id="fd127-641">\* 您訂閱 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>、<xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> 或 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> 事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-641">\* You subscribe to the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, or <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> event.</span></span><br><span data-ttu-id="fd127-642">\* <xref:System.Windows.Media.Imaging.BitmapFrame> 的來源是來自 Web。</span><span class="sxs-lookup"><span data-stu-id="fd127-642">\* The source of the <xref:System.Windows.Media.Imaging.BitmapFrame> is from the Web.</span></span><br><span data-ttu-id="fd127-643">\* 在下載仍在進行時複製 <xref:System.Windows.Media.Imaging.BitmapFrame>。</span><span class="sxs-lookup"><span data-stu-id="fd127-643">\* The <xref:System.Windows.Media.Imaging.BitmapFrame> is cloned while the download is still in progress.</span></span> | <span data-ttu-id="fd127-644">只有在寄件者是原始 <xref:System.Windows.Media.Imaging.BitmapFrame> 時，才會檢查事件處理常式中的寄件者，並採取動作。</span><span class="sxs-lookup"><span data-stu-id="fd127-644">Check the sender in the event handler and take action only if the sender is the original <xref:System.Windows.Media.Imaging.BitmapFrame>.</span></span> |
| **<span data-ttu-id="fd127-645">將影像解碼</span><span class="sxs-lookup"><span data-stu-id="fd127-645">Decoding images</span></span>** | <span data-ttu-id="fd127-646">為了防止在未解碼映像時處理 <xref:System.IO.IOException>，<xref:System.Windows.Media.Imaging.BitmapSource> 類別會在未解碼映像時引發 <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> 事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-646">To prevent an <xref:System.IO.IOException> from not being handled when images may not decode, the <xref:System.Windows.Media.Imaging.BitmapSource> class will raise the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event when it does not decode an image.</span></span> | <span data-ttu-id="fd127-647">移除 <xref:System.IO.IOException> 的任何例外狀況處理，並使用 <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> 事件，以檢查解碼失敗。</span><span class="sxs-lookup"><span data-stu-id="fd127-647">Remove any exception handling for <xref:System.IO.IOException>, and use the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event to check for decode failure.</span></span> |

### <a name="input"></a><span data-ttu-id="fd127-648">輸入</span><span class="sxs-lookup"><span data-stu-id="fd127-648">Input</span></span>

<span data-ttu-id="fd127-649">命名空間：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>；組件：PresentationFramework (在 PresentationFramework.dll 中)、PresentationCore (在 PresentationCore.dll 中)、WindowsBase (在 WindowsBase.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-649">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="fd127-650">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-650">Feature</span></span> | <span data-ttu-id="fd127-651">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-651">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-652">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-652">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-653">繫結命令執行個體</span><span class="sxs-lookup"><span data-stu-id="fd127-653">Binding command instances</span></span>** | <span data-ttu-id="fd127-654">為了提供機制將檢視模型命令執行個體繫結至檢視輸入手勢，<xref:System.Windows.Input.InputBinding> 類別現在繼承自 <xref:System.Windows.Freezable>，而不是 <xref:System.Windows.DependencyObject>。</span><span class="sxs-lookup"><span data-stu-id="fd127-654">To provide a mechanism to bind View-Model-based command instances to View-based input gestures, the <xref:System.Windows.Input.InputBinding> class now inherits from <xref:System.Windows.Freezable> instead of <xref:System.Windows.DependencyObject>.</span></span> <span data-ttu-id="fd127-655">下列屬性現在是相依性屬性：</span><span class="sxs-lookup"><span data-stu-id="fd127-655">The following properties are now dependency properties:</span></span><br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br><span data-ttu-id="fd127-656">這項變更會導致下列各項：</span><span class="sxs-lookup"><span data-stu-id="fd127-656">This change results in the following:</span></span><br><br><span data-ttu-id="fd127-657">\* <xref:System.Windows.Input.InputBinding> 物件現在在註冊後會予以凍結，而不是保持可變動。</span><span class="sxs-lookup"><span data-stu-id="fd127-657">\* An <xref:System.Windows.Input.InputBinding> object is now frozen when it is registered instead of remaining mutable.</span></span><br><span data-ttu-id="fd127-658">\* 因為 <xref:System.Windows.DependencyObject> 類別的限制，所以您無法從多個執行緒存取執行個體層級 <xref:System.Windows.Input.InputBinding> 物件。</span><span class="sxs-lookup"><span data-stu-id="fd127-658">\* You cannot access instance-level <xref:System.Windows.Input.InputBinding> objects from multiple threads, due to the restrictions of the <xref:System.Windows.DependencyObject> class.</span></span><br><span data-ttu-id="fd127-659">\* 因為 <xref:System.Windows.Freezable> 類別的限制，所以您無法在註冊之後變動類別層級輸入繫結。</span><span class="sxs-lookup"><span data-stu-id="fd127-659">\* You cannot mutate class-level input bindings after their registration, due to the restrictions of the <xref:System.Windows.Freezable> class.</span></span><br><span data-ttu-id="fd127-660">\* 您無法在檢視模型中所建立的命令執行個體上指定輸入繫結。</span><span class="sxs-lookup"><span data-stu-id="fd127-660">\* You cannot specify input bindings on command instances that are created in a View-Model.</span></span> | <span data-ttu-id="fd127-661">如果繫結是可變動的，或要凍結它們，請在個別執行緒上建立不同的 <xref:System.Windows.Input.InputBinding> 類別執行個體。</span><span class="sxs-lookup"><span data-stu-id="fd127-661">Create separate instances of an <xref:System.Windows.Input.InputBinding> class on separate threads if bindings are to be mutable, or freeze them otherwise.</span></span> <span data-ttu-id="fd127-662">類別層級靜態 <xref:System.Windows.Input.InputBinding> 在註冊之後，就請不要進行變動。</span><span class="sxs-lookup"><span data-stu-id="fd127-662">Do not mutate a class-level static <xref:System.Windows.Input.InputBinding> after it has been registered.</span></span> |
| **<span data-ttu-id="fd127-663">瀏覽器應用程式</span><span class="sxs-lookup"><span data-stu-id="fd127-663">Browser applications</span></span>** | <span data-ttu-id="fd127-664">WPF 瀏覽器應用程式 (.XBAP) 現在會處理獨立 WPF 應用程式這類重要事件，因此物件會依正確順序接收已路由傳送的重要事件。</span><span class="sxs-lookup"><span data-stu-id="fd127-664">WPF Browser applications (.XBAP) now process key events just like stand-alone WPF applications so that objects receive routed key events in the correct order.</span></span> | <span data-ttu-id="fd127-665">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-665">None.</span></span> |
| **<span data-ttu-id="fd127-666">廢鍵組合</span><span class="sxs-lookup"><span data-stu-id="fd127-666">Dead key combinations</span></span>** | <span data-ttu-id="fd127-667">WPF 會讓廢鍵模糊，因此不產生任何可見字元，而是改成指出按鍵是要與下一個字母鍵合併使用以產生一個字元。</span><span class="sxs-lookup"><span data-stu-id="fd127-667">WPF obfuscates dead keys, which produce no visible character, but instead indicates that the key is to be combined with the next letter key to produce one character.</span></span> <span data-ttu-id="fd127-668"><xref:System.Windows.Input.Keyboard.KeyDownEvent> 事件這類按鍵輸入事件，透過將 <xref:System.Windows.Input.KeyEventArgs.Key> 屬性設定為 <xref:System.Windows.Input.Key> 值報告按鍵何時是廢鍵。</span><span class="sxs-lookup"><span data-stu-id="fd127-668">The key input events, such as the <xref:System.Windows.Input.Keyboard.KeyDownEvent> event, report when a key is a dead key by setting the <xref:System.Windows.Input.KeyEventArgs.Key> property to the <xref:System.Windows.Input.Key> value.</span></span> <span data-ttu-id="fd127-669">因為應用程式通常不想要回應可建立合併字元的鍵盤輸入，所以這通常是預期行為。</span><span class="sxs-lookup"><span data-stu-id="fd127-669">This is usually expected behavior because applications usually do not intend to respond to keyboard input that creates a combined character.</span></span> | <span data-ttu-id="fd127-670">預期會讀取屬於組合字元之按鍵的應用程式可以使用 <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> 屬性來取得現在的模糊按鍵。</span><span class="sxs-lookup"><span data-stu-id="fd127-670">Applications that expect to read keys that were part of combined characters can get the now obfuscated key by using the <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> property.</span></span> |
| **<span data-ttu-id="fd127-671">焦點管理員</span><span class="sxs-lookup"><span data-stu-id="fd127-671">Focus manager</span></span>** | <span data-ttu-id="fd127-672">將 [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) 附加屬性設定為 `true` 的項目傳遞給 <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> 方法時，此方法會傳回為該焦點範圍內最後一個鍵盤聚焦項目的項目，而且只有在所傳回的項目屬於與傳遞給方法的項目相同的 <xref:System.Windows.PresentationSource> 物件時。</span><span class="sxs-lookup"><span data-stu-id="fd127-672">When the <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> method is passed an element that has the [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) attached property set to `true`, the method returns an element that is the last keyboard-focused element within that focus scope if and only if the returned element belongs to the same <xref:System.Windows.PresentationSource> object as the element that is passed to the method.</span></span> | <span data-ttu-id="fd127-673">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-673">None.</span></span> |

### <a name="ui-automation"></a><span data-ttu-id="fd127-674">UI 自動化</span><span class="sxs-lookup"><span data-stu-id="fd127-674">UI Automation</span></span>

<span data-ttu-id="fd127-675">命名空間：<xref:System.Windows>、<xref:System.Windows.Automation.Peers>、<xref:System.Windows.Automation.Provider>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>；組件：PresentationFramework (在 PresentationFramework.dll 中)、PresentationCore (在 PresentationCore.dll 中)、UIAutomationProvider (在 UIAutomationProvider.dll 中)、WindowsBase (在 WindowsBase.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-675">Namespace: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), UIAutomationProvider (in UIAutomationProvider.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="fd127-676">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-676">Feature</span></span> | <span data-ttu-id="fd127-677">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-677">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-678">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-678">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-679">檢視類別階層</span><span class="sxs-lookup"><span data-stu-id="fd127-679">Class hierarchy of views</span></span>** | <span data-ttu-id="fd127-680"><xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> 和 <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> 類別繼承自 <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>，而不是 <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>。</span><span class="sxs-lookup"><span data-stu-id="fd127-680">The <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> and <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes inherit from <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> instead of <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span></span> | <span data-ttu-id="fd127-681">如果您繼承自 <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> 類別並覆寫 <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> 方法，請考慮傳回繼承自新 <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> 類別的物件。</span><span class="sxs-lookup"><span data-stu-id="fd127-681">If you inherit from the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes and override the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> method, consider returning an object that inherits from the new <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> class.</span></span> |
| **<span data-ttu-id="fd127-682">移出螢幕的容器</span><span class="sxs-lookup"><span data-stu-id="fd127-682">Containers off screen</span></span>** | <span data-ttu-id="fd127-683">為了修正不正確的傳回值，<xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> 方法現在會正確傳回捲出檢視之項目容器的 `false`。</span><span class="sxs-lookup"><span data-stu-id="fd127-683">To fix an incorrect return value, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> method now correctly returns `false` for item containers that are scrolled out of view.</span></span> <span data-ttu-id="fd127-684">此外，其他視窗閉塞不會影響方法的值，項目是否出現在特定監視器也不會影響方法的值。</span><span class="sxs-lookup"><span data-stu-id="fd127-684">Also, the value of the method is not affected by occlusion by other windows, or by whether the element is visible on a specific monitor.</span></span> | <span data-ttu-id="fd127-685">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-685">None.</span></span> |
| **<span data-ttu-id="fd127-686">功能表和子物件</span><span class="sxs-lookup"><span data-stu-id="fd127-686">Menus and child objects</span></span>** | <span data-ttu-id="fd127-687">若要啟用功能表的 UI 自動化，而功能表包含 <xref:System.Windows.Controls.MenuItem> 物件以外的子系，則 <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> 方法現在會傳回子系 <xref:System.Windows.UIElement> 物件的 <xref:System.Windows.Automation.Peers.AutomationPeer> 物件，而不是 <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> 物件。</span><span class="sxs-lookup"><span data-stu-id="fd127-687">To enable UI automation of menus that contain children other than <xref:System.Windows.Controls.MenuItem> objects, the <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> method now returns the <xref:System.Windows.Automation.Peers.AutomationPeer> object of a child <xref:System.Windows.UIElement> object, instead of a <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> object.</span></span> | <span data-ttu-id="fd127-688">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-688">None.</span></span> |
| **<span data-ttu-id="fd127-689">新增介面和組件</span><span class="sxs-lookup"><span data-stu-id="fd127-689">New interfaces and assembly</span></span>** | <span data-ttu-id="fd127-690">若要啟用 UI 自動化的新功能，已新增下列介面：</span><span class="sxs-lookup"><span data-stu-id="fd127-690">To enable new features for UI automation, the following interfaces were added:</span></span><br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | <span data-ttu-id="fd127-691">任何建置 WPF 自動化對等的專案都必須新增 UIAutomationProvider.dll 的明確參考。</span><span class="sxs-lookup"><span data-stu-id="fd127-691">Any project that builds WPF automation peers must add an explicit reference to UIAutomationProvider.dll.</span></span> |
| **<span data-ttu-id="fd127-692">縮圖</span><span class="sxs-lookup"><span data-stu-id="fd127-692">Thumbs</span></span>** | <span data-ttu-id="fd127-693"><xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> 方法會傳回值，而不是 Null。</span><span class="sxs-lookup"><span data-stu-id="fd127-693">The <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> method returns a value instead of null.</span></span> <span data-ttu-id="fd127-694">因此，繼承自 <xref:System.Windows.Controls.Primitives.Thumb> 類別的 <xref:System.Windows.Controls.GridSplitter> 這類控制項會向 UI 自動化報告名稱。</span><span class="sxs-lookup"><span data-stu-id="fd127-694">Therefore, controls such as <xref:System.Windows.Controls.GridSplitter> that inherit from the <xref:System.Windows.Controls.Primitives.Thumb> class will report a name to UI Automation.</span></span> | <span data-ttu-id="fd127-695">無。</span><span class="sxs-lookup"><span data-stu-id="fd127-695">None.</span></span> |
| **<span data-ttu-id="fd127-696">虛擬化項目</span><span class="sxs-lookup"><span data-stu-id="fd127-696">Virtualized elements</span></span>** | <span data-ttu-id="fd127-697">為了改善效能，<xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> 方法只會傳回實際在視覺化樹狀結構中的子物件，而不是所有子物件，不論是否已將它們視覺化。</span><span class="sxs-lookup"><span data-stu-id="fd127-697">To improve performance, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> method returns only the child objects that are actually in the visual tree, instead of all child objects, regardless of whether they are virtualized.</span></span> | <span data-ttu-id="fd127-698">使用 <xref:System.Windows.Automation.ItemContainerPattern> 反覆查看 <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> 的所有項目。</span><span class="sxs-lookup"><span data-stu-id="fd127-698">Use <xref:System.Windows.Automation.ItemContainerPattern> to iterate over all items of an <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>.</span></span> |

### <a name="xaml"></a><span data-ttu-id="fd127-699">XAML</span><span class="sxs-lookup"><span data-stu-id="fd127-699">XAML</span></span>

<span data-ttu-id="fd127-700">命名空間：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>、<xref:System.Windows.Markup>；組件：PresentationFramework (在 PresentationFramework.dll 中)、PresentationCore (在 PresentationCore.dll 中)、WindowsBase (在 WindowsBase.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-700">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="fd127-701">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-701">Feature</span></span> | <span data-ttu-id="fd127-702">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-702">Differences from 3.5 SP1</span></span> | <span data-ttu-id="fd127-703">建議變更</span><span class="sxs-lookup"><span data-stu-id="fd127-703">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| **<span data-ttu-id="fd127-704">標記延伸</span><span class="sxs-lookup"><span data-stu-id="fd127-704">Markup extension</span></span>** | <span data-ttu-id="fd127-705">WPF 現在一律會正確地使用 <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> 方法的值，而不是在使用標記延伸來設定屬性或在集合中建立項目的特定情況下傳回 <xref:System.Windows.Markup.MarkupExtension> 物件。</span><span class="sxs-lookup"><span data-stu-id="fd127-705">WPF now correctly always uses the value from the <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> method instead of returning the <xref:System.Windows.Markup.MarkupExtension> object in certain cases when a markup extension is used to set a property or to create an item in a collection.</span></span> <span data-ttu-id="fd127-706">在某些情況下，標記延伸可能會傳回它自己。</span><span class="sxs-lookup"><span data-stu-id="fd127-706">A markup extension might return itself in some cases.</span></span> | <span data-ttu-id="fd127-707">如果您的應用程式存取已在舊版本中傳回 <xref:System.Windows.Markup.MarkupExtension> 物件的資源，請參考從 <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> 所傳回的物件，而不是 <xref:System.Windows.Markup.MarkupExtension> 物件。</span><span class="sxs-lookup"><span data-stu-id="fd127-707">If your application accesses a resource that returned a <xref:System.Windows.Markup.MarkupExtension> object in earlier versions, reference the object that is returned from <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, instead of the <xref:System.Windows.Markup.MarkupExtension> object.</span></span> |
| **<span data-ttu-id="fd127-708">剖析屬性</span><span class="sxs-lookup"><span data-stu-id="fd127-708">Parsing attributes</span></span>** | <span data-ttu-id="fd127-709">XAML 中的屬性現在只能有一個句點。</span><span class="sxs-lookup"><span data-stu-id="fd127-709">Attributes in XAML can now have only one period.</span></span> <span data-ttu-id="fd127-710">例如，下列有效：</span><span class="sxs-lookup"><span data-stu-id="fd127-710">For example, the following are valid:</span></span><br><br>`<Button Background="Red"/>` <span data-ttu-id="fd127-711">(沒有句點)</span><span class="sxs-lookup"><span data-stu-id="fd127-711">(no periods)</span></span><br><br>`<Button Button.Background = "Red"/>` <span data-ttu-id="fd127-712">(一個句點)</span><span class="sxs-lookup"><span data-stu-id="fd127-712">(one period)</span></span><br><br><span data-ttu-id="fd127-713">下列不再有效：</span><span class="sxs-lookup"><span data-stu-id="fd127-713">The following is no longer valid:</span></span><br><br>`<Button Control.Button.Background = "Red"/>` <span data-ttu-id="fd127-714">(多個句點)</span><span class="sxs-lookup"><span data-stu-id="fd127-714">(more than one period)</span></span> | <span data-ttu-id="fd127-715">更正有多個句點的 XAML 屬性。</span><span class="sxs-lookup"><span data-stu-id="fd127-715">Correct XAML attributes that have more than one period.</span></span> |

## <a name="xml"></a><span data-ttu-id="fd127-716">XML</span><span class="sxs-lookup"><span data-stu-id="fd127-716">XML</span></span>

<span data-ttu-id="fd127-717">此表中的資料列描述先前有限制或其他問題之功能的改善。</span><span class="sxs-lookup"><span data-stu-id="fd127-717">The rows in this table describe improvements to features that previously had limitations or other issues.</span></span>

### <a name="schema-and-transforms"></a><span data-ttu-id="fd127-718">結構描述和轉換</span><span class="sxs-lookup"><span data-stu-id="fd127-718">Schema and transforms</span></span>

<span data-ttu-id="fd127-719">命名空間：<xref:System.Xml.Linq>、<xref:System.Xml.Schema>、<xref:System.Xml.XPath>；組件：System.Xml (在 System.Xml.dll 中)、System.Xml.Linq (在 System.Xml.Linq.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-719">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="fd127-720">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-720">Feature</span></span> | <span data-ttu-id="fd127-721">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-721">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-722">Chameleon 結構描述</span><span class="sxs-lookup"><span data-stu-id="fd127-722">Chameleon schemas</span></span>** | <span data-ttu-id="fd127-723">為了避免資料損毀，現在，Chameleon 結構描述隨附於多個結構描述時會正確地進行複製。</span><span class="sxs-lookup"><span data-stu-id="fd127-723">To prevent data corruption, chameleon schemas are now cloned correctly when they are included with multiple schemas.</span></span><br><br><span data-ttu-id="fd127-724">Chameleon 結構描述是沒有目標命名空間的結構描述，而且它們包含於其他 XSD 時，會採用匯入結構描述的目標命名空間。</span><span class="sxs-lookup"><span data-stu-id="fd127-724">Chameleon schemas are schemas that do not have a target namespace, and when they are included in another XSD, they take on the target namespace of the importing schema.</span></span> <span data-ttu-id="fd127-725">它們通常用來將一般類型併入結構描述中。</span><span class="sxs-lookup"><span data-stu-id="fd127-725">They are often used to include common types into a schema.</span></span> |
| **<span data-ttu-id="fd127-726">ID 函式</span><span class="sxs-lookup"><span data-stu-id="fd127-726">ID functions</span></span>** | <span data-ttu-id="fd127-727">將 <xref:System.Xml.XmlReader> 物件傳遞給 XLST 時，XSLT [id 函式](/sql/xquery/functions-on-sequences-id)現在會傳回正確值，而不是 Null。</span><span class="sxs-lookup"><span data-stu-id="fd127-727">The XSLT [id function](/sql/xquery/functions-on-sequences-id) now returns the correct value instead of null when an <xref:System.Xml.XmlReader> object is passed to an XLST.</span></span><br><br><span data-ttu-id="fd127-728">如果使用者已使用 <xref:System.Xml.Linq.XNode.CreateReader%2A> 方法從 LINQ to XML 類別建立 <xref:System.Xml.XmlReader> 物件，並且這個 <xref:System.Xml.XmlReader> 物件會傳遞至 XSLT，在過去，XSLT 中 `id` 函式的任何執行個體會傳回 Null。</span><span class="sxs-lookup"><span data-stu-id="fd127-728">If the user created an <xref:System.Xml.XmlReader> object from a LINQ to XML class by using the <xref:System.Xml.Linq.XNode.CreateReader%2A> method, and this <xref:System.Xml.XmlReader> object was passed to an XSLT, any instances of the `id` function in the XSLT previously returned null.</span></span> <span data-ttu-id="fd127-729">這不是 `id` 函式的允許傳回值。</span><span class="sxs-lookup"><span data-stu-id="fd127-729">This is not an allowed return value for the `id` function.</span></span> |
| **<span data-ttu-id="fd127-730">Namespace 屬性</span><span class="sxs-lookup"><span data-stu-id="fd127-730">Namespace attribute</span></span>** | <span data-ttu-id="fd127-731">為了避免資料損毀，<xref:System.Xml.XPath.XPathNavigator> 物件現在會正確地傳回 `x:xmlns` 屬性的本機名稱。</span><span class="sxs-lookup"><span data-stu-id="fd127-731">To prevent data corruption, an <xref:System.Xml.XPath.XPathNavigator> object now returns the local name of the `x:xmlns` attribute correctly.</span></span> |
| **<span data-ttu-id="fd127-732">命名空間宣告</span><span class="sxs-lookup"><span data-stu-id="fd127-732">Namespace declarations</span></span>** | <span data-ttu-id="fd127-733">子樹上的 <xref:System.Xml.XmlReader> 物件不再於一個 XML 項目內建立重複的命名空間宣告。</span><span class="sxs-lookup"><span data-stu-id="fd127-733">An <xref:System.Xml.XmlReader> object on a sub-tree no longer creates duplicate namespace declarations within one XML element.</span></span> |
| **<span data-ttu-id="fd127-734">結構描述驗證</span><span class="sxs-lookup"><span data-stu-id="fd127-734">Schema validation</span></span>** | <span data-ttu-id="fd127-735">為了防止錯誤的結構描述驗證，<xref:System.Xml.Schema.XmlSchemaSet> 類別允許正確且一致地編譯 XSD 結構描述。</span><span class="sxs-lookup"><span data-stu-id="fd127-735">To prevent erroneous schema validation, the <xref:System.Xml.Schema.XmlSchemaSet> class allows for XSD schemas to be compiled correctly and consistently.</span></span> <span data-ttu-id="fd127-736">這些結構描述可以包含其他結構描述；例如，`A.xsd` 可以包含 `B.xsd`，而後者可以包含 `C.xsd`。</span><span class="sxs-lookup"><span data-stu-id="fd127-736">These schemas can include other schemas; for example, `A.xsd` can include `B.xsd`, which can include `C.xsd`.</span></span> <span data-ttu-id="fd127-737">編譯任何其中一個可周遊這個相依性圖表。</span><span class="sxs-lookup"><span data-stu-id="fd127-737">Compiling any one of these causes this graph of dependencies to be traversed.</span></span> |
| **<span data-ttu-id="fd127-738">指令碼函式</span><span class="sxs-lookup"><span data-stu-id="fd127-738">Script functions</span></span>** | <span data-ttu-id="fd127-739">函式實際可用時，[function-available 函式](https://msdn.microsoft.com/library/ms256124(v=vs.110).aspx)不再正確地傳回 `false`。</span><span class="sxs-lookup"><span data-stu-id="fd127-739">The [function-available function](https://msdn.microsoft.com/library/ms256124(v=vs.110).aspx) no longer incorrectly returns `false` when the function is actually available.</span></span> |
| **<span data-ttu-id="fd127-740">URI</span><span class="sxs-lookup"><span data-stu-id="fd127-740">URIs</span></span>** | <span data-ttu-id="fd127-741"><xref:System.Xml.Linq.XElement.Load%2A> 方法現在會在 LINQ 查詢中傳回正確的 BaseURI。</span><span class="sxs-lookup"><span data-stu-id="fd127-741">The <xref:System.Xml.Linq.XElement.Load%2A> method now returns the correct BaseURI in LINQ queries.</span></span> |

### <a name="validation"></a><span data-ttu-id="fd127-742">驗證</span><span class="sxs-lookup"><span data-stu-id="fd127-742">Validation</span></span>

<span data-ttu-id="fd127-743">命名空間：<xref:System.Xml.Linq>、<xref:System.Xml.Schema>、<xref:System.Xml.XPath>；組件：System.Xml (在 System.Xml.dll 中)、System.Xml.Linq (在 System.Xml.Linq.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-743">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="fd127-744">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-744">Feature</span></span> | <span data-ttu-id="fd127-745">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-745">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-746">命名空間解析程式</span><span class="sxs-lookup"><span data-stu-id="fd127-746">Namespace resolvers</span></span>** | <span data-ttu-id="fd127-747"><xref:System.Xml.XmlReader.ReadContentAs%2A> 方法不再忽略傳遞給它的 <xref:System.Xml.IXmlNamespaceResolver> 解析程式。</span><span class="sxs-lookup"><span data-stu-id="fd127-747">The <xref:System.Xml.XmlReader.ReadContentAs%2A> method no longer ignores the <xref:System.Xml.IXmlNamespaceResolver> resolver passed to it.</span></span><br><br><span data-ttu-id="fd127-748">在舊版本中，已忽略指定的命名空間解析程式，並改成使用 <xref:System.Xml.XmlReader>。</span><span class="sxs-lookup"><span data-stu-id="fd127-748">In previous versions, the specified namespace resolver was ignored, and the <xref:System.Xml.XmlReader> was used instead.</span></span> |
| **<span data-ttu-id="fd127-749">空白字元</span><span class="sxs-lookup"><span data-stu-id="fd127-749">White space</span></span>** | <span data-ttu-id="fd127-750">為了避免在建立讀取器時資料遺失，<xref:System.Xml.XmlReader.Create%2A> 方法不再捨棄明顯的空白字元。</span><span class="sxs-lookup"><span data-stu-id="fd127-750">To prevent data loss when you are creating a reader, the <xref:System.Xml.XmlReader.Create%2A> method no longer discards significant white space.</span></span><br><br><span data-ttu-id="fd127-751">XML 驗證會辨識混合內容模式，其中，文字可以與 XML 標記混合使用。</span><span class="sxs-lookup"><span data-stu-id="fd127-751">XML validation recognizes mixed-content mode, where text can be intermixed with XML markup.</span></span> <span data-ttu-id="fd127-752">在混合模式中，所有空白字元都是重要且應予以回報的。</span><span class="sxs-lookup"><span data-stu-id="fd127-752">In mixed mode, all white space is significant and should be reported.</span></span> |

### <a name="writing"></a><span data-ttu-id="fd127-753">撰寫</span><span class="sxs-lookup"><span data-stu-id="fd127-753">Writing</span></span>

<span data-ttu-id="fd127-754">命名空間：<xref:System.Xml.Linq>、<xref:System.Xml.Schema>、<xref:System.Xml.XPath>；組件：System.Xml (在 System.Xml.dll 中)、System.Xml.Linq (在 System.Xml.Linq.dll 中)</span><span class="sxs-lookup"><span data-stu-id="fd127-754">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="fd127-755">功能</span><span class="sxs-lookup"><span data-stu-id="fd127-755">Feature</span></span> | <span data-ttu-id="fd127-756">3.5 SP1 的差異</span><span class="sxs-lookup"><span data-stu-id="fd127-756">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| **<span data-ttu-id="fd127-757">實體參考</span><span class="sxs-lookup"><span data-stu-id="fd127-757">Entity references</span></span>** | <span data-ttu-id="fd127-758">為了避免資料損毀，不再於 XML 屬性中實體化實體參考兩次。</span><span class="sxs-lookup"><span data-stu-id="fd127-758">To prevent data corruption, entity references are no longer entitized twice in XML attributes.</span></span><br><br><span data-ttu-id="fd127-759">如果使用者使用 <xref:System.Xml.XmlWriter.WriteEntityRef%2A> 方法嘗試將實體寫入至 `xmlns` 屬性或 `xml:lang` or `xml:space` 屬性，則會在輸出中實體化實體兩次，因此損毀資料。</span><span class="sxs-lookup"><span data-stu-id="fd127-759">If the user tried to write an entity into an `xmlns` attribute or into an `xml:lang` or `xml:space` attribute by using the <xref:System.Xml.XmlWriter.WriteEntityRef%2A> method, the entity was entitized twice in the output, therefore corrupting the data.</span></span> |
| **<span data-ttu-id="fd127-760">換行處理</span><span class="sxs-lookup"><span data-stu-id="fd127-760">New line handling</span></span>** | <span data-ttu-id="fd127-761">為了避免資料損毀，<xref:System.Xml.XmlWriter> 物件會使用 <xref:System.Xml.NewLineHandling> 選項。</span><span class="sxs-lookup"><span data-stu-id="fd127-761">To prevent data corruption, <xref:System.Xml.XmlWriter> objects respect the <xref:System.Xml.NewLineHandling> option.</span></span> |

## <a name="see-also"></a><span data-ttu-id="fd127-762">另請參閱</span><span class="sxs-lookup"><span data-stu-id="fd127-762">See also</span></span>

### <a name="reference"></a><span data-ttu-id="fd127-763">參考資料</span><span class="sxs-lookup"><span data-stu-id="fd127-763">Reference</span></span>

- [<span data-ttu-id="fd127-764">.NET Framework 4 中的新型別和成員</span><span class="sxs-lookup"><span data-stu-id="fd127-764">New Types and Members in the .NET Framework 4</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)

### <a name="concepts"></a><span data-ttu-id="fd127-765">概念</span><span class="sxs-lookup"><span data-stu-id="fd127-765">Concepts</span></span>

- [<span data-ttu-id="fd127-766">.NET Framework 4 移轉手冊</span><span class="sxs-lookup"><span data-stu-id="fd127-766">Migration Guide to the .NET Framework 4</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [<span data-ttu-id="fd127-767">.NET Framework 4 的新功能</span><span class="sxs-lookup"><span data-stu-id="fd127-767">What's New in the .NET Framework 4</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [<span data-ttu-id="fd127-768">.NET Framework 的版本相容性</span><span class="sxs-lookup"><span data-stu-id="fd127-768">Version Compatibility in the .NET Framework</span></span>](../../../docs/framework/migration-guide/version-compatibility.md)
- [<span data-ttu-id="fd127-769">將 Office 方案移轉至 .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="fd127-769">Migrating Office Solutions to the .NET Framework 4</span></span>](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)

### <a name="other-resources"></a><span data-ttu-id="fd127-770">其他資源</span><span class="sxs-lookup"><span data-stu-id="fd127-770">Other resources</span></span>

- [<span data-ttu-id="fd127-771">.NET Framework 類別庫中的過時功能</span><span class="sxs-lookup"><span data-stu-id="fd127-771">What's Obsolete in the .NET Framework Class Library</span></span>](../whats-new/whats-obsolete.md)
