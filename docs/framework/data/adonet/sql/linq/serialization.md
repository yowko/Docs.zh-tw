---
title: Serialization2
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: a15ae411-8dc2-4ca3-84d2-01c9d5f1972a
caps.latest.revision: "3"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 02a8b9bf587f19fec25e629e11c0108e5994e3ba
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/17/2018
---
# <a name="serialization"></a><span data-ttu-id="92ea4-102">序列化</span><span class="sxs-lookup"><span data-stu-id="92ea4-102">Serialization</span></span>
<span data-ttu-id="92ea4-103">本主題描述[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]序列化功能。</span><span class="sxs-lookup"><span data-stu-id="92ea4-103">This topic describes [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] serialization capabilities.</span></span> <span data-ttu-id="92ea4-104">後續段落會提供有關如何在設計階段的程式碼產生期間加入序列化以及 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 類別 (Class) 的執行階段序列化行為。</span><span class="sxs-lookup"><span data-stu-id="92ea4-104">The paragraphs that follow provide information about how to add serialization during code generation at design time and the run-time serialization behavior of [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] classes.</span></span>  
  
 <span data-ttu-id="92ea4-105">您可以透過下列其中一種方法，在設計階段加入序列化程式碼：</span><span class="sxs-lookup"><span data-stu-id="92ea4-105">You can add serialization code at design time by either of the following methods:</span></span>  
  
-   <span data-ttu-id="92ea4-106">在[!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)]，變更**序列化模式**屬性**單向**。</span><span class="sxs-lookup"><span data-stu-id="92ea4-106">In the [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)], change the **Serialization Mode** property to **Unidirectional**.</span></span>  
  
-   <span data-ttu-id="92ea4-107">SQLMetal 命令列新增**/serialization**選項。</span><span class="sxs-lookup"><span data-stu-id="92ea4-107">On the SQLMetal command line, add the **/serialization** option.</span></span> <span data-ttu-id="92ea4-108">如需詳細資訊，請參閱 [SqlMetal.exe (程式碼產生工具)](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md)。</span><span class="sxs-lookup"><span data-stu-id="92ea4-108">For more information, see [SqlMetal.exe (Code Generation Tool)](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="92ea4-109">總覽</span><span class="sxs-lookup"><span data-stu-id="92ea4-109">Overview</span></span>  
 <span data-ttu-id="92ea4-110">產生的程式碼[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]根據預設會提供延後的載入功能。</span><span class="sxs-lookup"><span data-stu-id="92ea4-110">The code generated by [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] provides deferred loading capabilities by default.</span></span> <span data-ttu-id="92ea4-111">在視需要透明載入資料的中介層中，延後載入非常方便。</span><span class="sxs-lookup"><span data-stu-id="92ea4-111">Deferred loading is very convenient on the mid-tier for transparent loading of data on demand.</span></span> <span data-ttu-id="92ea4-112">但是，由於不論是否需要延後載入，序列化程式都會觸發延後載入，所以序列化會有問題。</span><span class="sxs-lookup"><span data-stu-id="92ea4-112">However, it is problematic for serialization, because the serializer triggers deferred loading whether deferred loading is intended or not.</span></span> <span data-ttu-id="92ea4-113">事實上，序列化物件後，在所有傳出延後載入的參考之下的遞移封閉 (Transitive Closure) 也已序列化。</span><span class="sxs-lookup"><span data-stu-id="92ea4-113">In effect, when an object is serialized, its transitive closure under all outbound defer-loaded references is serialized.</span></span>  
  
 <span data-ttu-id="92ea4-114">[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]序列化功能會處理這個問題，主要是透過兩種機制：</span><span class="sxs-lookup"><span data-stu-id="92ea4-114">The [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] serialization feature addresses this problem, primarily through two mechanisms:</span></span>  
  
-   <span data-ttu-id="92ea4-115">用於關閉延後載入的 <xref:System.Data.Linq.DataContext> 模式 (<xref:System.Data.Linq.DataContext.ObjectTrackingEnabled%2A>)。</span><span class="sxs-lookup"><span data-stu-id="92ea4-115">A <xref:System.Data.Linq.DataContext> mode for turning off deferred loading (<xref:System.Data.Linq.DataContext.ObjectTrackingEnabled%2A>).</span></span> <span data-ttu-id="92ea4-116">如需詳細資訊，請參閱<xref:System.Data.Linq.DataContext>。</span><span class="sxs-lookup"><span data-stu-id="92ea4-116">For more information, see <xref:System.Data.Linq.DataContext>.</span></span>  
  
-   <span data-ttu-id="92ea4-117">程式碼產生參數，用在產生的實體上產生 <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> 和 <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> 屬性 (Attribute)。</span><span class="sxs-lookup"><span data-stu-id="92ea4-117">A code-generation switch to generate <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> and <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> attributes on generated entities.</span></span> <span data-ttu-id="92ea4-118">這個方面 (包含序列化之下延後載入類別的行為) 為本主題的主旨。</span><span class="sxs-lookup"><span data-stu-id="92ea4-118">This aspect, including the behavior of defer-loading classes under serialization, is the major subject of this topic.</span></span>  
  
### <a name="definitions"></a><span data-ttu-id="92ea4-119">定義</span><span class="sxs-lookup"><span data-stu-id="92ea4-119">Definitions</span></span>  
  
-   <span data-ttu-id="92ea4-120">*DataContract 序列化程式*： 預設的.NET Framework 3.0 或更新版本的 Windows Communication Framework (WCF) 元件所使用的序列化程式。</span><span class="sxs-lookup"><span data-stu-id="92ea4-120">*DataContract serializer*: Default serializer used by the Windows Communication Framework (WCF) component of the .NET Framework 3.0 or later versions.</span></span>  
  
-   <span data-ttu-id="92ea4-121">*單向序列化*： 包含只有單向關聯屬性 （以避免循環） 之類別的序列化的版本。</span><span class="sxs-lookup"><span data-stu-id="92ea4-121">*Unidirectional serialization*: The serialized version of a class that contains only a one-way association property (to avoid a cycle).</span></span> <span data-ttu-id="92ea4-122">依照慣例，主索引鍵-外部索引鍵關聯性之父端上的屬性 (Poperty) 會標記為即將序列化。</span><span class="sxs-lookup"><span data-stu-id="92ea4-122">By convention, the property on the parent side of a primary-foreign key relationship is marked for serialization.</span></span> <span data-ttu-id="92ea4-123">雙向關聯中的另一端則不會序列化。</span><span class="sxs-lookup"><span data-stu-id="92ea4-123">The other side in a bidirectional association is not serialized.</span></span>  
  
     <span data-ttu-id="92ea4-124">單向序列化是 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 唯一支援的序列化類型。</span><span class="sxs-lookup"><span data-stu-id="92ea4-124">Unidirectional serialization is the only type of serialization supported by [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span></span>  
  
## <a name="code-example"></a><span data-ttu-id="92ea4-125">程式碼範例</span><span class="sxs-lookup"><span data-stu-id="92ea4-125">Code Example</span></span>  
 <span data-ttu-id="92ea4-126">下列程式碼會使用 Northwind 範例資料庫中的傳統 `Customer` 和 `Order` 類別，並且顯示如何使用序列化屬性 (Attribute) 裝飾這些類別。</span><span class="sxs-lookup"><span data-stu-id="92ea4-126">The following code uses the traditional `Customer` and `Order` classes from the Northwind sample database, and shows how these classes are decorated with serialization attributes.</span></span>  
  
 [!code-csharp[DLinqSerialization#1](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#1)]
 [!code-vb[DLinqSerialization#1](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#1)]  
  
 [!code-csharp[DLinqSerialization#2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#2)]
 [!code-vb[DLinqSerialization#2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#2)]  
  
 [!code-csharp[DLinqSerialization#3](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#3)]
 [!code-vb[DLinqSerialization#3](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#3)]  
  
 <span data-ttu-id="92ea4-127">至於下列範例中的 `Order` 類別，只有對應至 `Customer` 類別的反向關聯屬性 (Property) 會簡短顯示。</span><span class="sxs-lookup"><span data-stu-id="92ea4-127">For the `Order` class in the following example, only the reverse association property corresponding to the `Customer` class is shown for brevity.</span></span> <span data-ttu-id="92ea4-128">該類別沒有 `DataMember` 屬性 (Attribute) 可避免循環。</span><span class="sxs-lookup"><span data-stu-id="92ea4-128">It does not have a `DataMember` attribute to avoid a cycle.</span></span>  
  
 [!code-csharp[DLinqSerialization#4](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#4)]
 [!code-vb[DLinqSerialization#4](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#4)]  
  
 [!code-csharp[DLinqSerialization#5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#5)]
 [!code-vb[DLinqSerialization#5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#5)]  
  
### <a name="how-to-serialize-the-entities"></a><span data-ttu-id="92ea4-129">如何將實體序列化</span><span class="sxs-lookup"><span data-stu-id="92ea4-129">How to Serialize the Entities</span></span>  
 <span data-ttu-id="92ea4-130">您可以在上一節顯示的程式碼中將實體序列化，如下所示：</span><span class="sxs-lookup"><span data-stu-id="92ea4-130">You can serialize the entities in the codes shown in the previous section as follows;</span></span>  
  
 [!code-csharp[DLinqSerialization#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/Program.cs#6)]
 [!code-vb[DLinqSerialization#6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/Module1.vb#6)]  
  
### <a name="self-recursive-relationships"></a><span data-ttu-id="92ea4-131">自我遞迴關聯性</span><span class="sxs-lookup"><span data-stu-id="92ea4-131">Self-Recursive Relationships</span></span>  
 <span data-ttu-id="92ea4-132">自我遞迴關聯性會依循相同的模式。</span><span class="sxs-lookup"><span data-stu-id="92ea4-132">Self-recursive relationships follow the same pattern.</span></span> <span data-ttu-id="92ea4-133">對應至外部索引鍵的關聯屬性 (Property) 沒有 `DataMember` 屬性 (Attribute)，然而父屬性 (Property) 卻有該屬性 (Attribute)。</span><span class="sxs-lookup"><span data-stu-id="92ea4-133">The association property corresponding to the foreign key does not have a `DataMember` attribute, whereas the parent property does.</span></span>  
  
 <span data-ttu-id="92ea4-134">請考慮下列具有兩個自我遞迴關聯性的類別：Employee.Manager/Reports 和 Employee.Mentor/Mentees。</span><span class="sxs-lookup"><span data-stu-id="92ea4-134">Consider the following class that has two self-recursive relationships: Employee.Manager/Reports and Employee.Mentor/Mentees.</span></span>  
  
 [!code-csharp[DLinqSerialization#7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#7)]
 [!code-vb[DLinqSerialization#7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="92ea4-135">請參閱</span><span class="sxs-lookup"><span data-stu-id="92ea4-135">See Also</span></span>  
 [<span data-ttu-id="92ea4-136">背景資訊</span><span class="sxs-lookup"><span data-stu-id="92ea4-136">Background Information</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/background-information.md)  
 [<span data-ttu-id="92ea4-137">SqlMetal.exe (程式碼產生工具)</span><span class="sxs-lookup"><span data-stu-id="92ea4-137">SqlMetal.exe (Code Generation Tool)</span></span>](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md)  
 [<span data-ttu-id="92ea4-138">如何：讓實體可序列化</span><span class="sxs-lookup"><span data-stu-id="92ea4-138">How to: Make Entities Serializable</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md)
