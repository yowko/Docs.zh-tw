---
title: LINQ to DataSet 中的查詢
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: c1a78fa8-9f0c-40bc-a372-5575a48708fe
ms.openlocfilehash: 5aaf33e5e2379ace4d32c59bd842889d0f9e32da
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/07/2019
ms.locfileid: "70794532"
---
# <a name="queries-in-linq-to-dataset"></a><span data-ttu-id="76998-102">LINQ to DataSet 中的查詢</span><span class="sxs-lookup"><span data-stu-id="76998-102">Queries in LINQ to DataSet</span></span>
<span data-ttu-id="76998-103">查詢是指從資料來源中擷取資料的運算式。</span><span class="sxs-lookup"><span data-stu-id="76998-103">A query is an expression that retrieves data from a data source.</span></span> <span data-ttu-id="76998-104">查詢通常會以特定的查詢語言來表示，例如 SQL 用於關聯式資料庫，而 XQuery 用於 XML。</span><span class="sxs-lookup"><span data-stu-id="76998-104">Queries are usually expressed in a specialized query language, such as SQL for relational databases and XQuery for XML.</span></span> <span data-ttu-id="76998-105">因此，開發人員必須針對他們所查詢的每種資料來源或資料格式，學習新的查詢語言。</span><span class="sxs-lookup"><span data-stu-id="76998-105">Therefore, developers have had to learn a new query language for each type of data source or data format that they query.</span></span> [!INCLUDE[vbteclinqext](../../../../includes/vbteclinqext-md.md)] <span data-ttu-id="76998-106">提供了一種較簡單且一致的模型，可處理各種資料來源和格式的資料。</span><span class="sxs-lookup"><span data-stu-id="76998-106">offers a simpler, consistent model for working with data across various kinds of data sources and formats.</span></span> <span data-ttu-id="76998-107">在 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 查詢中，您一定會使用程式設計物件。</span><span class="sxs-lookup"><span data-stu-id="76998-107">In a [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] query, you always work with programming objects.</span></span>  
  
 <span data-ttu-id="76998-108">[!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 查詢作業由三個動作構成：取得資料來源、建立查詢和執行查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-108">A [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] query operation consists of three actions: obtain the data source or sources, create the query, and execute the query.</span></span>  
  
 <span data-ttu-id="76998-109">您可以透過 <xref:System.Collections.Generic.IEnumerable%601> 查詢實作 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 泛型介面的資料來源。</span><span class="sxs-lookup"><span data-stu-id="76998-109">Data sources that implement the <xref:System.Collections.Generic.IEnumerable%601> generic interface can be queried through [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)].</span></span> <span data-ttu-id="76998-110">在上<xref:System.Data.DataTableExtensions.AsEnumerable%2A> <xref:System.Collections.Generic.IEnumerable%601>呼叫會傳回物件，它會實作為 LINQ to DataSet 查詢的資料來源。 <xref:System.Data.DataTable></span><span class="sxs-lookup"><span data-stu-id="76998-110">Calling <xref:System.Data.DataTableExtensions.AsEnumerable%2A> on a <xref:System.Data.DataTable> returns an object which implements the generic <xref:System.Collections.Generic.IEnumerable%601> interface, which serves as the data source for LINQ to DataSet queries.</span></span>  
  
 <span data-ttu-id="76998-111">在此查詢中，您可以精確地指定想要從資料來源中擷取的資訊。</span><span class="sxs-lookup"><span data-stu-id="76998-111">In the query, you specify exactly the information that you want to retrieve from the data source.</span></span> <span data-ttu-id="76998-112">此外，查詢也可以指定該項資訊傳回之前應該如何排序、分組和成形。</span><span class="sxs-lookup"><span data-stu-id="76998-112">A query can also specify how that information should be sorted, grouped, and shaped before it is returned.</span></span> <span data-ttu-id="76998-113">在 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 中，查詢會儲存在變數內。</span><span class="sxs-lookup"><span data-stu-id="76998-113">In [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)], a query is stored in a variable.</span></span> <span data-ttu-id="76998-114">如果查詢設計成傳回值的序列 (Sequence)，查詢變數本身就必須是可列舉的型別。</span><span class="sxs-lookup"><span data-stu-id="76998-114">If the query is designed to return a sequence of values, the query variable itself must be a enumerable type.</span></span> <span data-ttu-id="76998-115">這個查詢變數不會採取任何動作，也不會傳回任何資料。它只會儲存查詢資訊。</span><span class="sxs-lookup"><span data-stu-id="76998-115">This query variable takes no action and returns no data; it only stores the query information.</span></span> <span data-ttu-id="76998-116">在您建立查詢之後，必須執行該查詢以便擷取任何資料。</span><span class="sxs-lookup"><span data-stu-id="76998-116">After you create a query you must execute that query to retrieve any data.</span></span>  
  
 <span data-ttu-id="76998-117">在傳回值序列的查詢中，查詢變數本身絕不會保存查詢結果，只會儲存查詢命令而已。</span><span class="sxs-lookup"><span data-stu-id="76998-117">In a query that returns a sequence of values, the query variable itself never holds the query results and only stores the query commands.</span></span> <span data-ttu-id="76998-118">查詢的執行會延後，直到在 `foreach` 或 `For Each` 迴圈 (Loop) 中反覆查看查詢變數為止。</span><span class="sxs-lookup"><span data-stu-id="76998-118">Execution of the query is deferred until the query variable is iterated over in a `foreach` or `For Each` loop.</span></span> <span data-ttu-id="76998-119">這稱為「*延後執行*」;也就是說，查詢執行會在查詢經過一段時間之後發生。</span><span class="sxs-lookup"><span data-stu-id="76998-119">This is called *deferred execution*; that is, query execution occurs some time after the query is constructed.</span></span> <span data-ttu-id="76998-120">這表示，您可以依照想要的頻率來執行查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-120">This means that you can execute a query as often as you want to.</span></span> <span data-ttu-id="76998-121">例如，當您擁有一個正由其他應用程式更新的資料庫時，這就很有用。</span><span class="sxs-lookup"><span data-stu-id="76998-121">This is useful when, for example, you have a database that is being updated by other applications.</span></span> <span data-ttu-id="76998-122">您可以在應用程式中建立擷取最新資訊的查詢，然後重複執行此查詢，以便每次都傳回更新的資訊。</span><span class="sxs-lookup"><span data-stu-id="76998-122">In your application, you can create a query to retrieve the latest information and repeatedly execute the query, returning the updated information every time.</span></span>  
  
 <span data-ttu-id="76998-123">相較於傳回值序列的延後查詢，傳回單一子句值的查詢會立即執行。</span><span class="sxs-lookup"><span data-stu-id="76998-123">In contrast to deferred queries, which return a sequence of values, queries that return a singleton value are executed immediately.</span></span> <span data-ttu-id="76998-124">單一子句查詢的某些範例包括 <xref:System.Linq.Enumerable.Count%2A>、<xref:System.Linq.Enumerable.Max%2A>、<xref:System.Linq.Enumerable.Average%2A> 和 <xref:System.Linq.Enumerable.First%2A>。</span><span class="sxs-lookup"><span data-stu-id="76998-124">Some examples of singleton queries are <xref:System.Linq.Enumerable.Count%2A>, <xref:System.Linq.Enumerable.Max%2A>, <xref:System.Linq.Enumerable.Average%2A>, and <xref:System.Linq.Enumerable.First%2A>.</span></span> <span data-ttu-id="76998-125">這些查詢會立即執行，因為系統需要查詢結果來計算單一子句結果。</span><span class="sxs-lookup"><span data-stu-id="76998-125">These execute immediately because the query results are required to calculate the singleton result.</span></span> <span data-ttu-id="76998-126">例如，若要尋找查詢結果的平均值，您必須執行查詢，如此平均函式才有輸入資料可處理。</span><span class="sxs-lookup"><span data-stu-id="76998-126">For example, in order to find the average of the query results the query must be executed so that the averaging function has input data to work with.</span></span> <span data-ttu-id="76998-127">此外，您也可以針對查詢使用 <xref:System.Linq.Enumerable.ToList%2A> 或 <xref:System.Linq.Enumerable.ToArray%2A> 方法，強制立即執行不會產生單一子句值的查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-127">You can also use the <xref:System.Linq.Enumerable.ToList%2A> or <xref:System.Linq.Enumerable.ToArray%2A> methods on a query to force immediate execution of a query that does not produce a singleton value.</span></span> <span data-ttu-id="76998-128">當您想要快取查詢的結果時，這些強制立即執行的技巧就很有用。</span><span class="sxs-lookup"><span data-stu-id="76998-128">These techniques to force immediate execution can be useful when you want to cache the results of a query.</span></span>
  
## <a name="queries"></a><span data-ttu-id="76998-129">查詢</span><span class="sxs-lookup"><span data-stu-id="76998-129">Queries</span></span>  
 <span data-ttu-id="76998-130">LINQ to DataSet 查詢可以用兩種不同的語法來撰寫：查詢運算式語法和以方法為基礎的查詢語法。</span><span class="sxs-lookup"><span data-stu-id="76998-130">LINQ to DataSet queries can be formulated in two different syntaxes: query expression syntax and method-based query syntax.</span></span>  
  
### <a name="query-expression-syntax"></a><span data-ttu-id="76998-131">查詢運算式語法</span><span class="sxs-lookup"><span data-stu-id="76998-131">Query Expression Syntax</span></span>  
 <span data-ttu-id="76998-132">查詢運算式是宣告式查詢語法。</span><span class="sxs-lookup"><span data-stu-id="76998-132">Query expressions are a declarative query syntax.</span></span> <span data-ttu-id="76998-133">這種語法可讓開發人員使用類似 SQL 的格式，在 C# 或 Visual Basic 中撰寫查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-133">This syntax enables a developer to write queries in C# or Visual Basic in a format similar to SQL.</span></span> <span data-ttu-id="76998-134">透過使用查詢運算式語法，您就可以利用最少的程式碼，針對資料來源執行同樣複雜的篩選、排序和分組作業。</span><span class="sxs-lookup"><span data-stu-id="76998-134">By using query expression syntax, you can perform even complex filtering, ordering, and grouping operations on data sources with minimal code.</span></span> <span data-ttu-id="76998-135">如需詳細資訊，請參閱[LINQ 查詢運算式](../../../csharp/linq/index.md#query-expression-overview)和[基本查詢作業（Visual Basic）](../../../visual-basic/programming-guide/concepts/linq/basic-query-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="76998-135">For more information, see [LINQ Query Expressions](../../../csharp/linq/index.md#query-expression-overview) and [Basic Query Operations (Visual Basic)](../../../visual-basic/programming-guide/concepts/linq/basic-query-operations.md).</span></span>
  
 <span data-ttu-id="76998-136">.NET Framework common language runtime （CLR）無法讀取查詢運算式語法本身。</span><span class="sxs-lookup"><span data-stu-id="76998-136">The .NET Framework common language runtime (CLR) cannot read the query expression syntax itself.</span></span> <span data-ttu-id="76998-137">因此，在編譯期間，查詢運算式會轉譯為 CLR 可以了解的項目：即方法呼叫。</span><span class="sxs-lookup"><span data-stu-id="76998-137">Therefore, at compile time, query expressions are translated to something that the CLR does understand: method calls.</span></span> <span data-ttu-id="76998-138">這些方法稱為*標準查詢運算子*。</span><span class="sxs-lookup"><span data-stu-id="76998-138">These methods are referred to as the *standard query operators*.</span></span> <span data-ttu-id="76998-139">身為開發人員，您可以選擇使用方法語法來直接呼叫它們，而非使用查詢語法。</span><span class="sxs-lookup"><span data-stu-id="76998-139">As a developer, you have the option of calling them directly by using method syntax, instead of using query syntax.</span></span> <span data-ttu-id="76998-140">如需詳細資訊，請參閱 [LINQ 中的查詢語法及方法語法](../../../csharp/programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq.md)。</span><span class="sxs-lookup"><span data-stu-id="76998-140">For more information, see [Query Syntax and Method Syntax in LINQ](../../../csharp/programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq.md).</span></span> <span data-ttu-id="76998-141">如需標準查詢運算子的詳細資訊，請參閱[標準查詢運算子總覽](../../../csharp/programming-guide/concepts/linq/standard-query-operators-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="76998-141">For more information about the standard query operators, see [Standard Query Operators Overview](../../../csharp/programming-guide/concepts/linq/standard-query-operators-overview.md).</span></span>  
  
 <span data-ttu-id="76998-142">下列範例會使用 <xref:System.Linq.Enumerable.Select%2A> 來傳回 `Product` 資料表中的所有資料列，並顯示產品名稱。</span><span class="sxs-lookup"><span data-stu-id="76998-142">The following example uses <xref:System.Linq.Enumerable.Select%2A> to return all the rows from `Product` table and display the product names.</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#SelectSimple1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#selectsimple1)]
 [!code-vb[DP LINQ to DataSet Examples#SelectSimple1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#selectsimple1)]  
  
### <a name="method-based-query-syntax"></a><span data-ttu-id="76998-143">以方法為基礎的查詢語法</span><span class="sxs-lookup"><span data-stu-id="76998-143">Method-Based Query Syntax</span></span>  
 <span data-ttu-id="76998-144">制訂 LINQ to DataSet 查詢的另一種方式是使用以方法為基礎的查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-144">The other way to formulate LINQ to DataSet queries is by using method-based queries.</span></span> <span data-ttu-id="76998-145">以方法為基礎的查詢語法是對 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 運算子方法之直接方法呼叫的序列，並傳遞 Lambda 運算式當做參數。</span><span class="sxs-lookup"><span data-stu-id="76998-145">The method-based query syntax is a sequence of direct method calls to [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] operator methods, passing lambda expressions as the parameters.</span></span> <span data-ttu-id="76998-146">如需詳細資訊，請參閱 [Lambda 運算式](../../../csharp/programming-guide/statements-expressions-operators/lambda-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="76998-146">For more information, see [Lambda Expressions](../../../csharp/programming-guide/statements-expressions-operators/lambda-expressions.md).</span></span>  
  
 <span data-ttu-id="76998-147">這則範例會使用 <xref:System.Linq.Enumerable.Select%2A> 來傳回 `Product` 資料表中的所有資料列，並顯示產品名稱。</span><span class="sxs-lookup"><span data-stu-id="76998-147">This example uses <xref:System.Linq.Enumerable.Select%2A> to return all the rows from `Product` and display the product names.</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#SelectAnonymousTypes_MQ](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#selectanonymoustypes_mq)]
 [!code-vb[DP LINQ to DataSet Examples#SelectAnonymousTypes_MQ](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#selectanonymoustypes_mq)]  
  
## <a name="composing-queries"></a><span data-ttu-id="76998-148">撰寫查詢</span><span class="sxs-lookup"><span data-stu-id="76998-148">Composing Queries</span></span>  
 <span data-ttu-id="76998-149">如本主題先前所述，當查詢設計為傳回值的序列時，查詢變數本身只會儲存查詢命令。</span><span class="sxs-lookup"><span data-stu-id="76998-149">As mentioned earlier in this topic, the query variable itself only stores the query commands when the query is designed to return a sequence of values.</span></span> <span data-ttu-id="76998-150">如果查詢沒有包含將導致立即執行的方法，查詢的實際執行將延後，直到您在 `foreach` 或 `For Each` 迴圈中反覆查看查詢變數為止。</span><span class="sxs-lookup"><span data-stu-id="76998-150">If the query does not contain a method that will cause immediate execution, the actual execution of the query is deferred until you iterate over the query variable in a `foreach` or `For Each` loop.</span></span> <span data-ttu-id="76998-151">延後執行可結合多個查詢或擴充單一查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-151">Deferred execution enables multiple queries to be combined or a query to be extended.</span></span> <span data-ttu-id="76998-152">擴充單一查詢時，它會修改成包含新的作業，而且最終的執行將反映這些變更。</span><span class="sxs-lookup"><span data-stu-id="76998-152">When a query is extended, it is modified to include the new operations, and the eventual execution will reflect the changes.</span></span> <span data-ttu-id="76998-153">在下列範例中，第一個查詢會傳回所有產品。</span><span class="sxs-lookup"><span data-stu-id="76998-153">In the following example, the first query returns all the products.</span></span> <span data-ttu-id="76998-154">第二個查詢會使用 `Where` 來擴充第一個查詢，以便傳回大小為 "L" 的所有產品：</span><span class="sxs-lookup"><span data-stu-id="76998-154">The second query extends the first by using `Where` to return all the products of size "L":</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#Composing](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#composing)]
 [!code-vb[DP LINQ to DataSet Examples#Composing](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#composing)]  
  
 <span data-ttu-id="76998-155">在您已經執行過查詢之後，便無法撰寫其他查詢，而且所有後續的查詢都將使用記憶體中 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 運算子。</span><span class="sxs-lookup"><span data-stu-id="76998-155">After a query has been executed, no additional queries can be composed, and all subsequent queries will use the in-memory [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] operators.</span></span> <span data-ttu-id="76998-156">當您逐一查看`foreach`或`For Each`語句中的查詢變數，或是呼叫導致立即執行的[!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)]其中一個轉換運算子時，就會執行查詢。</span><span class="sxs-lookup"><span data-stu-id="76998-156">Query execution will occur when you iterate over the query variable in a `foreach` or `For Each` statement, or by a call to one of the [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] conversion operators that cause immediate execution.</span></span> <span data-ttu-id="76998-157">這些運算子包括：<xref:System.Linq.Enumerable.ToList%2A>、<xref:System.Linq.Enumerable.ToArray%2A>、<xref:System.Linq.Enumerable.ToLookup%2A> 和 <xref:System.Linq.Enumerable.ToDictionary%2A>。</span><span class="sxs-lookup"><span data-stu-id="76998-157">These operators include the following: <xref:System.Linq.Enumerable.ToList%2A>, <xref:System.Linq.Enumerable.ToArray%2A>, <xref:System.Linq.Enumerable.ToLookup%2A>, and <xref:System.Linq.Enumerable.ToDictionary%2A>.</span></span>  
  
 <span data-ttu-id="76998-158">在下列範例中，第一個查詢會傳回所有產品，並依照標價排序。</span><span class="sxs-lookup"><span data-stu-id="76998-158">In the following example, the first query returns all the products ordered by list price.</span></span> <span data-ttu-id="76998-159"><xref:System.Linq.Enumerable.ToArray%2A> 方法是用來強制立即執行查詢：</span><span class="sxs-lookup"><span data-stu-id="76998-159">The <xref:System.Linq.Enumerable.ToArray%2A> method is used to force immediate query execution:</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#ToArray2](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#toarray2)]
 [!code-vb[DP LINQ to DataSet Examples#ToArray2](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#toarray2)]  
  
## <a name="see-also"></a><span data-ttu-id="76998-160">另請參閱</span><span class="sxs-lookup"><span data-stu-id="76998-160">See also</span></span>

- [<span data-ttu-id="76998-161">程式設計手冊</span><span class="sxs-lookup"><span data-stu-id="76998-161">Programming Guide</span></span>](programming-guide-linq-to-dataset.md)
- [<span data-ttu-id="76998-162">查詢資料集</span><span class="sxs-lookup"><span data-stu-id="76998-162">Querying DataSets</span></span>](querying-datasets-linq-to-dataset.md)
- [<span data-ttu-id="76998-163">開始使用 C# 中的 LINQ</span><span class="sxs-lookup"><span data-stu-id="76998-163">Getting Started with LINQ in C#</span></span>](../../../csharp/programming-guide/concepts/linq/getting-started-with-linq.md)
- [<span data-ttu-id="76998-164">使用 Visual Basic 撰寫 LINQ 入門</span><span class="sxs-lookup"><span data-stu-id="76998-164">Getting Started with LINQ in Visual Basic</span></span>](../../../visual-basic/programming-guide/concepts/linq/getting-started-with-linq.md)
