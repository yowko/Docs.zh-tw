---
title: 載入延後內容 (WCF 資料服務)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, client library
- WCF Data Services, deferred content
- WCF Data Services, loading data
ms.assetid: 32f9b588-c832-44c4-a7e0-fcce635df59a
ms.openlocfilehash: ee7b0b40d74d908dc4f25372273f852662370df0
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/23/2019
ms.locfileid: "62037124"
---
# <a name="loading-deferred-content-wcf-data-services"></a><span data-ttu-id="e344a-102">載入延後內容 (WCF 資料服務)</span><span class="sxs-lookup"><span data-stu-id="e344a-102">Loading Deferred Content (WCF Data Services)</span></span>
<span data-ttu-id="e344a-103">根據預設，[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] 會限制查詢傳回的資料量。</span><span class="sxs-lookup"><span data-stu-id="e344a-103">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] limits the amount of data that a query returns.</span></span> <span data-ttu-id="e344a-104">不過，您可以在需要時，從資料服務明確載入其他資料，包括相關實體、分頁回應資料以及二進位資料流。</span><span class="sxs-lookup"><span data-stu-id="e344a-104">However, you can explicitly load additional data, including related entities, paged response data, and binary data streams, from the data service when it is needed.</span></span> <span data-ttu-id="e344a-105">本主題描述如何將這些延後的內容載入至應用程式。</span><span class="sxs-lookup"><span data-stu-id="e344a-105">This topic describes how to load such deferred content into your application.</span></span>  
  
## <a name="related-entities"></a><span data-ttu-id="e344a-106">相關實體</span><span class="sxs-lookup"><span data-stu-id="e344a-106">Related Entities</span></span>  
 <span data-ttu-id="e344a-107">執行查詢時，只會傳回已定址之實體集中的實體。</span><span class="sxs-lookup"><span data-stu-id="e344a-107">When you execute a query, only entities in the addressed entity set are returned.</span></span> <span data-ttu-id="e344a-108">例如，針對 Northwind 資料服務的查詢傳回 `Customers` 實體時，即使 `Orders` 和 `Customers` 之間有關聯性，預設仍不會傳回相關的 `Orders` 實體。</span><span class="sxs-lookup"><span data-stu-id="e344a-108">For example, when a query against the Northwind data service returns `Customers` entities, by default the related `Orders` entities are not returned, even though there is a relationship between `Customers` and `Orders`.</span></span> <span data-ttu-id="e344a-109">另外，在資料服務中啟用分頁時，您必須從服務明確載入後續資料頁面。</span><span class="sxs-lookup"><span data-stu-id="e344a-109">Also, when paging is enabled in the data service, you must explicitly load subsequent data pages from the service.</span></span> <span data-ttu-id="e344a-110">有兩種方式可以載入相關實體：</span><span class="sxs-lookup"><span data-stu-id="e344a-110">There are two ways to load related entities:</span></span>  
  
- <span data-ttu-id="e344a-111">**積極式載入**:您可以使用`$expand`查詢選項，要求查詢傳回之實體的關聯性相關的實體集所要求的查詢。</span><span class="sxs-lookup"><span data-stu-id="e344a-111">**Eager loading**: You can use the `$expand` query option to request that the query return entities that are related by an association to the entity set that the query requested.</span></span> <span data-ttu-id="e344a-112">請在 <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> 上使用 <xref:System.Data.Services.Client.DataServiceQuery%601> 方法，將 `$expand` 選項加入至傳送給資料服務的查詢。</span><span class="sxs-lookup"><span data-stu-id="e344a-112">Use the <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method on the <xref:System.Data.Services.Client.DataServiceQuery%601> to add the `$expand` option to the query that is sent to the data service.</span></span> <span data-ttu-id="e344a-113">您可以要求多個相關的實體集，並以逗號分隔這些實體集，如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="e344a-113">You can request multiple related entity sets by separating them by a comma, as in the following example.</span></span> <span data-ttu-id="e344a-114">查詢要求的所有實體會以單一回應傳回。</span><span class="sxs-lookup"><span data-stu-id="e344a-114">All entities requested by the query are returned in a single response.</span></span> <span data-ttu-id="e344a-115">下列範例會一併傳回 `Order_Details` 和 `Customers`，以及 `Orders` 實體集：</span><span class="sxs-lookup"><span data-stu-id="e344a-115">The following example returns `Order_Details` and `Customers` together with the `Orders` entity set:</span></span>  
  
     [!code-csharp[Astoria Northwind Client#ExpandOrderDetailsSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#expandorderdetailsspecific)]
     [!code-vb[Astoria Northwind Client#ExpandOrderDetailsSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#expandorderdetailsspecific)]  
  
     [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] <span data-ttu-id="e344a-116">會使用 `$expand` 查詢選項限制為可包含在單一查詢中的 12 個實體集數目。</span><span class="sxs-lookup"><span data-stu-id="e344a-116">limits to 12 the number of entity sets that can be included in a single query by using the `$expand` query option.</span></span>  
  
- <span data-ttu-id="e344a-117">**明確式載入**:您可以呼叫<xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A>方法<xref:System.Data.Services.Client.DataServiceContext>明確載入相關的實體的執行個體。</span><span class="sxs-lookup"><span data-stu-id="e344a-117">**Explicit loading**: You can call the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance to explicitly load related entities.</span></span> <span data-ttu-id="e344a-118">每次呼叫 <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> 方法，都會對資料服務建立一個獨立的查詢。</span><span class="sxs-lookup"><span data-stu-id="e344a-118">Each call to the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method creates a separate request to the data service.</span></span> <span data-ttu-id="e344a-119">下列範例會明確載入 `Order_Details` 實體的 `Orders`：</span><span class="sxs-lookup"><span data-stu-id="e344a-119">The following example explicitly loads `Order_Details` for an `Orders` entity:</span></span>  
  
     [!code-csharp[Astoria Northwind Client#LoadRelatedOrderDetailsSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#loadrelatedorderdetailsspecific)]
     [!code-vb[Astoria Northwind Client#LoadRelatedOrderDetailsSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#loadrelatedorderdetailsspecific)]  
  
 <span data-ttu-id="e344a-120">考慮要使用哪一種方式時，請了解，對資料服務要求的數目與單一回應所傳回的資料量之間必須有所取捨。</span><span class="sxs-lookup"><span data-stu-id="e344a-120">When you consider which option to use, realize that there is a tradeoff between the number of requests to the data service and the amount of data that is returned in a single response.</span></span> <span data-ttu-id="e344a-121">當您的應用程式需要相關物件，且您要避免明確擷取物件之額外要求所新增的延遲時，請使用積極式載入</span><span class="sxs-lookup"><span data-stu-id="e344a-121">Use eager loading when your application requires associated objects and you want to avoid the added latency of additional requests to explicitly retrieve them.</span></span> <span data-ttu-id="e344a-122">不過，在有些情況下，當應用程式只需要特定相關實體執行個體的資料時，您應該考慮呼叫 <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> 方法，明確載入這些實體。</span><span class="sxs-lookup"><span data-stu-id="e344a-122">However, if there are cases when the application only needs the data for specific related entity instances, you should consider explicitly loading those entities by calling the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method.</span></span> <span data-ttu-id="e344a-123">如需詳細資訊，請參閱[如何：載入相關的實體](../../../../docs/framework/data/wcf/how-to-load-related-entities-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="e344a-123">For more information, see [How to: Load Related Entities](../../../../docs/framework/data/wcf/how-to-load-related-entities-wcf-data-services.md).</span></span>  
  
## <a name="paged-content"></a><span data-ttu-id="e344a-124">分頁內容</span><span class="sxs-lookup"><span data-stu-id="e344a-124">Paged Content</span></span>  
 <span data-ttu-id="e344a-125">在資料服務中啟用分頁時，資料服務在摘要中傳回的項目數量會受限於資料服務的配置。</span><span class="sxs-lookup"><span data-stu-id="e344a-125">When paging is enabled in the data service, the number of entries in the feed that the data service returns is limited by the configuration of the data service.</span></span> <span data-ttu-id="e344a-126">分頁限制可以針對每個實體集進行個別設定。</span><span class="sxs-lookup"><span data-stu-id="e344a-126">Page limits can be set separately for each entity set.</span></span> <span data-ttu-id="e344a-127">如需詳細資訊，請參閱 <<c0> [ 設定資料服務](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="e344a-127">For more information, see [Configuring the Data Service](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="e344a-128">啟用分頁時，摘要中的最後一個項目會包含下一頁資料的連結。</span><span class="sxs-lookup"><span data-stu-id="e344a-128">When paging is enabled, the final entry in the feed contains a link to the next page of data.</span></span> <span data-ttu-id="e344a-129">這個連結是包含在 <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> 物件之中。</span><span class="sxs-lookup"><span data-stu-id="e344a-129">This link is contained in a <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> object.</span></span> <span data-ttu-id="e344a-130">執行 <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> 時，呼叫 <xref:System.Data.Services.Client.QueryOperationResponse%601> 上的 <xref:System.Data.Services.Client.DataServiceQuery%601> 方法，即可取得下一頁資料的 URI。</span><span class="sxs-lookup"><span data-stu-id="e344a-130">You obtain the URI to the next page of data by calling the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method on the <xref:System.Data.Services.Client.QueryOperationResponse%601> returned when the <xref:System.Data.Services.Client.DataServiceQuery%601> is executed.</span></span> <span data-ttu-id="e344a-131">傳回的 <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> 物件就能用來載入下一頁的結果。</span><span class="sxs-lookup"><span data-stu-id="e344a-131">The returned <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> object is then used to load the next page of results.</span></span> <span data-ttu-id="e344a-132">呼叫 <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> 方法前，您必須列舉查詢結果。</span><span class="sxs-lookup"><span data-stu-id="e344a-132">You must enumerate the query result before you call the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method.</span></span> <span data-ttu-id="e344a-133">考慮第一次列舉查詢結果時，使用 `do…while` 迴圈，然後檢查 `non-null` 下一個連結值。</span><span class="sxs-lookup"><span data-stu-id="e344a-133">Consider using a `do…while` loop to first enumerate the query result and then check for a `non-null` next link value.</span></span> <span data-ttu-id="e344a-134"><xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> 方法傳回 `null` (在 Visual Basic 中為 `Nothing`) 時，原始查詢不會有其他結果頁面。</span><span class="sxs-lookup"><span data-stu-id="e344a-134">When the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method returns `null` (`Nothing` in Visual Basic), there are no additional result pages for the original query.</span></span> <span data-ttu-id="e344a-135">下列範例顯示 `do…while` 迴圈，該迴圈會從 Northwind 範例資料服務載入已分頁的客戶資料。</span><span class="sxs-lookup"><span data-stu-id="e344a-135">The following example shows a `do…while` loop that loads paged customer data from the Northwind sample data service.</span></span>  
  
 [!code-csharp[Astoria Northwind Client#LoadNextLink](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#loadnextlink)]
 [!code-vb[Astoria Northwind Client#LoadNextLink](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#loadnextlink)]  
  
 <span data-ttu-id="e344a-136">當查詢要求相關的實體與要求的實體集一併以單一回應傳回時，分頁限制可能會影響回應中內嵌包含的巢狀摘要。</span><span class="sxs-lookup"><span data-stu-id="e344a-136">When a query requests that related entities are returned in a single response together with the requested entity set, paging limits may affect nested feeds that are included inline with the response.</span></span> <span data-ttu-id="e344a-137">例如，在 Northwind 範例資料服務中，針對 `Customers` 實體集設定分頁限制時，您也可以針對相關 `Orders` 實體集設定獨立的分頁限制，如下列定義 Northwind 範例資料服務的 Northwind.svc.cs 檔案範例所示。</span><span class="sxs-lookup"><span data-stu-id="e344a-137">For example, when a paging limit is set in the Northwind sample data service for the `Customers` entity set, an independent paging limit can also be set for the related `Orders` entity set, as in the following example from the Northwind.svc.cs file that defines the Northwind sample data service.</span></span>  
  
 [!code-csharp[Astoria Northwind Service#DataServiceConfigPaging](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind.svc.cs#dataserviceconfigpaging)]
 [!code-vb[Astoria Northwind Service#DataServiceConfigPaging](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind.svc.vb#dataserviceconfigpaging)]  
  
 <span data-ttu-id="e344a-138">在這種狀況下，您必須為最上層 `Customers` 和巢狀 `Orders` 實體摘要兩者實作分頁。</span><span class="sxs-lookup"><span data-stu-id="e344a-138">In this case, you must implement paging for both the top-level `Customers` and the nested `Orders` entity feeds.</span></span> <span data-ttu-id="e344a-139">下列範例顯示 `while` 迴圈，此迴圈用來載入與選取之 `Orders` 實體相關的 `Customers` 實體頁面。</span><span class="sxs-lookup"><span data-stu-id="e344a-139">The following example shows the `while` loop used to load pages of `Orders` entities related to a selected `Customers` entity.</span></span>  
  
 [!code-csharp[Astoria Northwind Client#LoadNextOrdersLink](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#loadnextorderslink)]
 [!code-vb[Astoria Northwind Client#LoadNextOrdersLink](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#loadnextorderslink)]  
  
 <span data-ttu-id="e344a-140">如需詳細資訊，請參閱[如何：載入分頁結果](../../../../docs/framework/data/wcf/how-to-load-paged-results-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="e344a-140">For more information, see [How to: Load Paged Results](../../../../docs/framework/data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>  
  
## <a name="binary-data-streams"></a><span data-ttu-id="e344a-141">二進位資料流</span><span class="sxs-lookup"><span data-stu-id="e344a-141">Binary Data Streams</span></span>  
 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] <span data-ttu-id="e344a-142">可讓您存取二進位大型物件 (BLOB) 資料，做為資料流。</span><span class="sxs-lookup"><span data-stu-id="e344a-142">enables you to access binary large object (BLOB) data as a data stream.</span></span> <span data-ttu-id="e344a-143">資料流會延後二進位資料的載入，直到需要為止，因此用戶端可以更有效地處理這些資料。</span><span class="sxs-lookup"><span data-stu-id="e344a-143">Streaming defers the loading of binary data until it is needed, and the client can more efficiently process this data.</span></span> <span data-ttu-id="e344a-144">為了利用這個功能，資料服務必須實作 <xref:System.Data.Services.Providers.IDataServiceStreamProvider> 提供者。</span><span class="sxs-lookup"><span data-stu-id="e344a-144">In order to take advantage of this functionality, the data service must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider.</span></span> <span data-ttu-id="e344a-145">如需詳細資訊，請參閱 <<c0> [ 資料流處理提供者](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="e344a-145">For more information, see [Streaming Provider](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md).</span></span> <span data-ttu-id="e344a-146">啟用資料流時，將會傳回沒有相關二進位資料的實體類型。</span><span class="sxs-lookup"><span data-stu-id="e344a-146">When streaming is enabled, entity types are returned without the related binary data.</span></span> <span data-ttu-id="e344a-147">在此情況下，您必須使用<xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A>方法的<xref:System.Data.Services.Client.DataServiceContext>類別，以從服務存取二進位資料的資料流。</span><span class="sxs-lookup"><span data-stu-id="e344a-147">In this case, you must use the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method of the <xref:System.Data.Services.Client.DataServiceContext> class to access the data stream for the binary data from the service.</span></span> <span data-ttu-id="e344a-148">同樣地，使用 <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> 方法，可加入或變更實體的二進位資料，作為資料流。</span><span class="sxs-lookup"><span data-stu-id="e344a-148">Similarly, use the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to add or change binary data for an entity as a stream.</span></span> <span data-ttu-id="e344a-149">如需詳細資訊，請參閱 <<c0> [ 使用二進位資料](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="e344a-149">For more information, see [Working with Binary Data](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e344a-150">另請參閱</span><span class="sxs-lookup"><span data-stu-id="e344a-150">See also</span></span>

- [<span data-ttu-id="e344a-151">WCF Data Services 用戶端程式庫</span><span class="sxs-lookup"><span data-stu-id="e344a-151">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
- [<span data-ttu-id="e344a-152">查詢資料服務</span><span class="sxs-lookup"><span data-stu-id="e344a-152">Querying the Data Service</span></span>](../../../../docs/framework/data/wcf/querying-the-data-service-wcf-data-services.md)
