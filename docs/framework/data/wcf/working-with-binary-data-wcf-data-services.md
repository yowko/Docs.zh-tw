---
title: 使用二進位資料 (WCF 資料服務)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, binary data
- WCF Data Services, streams
ms.assetid: aeccc45c-d5c5-4671-ad63-a492ac8043ac
ms.openlocfilehash: 21501ec9d0af4c785dd86946fa34c1041bb34b9d
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/27/2019
ms.locfileid: "70043891"
---
# <a name="working-with-binary-data-wcf-data-services"></a><span data-ttu-id="b07ea-102">使用二進位資料 (WCF 資料服務)</span><span class="sxs-lookup"><span data-stu-id="b07ea-102">Working with Binary Data (WCF Data Services)</span></span>

<span data-ttu-id="b07ea-103">用戶端程式庫可讓您使用下列其中一種方式[!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] , 從摘要中取出和更新二進位資料: [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]</span><span class="sxs-lookup"><span data-stu-id="b07ea-103">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library enables you to retrieve and update binary data from an [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] feed in one of the following ways:</span></span>

- <span data-ttu-id="b07ea-104">當做實體的基本型別屬性。</span><span class="sxs-lookup"><span data-stu-id="b07ea-104">As a primitive type property of an entity.</span></span> <span data-ttu-id="b07ea-105">如果要處理可以輕鬆載入記憶體的小型二進位資料物件，建議使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-105">This is the recommended method for working with small binary data objects that can be easily loaded into memory.</span></span> <span data-ttu-id="b07ea-106">在此情況下，二進位屬性是資料模型所公開的實體屬性，而資料服務會將二進位資料序列化成為回應訊息中的 base-64 二進位編碼 XML。</span><span class="sxs-lookup"><span data-stu-id="b07ea-106">In this case, the binary property is an entity property exposed by the data model, and the data service serializes the binary data as base-64 binary encoded XML in the response message.</span></span>

- <span data-ttu-id="b07ea-107">當做個別的二進位資源資料流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-107">As a separate binary resource stream.</span></span> <span data-ttu-id="b07ea-108">如果要存取及變更可能代表相片、影片或是其他任何類型之二進位編碼資料的二進位大型物件 (BLOB) 資料，建議使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-108">This is the recommended method for accessing and changing binary large object (BLOB) data that may represent a photo, video, or any other type of binary encoded data.</span></span>

[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]<span data-ttu-id="b07ea-109">使用中[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]定義的 HTTP 來執行二進位資料的資料流程處理。</span><span class="sxs-lookup"><span data-stu-id="b07ea-109">implements the streaming of binary data by using HTTP as defined in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].</span></span> <span data-ttu-id="b07ea-110">在此機制中, 二進位資料會被視為與實體 (稱為媒體連結專案) 不同的媒體資源。</span><span class="sxs-lookup"><span data-stu-id="b07ea-110">In this mechanism, binary data is treated as a media resource that is separate from but related to an entity, which is called a media link entry.</span></span> <span data-ttu-id="b07ea-111">如需詳細資訊, 請參閱[串流處理提供者](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="b07ea-111">For more information, see [Streaming Provider](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md).</span></span>

> [!TIP]
> <span data-ttu-id="b07ea-112">如需如何建立可從[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]儲存相片之服務下載二進位影像檔的 Windows Presentation Foundation (WPF) 用戶端應用程式的逐步範例, 請參閱文章[資料服務串流提供者系列-部分2:從用戶端](https://go.microsoft.com/fwlink/?LinkId=201637)存取媒體資源串流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-112">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://go.microsoft.com/fwlink/?LinkId=201637).</span></span> <span data-ttu-id="b07ea-113">若要下載 blog 文章中精選的串流相片資料服務範例程式碼, 請參閱 MSDN 程式碼庫中的[串流處理相片資料服務範例](https://go.microsoft.com/fwlink/?LinkId=198988)。</span><span class="sxs-lookup"><span data-stu-id="b07ea-113">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://go.microsoft.com/fwlink/?LinkId=198988) in MSDN Code Gallery.</span></span>

## <a name="entity-metadata"></a><span data-ttu-id="b07ea-114">實體中繼資料</span><span class="sxs-lookup"><span data-stu-id="b07ea-114">Entity Metadata</span></span>

<span data-ttu-id="b07ea-115">在資料服務中繼資料中，套用到屬於媒體連結項目之實體類型的 `HasStream` 屬性會指出擁有相關媒體資源資料流的實體。</span><span class="sxs-lookup"><span data-stu-id="b07ea-115">An entity that has a related media resource stream is indicated in the data service metadata by the `HasStream` attribute applied to an entity type that is the media link entry.</span></span> <span data-ttu-id="b07ea-116">在下列範例中, `PhotoInfo`實體是具有相關媒體資源的媒體連結專案, 以`HasStream`屬性工作表示。</span><span class="sxs-lookup"><span data-stu-id="b07ea-116">In the following example, the `PhotoInfo` entity is a media link entry that has a related media resource, indicated by the `HasStream` attribute.</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="b07ea-117">本主題的其餘範例會示範如何存取及變更媒體資源資料流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-117">The remaining examples in this topic show how to access and change the media resource stream.</span></span> <span data-ttu-id="b07ea-118">如需如何使用[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]用戶端程式庫在 .NET Framework 用戶端應用程式中取用媒體資源串流的完整範例, 請參閱[從用戶端存取媒體資源串流](https://go.microsoft.com/fwlink/?LinkID=201637)文章。</span><span class="sxs-lookup"><span data-stu-id="b07ea-118">For a complete example of how to consume a media resource stream in a .NET Framework client application by using the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library, see the post [Accessing a Media Resource Stream from the Client](https://go.microsoft.com/fwlink/?LinkID=201637).</span></span>

## <a name="accessing-the-binary-resource-stream"></a><span data-ttu-id="b07ea-119">存取二進位資源資料流</span><span class="sxs-lookup"><span data-stu-id="b07ea-119">Accessing the Binary Resource Stream</span></span>

<span data-ttu-id="b07ea-120">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] 用戶端程式庫提供從 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] 架構資料服務存取二進位資源資料流的方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-120">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library provides methods for accessing binary resource streams from an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]-based data service.</span></span> <span data-ttu-id="b07ea-121">下載媒體資源時，您可以使用媒體資源的 URI，或者您可以取得包含媒體資源資料本身的二進位資料流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-121">When downloading a media resource, you can either use the URI of the media resource or you can get a binary stream that contains the media resource data itself.</span></span> <span data-ttu-id="b07ea-122">您也可以上載媒體資源資料做為二進位資料流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-122">You can also upload media resource data as a binary stream.</span></span>

> [!TIP]
> <span data-ttu-id="b07ea-123">如需如何建立可從[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]儲存相片之服務下載二進位影像檔的 Windows Presentation Foundation (WPF) 用戶端應用程式的逐步範例, 請參閱文章[資料服務串流提供者系列-部分2:從用戶端](https://go.microsoft.com/fwlink/?LinkId=201637)存取媒體資源串流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-123">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://go.microsoft.com/fwlink/?LinkId=201637).</span></span> <span data-ttu-id="b07ea-124">若要下載 blog 文章中精選的串流相片資料服務範例程式碼, 請參閱 MSDN 程式碼庫中的[串流處理相片資料服務範例](https://go.microsoft.com/fwlink/?LinkId=198988)。</span><span class="sxs-lookup"><span data-stu-id="b07ea-124">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://go.microsoft.com/fwlink/?LinkId=198988) in MSDN Code Gallery.</span></span>

### <a name="getting-the-uri-of-the-binary-stream"></a><span data-ttu-id="b07ea-125">取得二進位資料流的 URI</span><span class="sxs-lookup"><span data-stu-id="b07ea-125">Getting the URI of the Binary Stream</span></span>

<span data-ttu-id="b07ea-126">擷取特定類型的媒體資源 (例如影像及其他媒體檔案) 時，在應用程式中使用媒體資源的 URI 通常比處理二進位資料的資料流本身更容易。</span><span class="sxs-lookup"><span data-stu-id="b07ea-126">When retrieving certain types of media resources, such as images and other media files, it is often easier to use the URI of the media resource in your application than handling the binary data stream itself.</span></span> <span data-ttu-id="b07ea-127">若要取得與給定媒體連結項目相關聯的資源資料流 URI，您必須在追蹤實體的 <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> 執行個體上呼叫 <xref:System.Data.Services.Client.DataServiceContext> 方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-127">To get the URI of a resource stream associated with a give media link entry, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="b07ea-128">下列範例會示範如何呼叫 <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> 方法來取得在用戶端上建立新影像所使用的媒體資源資料流 URI：</span><span class="sxs-lookup"><span data-stu-id="b07ea-128">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method to get the URI of a media resource stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photowindow.xaml.cs#getreadstreamuri)]
[!code-vb[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photowindow.xaml.vb#getreadstreamuri)]

### <a name="downloading-the-binary-resource-stream"></a><span data-ttu-id="b07ea-129">下載二進位資源資料流</span><span class="sxs-lookup"><span data-stu-id="b07ea-129">Downloading the Binary Resource Stream</span></span>

<span data-ttu-id="b07ea-130">擷取媒體資源資料流時，您必須在追蹤媒體連結項目的 <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> 執行個體上呼叫 <xref:System.Data.Services.Client.DataServiceContext> 方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-130">When retrieving a binary resource stream, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the media link entry.</span></span> <span data-ttu-id="b07ea-131">這個方法會將要求傳送到傳回 <xref:System.Data.Services.Client.DataServiceStreamResponse> 物件的資料服務，而且此物件擁有包含資源之資料流的參考。</span><span class="sxs-lookup"><span data-stu-id="b07ea-131">This method sends a request to the data service that returns a <xref:System.Data.Services.Client.DataServiceStreamResponse> object, which has a reference to the stream that contains the resource.</span></span> <span data-ttu-id="b07ea-132">當應用程式需要二進位資源做為 <xref:System.IO.Stream> 時，請使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-132">Use this method when your application requires the binary resource as a <xref:System.IO.Stream>.</span></span> <span data-ttu-id="b07ea-133">下列範例會示範如何呼叫 <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> 方法來擷取在用戶端上建立新影像所使用的資料流：</span><span class="sxs-lookup"><span data-stu-id="b07ea-133">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method to retrieve a stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_streaming_client/cs/customerphotowindow.xaml.cs#getreadstreamclient)]
[!code-vb[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_streaming_client/vb/customerphotowindow.xaml.vb#getreadstreamclient)]

> [!NOTE]
> <span data-ttu-id="b07ea-134">包含二進位資料流之回應訊息中的 Content-Length 標頭不是由此資料服務所設定。</span><span class="sxs-lookup"><span data-stu-id="b07ea-134">The Content-Length header in the response message that contains the binary steam is not set by the data service.</span></span> <span data-ttu-id="b07ea-135">這個值可能不會反映二進位資料流的實際長度。</span><span class="sxs-lookup"><span data-stu-id="b07ea-135">This value may not reflect the actual length of the binary data stream.</span></span>

### <a name="uploading-a-media-resource-as-a-stream"></a><span data-ttu-id="b07ea-136">上載媒體資源做為資料流</span><span class="sxs-lookup"><span data-stu-id="b07ea-136">Uploading a Media Resource as a Stream</span></span>

<span data-ttu-id="b07ea-137">若要插入或更新媒體資源，請在追蹤實體的 <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> 執行個體上呼叫 <xref:System.Data.Services.Client.DataServiceContext> 方法。</span><span class="sxs-lookup"><span data-stu-id="b07ea-137">To insert or update a media resource, call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="b07ea-138">這個方法會傳送要求給資料服務，此服務中包含從提供的資料流讀取的媒體資源。</span><span class="sxs-lookup"><span data-stu-id="b07ea-138">This method sends a request to the data service that contains the media resource read from the supplied stream.</span></span> <span data-ttu-id="b07ea-139">下列範例會示範如何呼叫 <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> 方法，將影像傳送到資料服務：</span><span class="sxs-lookup"><span data-stu-id="b07ea-139">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to send an image to the data service:</span></span>

[!code-csharp[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photodetailswindow.xaml.cs#setsavestream)]
[!code-vb[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photodetailswindow.xaml.vb#setsavestream)]

<span data-ttu-id="b07ea-140">在這個範例中，<xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> 方法的呼叫方式是為 `true` 參數提供 `closeStream` 的值。</span><span class="sxs-lookup"><span data-stu-id="b07ea-140">In this example, the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method is called by supplying a value of `true` for the `closeStream` parameter.</span></span> <span data-ttu-id="b07ea-141">如此可確保當二進位資料上載到資料服務之後，<xref:System.Data.Services.Client.DataServiceContext> 會關閉資料流。</span><span class="sxs-lookup"><span data-stu-id="b07ea-141">This guarantees that the <xref:System.Data.Services.Client.DataServiceContext> closes the stream after the binary data is uploaded to the data service.</span></span>

> [!NOTE]
> <span data-ttu-id="b07ea-142">當您呼叫 <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> 時，並不會將資料流傳送到資料服務，直到呼叫 <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> 為止。</span><span class="sxs-lookup"><span data-stu-id="b07ea-142">When you call <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, the stream is not sent to the data service until <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called.</span></span>

## <a name="see-also"></a><span data-ttu-id="b07ea-143">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b07ea-143">See also</span></span>

- [<span data-ttu-id="b07ea-144">WCF Data Services 用戶端程式庫</span><span class="sxs-lookup"><span data-stu-id="b07ea-144">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
- [<span data-ttu-id="b07ea-145">將資料繫結至控制項</span><span class="sxs-lookup"><span data-stu-id="b07ea-145">Binding Data to Controls</span></span>](../../../../docs/framework/data/wcf/binding-data-to-controls-wcf-data-services.md)
