---
title: 執行個體存放區
ms.date: 03/30/2017
ms.assetid: f2629668-0923-4987-b943-67477131c1e0
ms.openlocfilehash: 69b50942c36406bd29147d243e0501b8048d56dc
ms.sourcegitcommit: 32a575bf4adccc901f00e264f92b759ced633379
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/04/2019
ms.locfileid: "74802553"
---
# <a name="instance-stores"></a><span data-ttu-id="c5ae1-102">執行個體存放區</span><span class="sxs-lookup"><span data-stu-id="c5ae1-102">Instance Stores</span></span>
<span data-ttu-id="c5ae1-103">執行個體存放區是執行個體的邏輯容器者。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-103">An instance store is a logical container of instances.</span></span> <span data-ttu-id="c5ae1-104">這是儲存執行個體資料和中繼資料的位置。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-104">It is the place where the instance data and metadata is stored.</span></span> <span data-ttu-id="c5ae1-105">執行個體存放區並不是指專用的實際儲存區。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-105">An instance store does not imply dedicated physical storage.</span></span> <span data-ttu-id="c5ae1-106">執行個體存放區可包含 SQL Server 資料庫中的耐久資訊，或記憶體中的非耐久狀態資訊。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-106">An instance store could contain durable information in a SQL Server database or non-durable state information in a memory.</span></span> <span data-ttu-id="c5ae1-107">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] 隨附於 SQL 工作流程執行個體存放區，是執行個體存放區的具體實作，可讓工作流程將執行個體資料與中繼資料保存在 SQL Server 2005 或 SQL Server 2008 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-107">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with the SQL Workflow Instance Store, which is a concrete implementation of an instance store that allows workflows to persist instance data and metadata into a SQL Server 2005 or SQL Server 2008 database.</span></span> <span data-ttu-id="c5ae1-108">此外，Windows Server App Fabric 還提供執行個體存放區的 concrete 實作。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-108">In addition Windows Server App Fabric also provides a concrete implementation of an instance store.</span></span> <span data-ttu-id="c5ae1-109">如需詳細資訊，請參閱[Windows Server App Fabric 實例存放區、查詢和控制項提供者](https://docs.microsoft.com/previous-versions/appfabric/ff383417(v=azure.10))。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-109">For more information, see [Windows Server App Fabric Instance Store, Query, and Control Providers](https://docs.microsoft.com/previous-versions/appfabric/ff383417(v=azure.10)).</span></span>  
  
 <span data-ttu-id="c5ae1-110">持續性 API 是介於主機和執行個體存放區間的介面，可讓主機傳送命令要求 (例如：<xref:System.Activities.DurableInstancing.LoadWorkflowCommand> 和 <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) 至執行個體存放區。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-110">The persistence API is the interface between a host and an instance store that allows the host to send command requests (for example, <xref:System.Activities.DurableInstancing.LoadWorkflowCommand> and <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) to the instance store.</span></span> <span data-ttu-id="c5ae1-111">此 API 的具體實作稱為持續性提供者。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-111">The concrete implementation of this API is called a persistence provider.</span></span> <span data-ttu-id="c5ae1-112">持續性提供者會收到來自主機的要求，並修改執行個體存放區。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-112">The persistence provider receives requests from a host and modifies the instance store.</span></span>  
  
 <span data-ttu-id="c5ae1-113">主機和執行個體存放區都是可插拔的，因此主機可用於許多執行個體存放區，執行個體存放區也可用於許多主機。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-113">Hosts and instance stores are pluggable so that a host can be used with many instance stores, and an instance store can be used with many hosts.</span></span> <span data-ttu-id="c5ae1-114">雖然執行個體存放區通常已針對特定主機的使用模式進行最佳化，但是執行個體存放區和主機可能要以獨立的生命週期來運作。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-114">An instance store is typically optimized for the usage patterns of a particular host, although the instance store and host may evolve on independent life cycles.</span></span> <span data-ttu-id="c5ae1-115">例如， **WorkflowServiceHost**和**SqlWorkflowInstanceStore**是設計來妥善搭配運作。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-115">For example, the **WorkflowServiceHost** and the **SqlWorkflowInstanceStore** are designed to work well together.</span></span> <span data-ttu-id="c5ae1-116">您可以建立自己的實例存放區，以保存工作流程服務實例的資料和中繼資料，並將該實例存放區與**WorkflowServiceHost**搭配使用。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-116">You can create your own instance store to persist data and metadata of workflow service instances and use that instance store with the **WorkflowServiceHost**.</span></span> <span data-ttu-id="c5ae1-117">例如，您可以建立 OracleWorkflowInstanceStore，讓工作流程將資訊保存在 Oracle 資料庫中，而非儲存至 SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-117">For example, you can create an OracleWorkflowInstanceStore that lets workflows persist information into an Oracle database instead of saving them into a SQL Server database.</span></span>  
  
 <span data-ttu-id="c5ae1-118">使用修改已保留物件的其他功能來擴充主機是很常見的。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-118">It is common for hosts to be extended with additional functionality that modifies the persisted objects.</span></span> <span data-ttu-id="c5ae1-119">例如，實例持續性系統可能有工作流程主機、支援「暫止」作業的延伸模組，以及 SQL 實例存放區。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-119">For example, an instance persistence system may have a workflow host, an extension that supports the "Suspend" operation, and an SQL instance store.</span></span>  <span data-ttu-id="c5ae1-120">工作流程主機可傳送標準命令，例如「儲存」(Save) 工作流程、將工作流程從執行個體存放區「載入」(Load)，或將工作流程儲存至執行個體存放區。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-120">The workflow host might send a standard command such as Save or Load to save or load a workflow from an instance store or to save a workflow into an instance store.</span></span> <span data-ttu-id="c5ae1-121">暫停的擴充可將其他語意加入至命令中以儲存或載入工作流程執行個體，這樣暫停的工作流程就無法載入。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-121">The suspend extension might add additional semantics to the commands for saving and loading workflow instances so that a suspended workflow instance cannot be loaded.</span></span> <span data-ttu-id="c5ae1-122">SQL 執行個體存放區的持續性提供者會了解儲存與載入工作流程執行個體的命令，並呼叫可變更 SQL Server 伺服器中持續性物件資料表的適當儲存程序來實作命令。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-122">The persistence provider for the SQL instance store understands the commands for saving and loading workflow instances, and implements the commands by calling appropriate stored procedures that change the tables of persistent objects in an SQL Server database.</span></span>  
  
 <span data-ttu-id="c5ae1-123">做為執行個體存放區中執行個體擁有者的主機。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-123">A host acts as an instance owner within an instance store.</span></span> <span data-ttu-id="c5ae1-124">主機可做為一個以上的執行個體擁有者，這些擁有者同時擁有一個以上的執行個體存放區。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-124">A host may act as more than one instance owner with more than one instance store at the same time.</span></span> <span data-ttu-id="c5ae1-125">主機提供與執行個體相關聯的執行個體索引鍵 GUID。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-125">The host provides GUIDs for instance keys associated with the instances.</span></span> <span data-ttu-id="c5ae1-126">執行個體索引鍵是識別執行個體的唯一別名。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-126">An instance key is a unique alias that identifies an instance.</span></span> <span data-ttu-id="c5ae1-127">持續性系統在執行主機要求的命令時，會建立、更新與刪除執行個體擁有者資訊。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-127">The persistence system creates, updates, and deletes instance owner information as it executes commands requested by hosts.</span></span>  
  
 <span data-ttu-id="c5ae1-128">下列清單包含主機與執行個體存放區互動時的相關重要步驟。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-128">The following list contains the important steps involved in the host’s interaction with the instance store:</span></span>  
  
1. <span data-ttu-id="c5ae1-129">從持續性提供者取得**InstanceStore** 。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-129">Obtain an **InstanceStore** from a persistence provider.</span></span>  

2. <span data-ttu-id="c5ae1-130">藉由在**InstanceStore**上呼叫 <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> 方法，取得實例的控制碼。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-130">Obtain the handle to an instance by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> method on the **InstanceStore**.</span></span>  
  
3. <span data-ttu-id="c5ae1-131">呼叫**InstanceStore**上的 <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> 方法，對實例控制碼叫用命令。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-131">Invoke commands against the instance handle by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> method on the **InstanceStore**.</span></span>  
  
4. <span data-ttu-id="c5ae1-132">檢查**InstanceStore**所傳回的 <xref:System.Runtime.DurableInstancing.InstanceView>，以判斷命令的結果。</span><span class="sxs-lookup"><span data-stu-id="c5ae1-132">Examine the <xref:System.Runtime.DurableInstancing.InstanceView> returned by **InstanceStore.Execute** to determine the results of the commands.</span></span>
