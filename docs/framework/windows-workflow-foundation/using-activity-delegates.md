---
title: "使用活動委派"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: e33cf876-8979-440b-9b23-4a12d1139960
caps.latest.revision: "12"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: cf39f9e9cb877afed68c8e5b1b5c33f4276c4a15
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 10/18/2017
---
# <a name="using-activity-delegates"></a><span data-ttu-id="8be99-102">使用活動委派</span><span class="sxs-lookup"><span data-stu-id="8be99-102">Using Activity Delegates</span></span>
<span data-ttu-id="8be99-103">活動委派可讓活動作者使用特定的簽章以公開回呼，活動使用者可以此為依據來提供活動處理常式。</span><span class="sxs-lookup"><span data-stu-id="8be99-103">Activity delegates enable activity authors to expose callbacks with specific signatures, for which users of the activity can provide activity-based handlers.</span></span> <span data-ttu-id="8be99-104">活動委派有兩種型別可用：<xref:System.Activities.ActivityAction%601>，用來定義沒有傳回值的活動委派，以及 <xref:System.Activities.ActivityFunc%601>，用來定義有傳回值的活動委派。</span><span class="sxs-lookup"><span data-stu-id="8be99-104">Two types of activity delegates are available: <xref:System.Activities.ActivityAction%601> is used to define activity delegates that do not have a return value, and <xref:System.Activities.ActivityFunc%601> is used to define activity delegates that do have a return value.</span></span>  
  
 <span data-ttu-id="8be99-105">在限制子活動必須擁有簽章的案例中，活動委派非常實用。</span><span class="sxs-lookup"><span data-stu-id="8be99-105">Activity delegates are useful in scenarios where a child activity must be constrained to having a certain signature.</span></span> <span data-ttu-id="8be99-106">例如，<xref:System.Activities.Statements.While> 活動可包含任何沒有條件約束的子活動型別，但 <xref:System.Activities.Statements.ForEach%601> 活動的主體是 <xref:System.Activities.ActivityAction%601>，且最終由 <xref:System.Activities.Statements.ForEach%601> 執行的子活動，必須具有與 <xref:System.Activities.InArgument%601> 列舉之集合成員相同型別的 <xref:System.Activities.Statements.ForEach%601>。</span><span class="sxs-lookup"><span data-stu-id="8be99-106">For example, a <xref:System.Activities.Statements.While> activity can contain any type of child activity with no constraints, but the body of a <xref:System.Activities.Statements.ForEach%601> activity is an <xref:System.Activities.ActivityAction%601>, and the child activity that is ultimately executed by <xref:System.Activities.Statements.ForEach%601> must have an <xref:System.Activities.InArgument%601> that is the same type of the members of the collection that the <xref:System.Activities.Statements.ForEach%601> enumerates.</span></span>  
  
## <a name="using-activityaction"></a><span data-ttu-id="8be99-107">使用 ActivityAction</span><span class="sxs-lookup"><span data-stu-id="8be99-107">Using ActivityAction</span></span>  
 <span data-ttu-id="8be99-108">幾個 [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] 活動會使用活動的動作，例如 <xref:System.Activities.Statements.Catch> 活動和 <xref:System.Activities.Statements.ForEach%601> 活動。</span><span class="sxs-lookup"><span data-stu-id="8be99-108">Several [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] activities use activity actions, such as the <xref:System.Activities.Statements.Catch> activity and the <xref:System.Activities.Statements.ForEach%601> activity.</span></span> <span data-ttu-id="8be99-109">在每一個情況下，活動的動作都代表一個位置，工作流程作者會在這裡指定活動，以便在使用其中一個活動撰寫工作流程時提供所要的行為。</span><span class="sxs-lookup"><span data-stu-id="8be99-109">In each case, the activity action represents a location where the workflow author specifies an activity to provide the desired behavior when composing a workflow using one of these activities.</span></span> <span data-ttu-id="8be99-110">在下列範例中，<xref:System.Activities.Statements.ForEach%601> 活動是用來將文字顯示到主控台視窗。</span><span class="sxs-lookup"><span data-stu-id="8be99-110">In the following example, a <xref:System.Activities.Statements.ForEach%601> activity is used to display text to the console window.</span></span> <span data-ttu-id="8be99-111"><xref:System.Activities.Statements.ForEach%601> 的主體是使用符合字串 <xref:System.Activities.ActivityAction%601> 之型別的 <xref:System.Activities.Statements.ForEach%601> 所指定。</span><span class="sxs-lookup"><span data-stu-id="8be99-111">The body of the <xref:System.Activities.Statements.ForEach%601> is specified by using an <xref:System.Activities.ActivityAction%601> that matches the type of the <xref:System.Activities.Statements.ForEach%601> which is string.</span></span> <span data-ttu-id="8be99-112"><xref:System.Activities.Statements.WriteLine> 中指定的 <xref:System.Activities.ActivityDelegate.Handler%2A> 活動擁有繫結至字串值的 <xref:System.Activities.Statements.WriteLine.Text%2A> 引數，該字串值位於 <xref:System.Activities.Statements.ForEach%601> 活動所反覆查看的集合中。</span><span class="sxs-lookup"><span data-stu-id="8be99-112">The <xref:System.Activities.Statements.WriteLine> activity specified in the <xref:System.Activities.ActivityDelegate.Handler%2A> has its <xref:System.Activities.Statements.WriteLine.Text%2A> argument bound to the string values in the collection that the <xref:System.Activities.Statements.ForEach%601> activity iterates.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#6](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#6)]  
  
 <span data-ttu-id="8be99-113">actionArgument 是用來將集合中的個別項目流動到 WriteLine。</span><span class="sxs-lookup"><span data-stu-id="8be99-113">The actionArgument is used to flow the individual items in the collection to the WriteLine.</span></span> <span data-ttu-id="8be99-114">當叫用此工作流程時，主控台就會顯示下列輸出。</span><span class="sxs-lookup"><span data-stu-id="8be99-114">When the workflow is invoked, the following output is displayed to the console.</span></span>  
 ``` 
 HelloWorld.
 ```  
<span data-ttu-id="8be99-115">本主題的範例會使用物件初始化語法。</span><span class="sxs-lookup"><span data-stu-id="8be99-115">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="8be99-116">物件初始化語法在使用程式碼建立工作流程定義時會很有用，因為它會在工作流程中提供活動的階層式檢視，並顯示活動之間的關係。</span><span class="sxs-lookup"><span data-stu-id="8be99-116">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="8be99-117">當您以程式設計方式來建立工作流程時，不一定非得使用物件初始化語法。</span><span class="sxs-lookup"><span data-stu-id="8be99-117">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="8be99-118">下列範例在功能上等同於先前的範例。</span><span class="sxs-lookup"><span data-stu-id="8be99-118">The following example is functionally equivalent to the previous example.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#7](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#7)]  
  
 [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="8be99-119">物件初始設定式，請參閱[如何： 初始化的物件，而不呼叫建構函式 （C# 程式設計手冊）](http://go.microsoft.com/fwlink/?LinkId=161015)和[How to： 使用物件初始設定式宣告物件](http://go.microsoft.com/fwlink/?LinkId=161016)。</span><span class="sxs-lookup"><span data-stu-id="8be99-119"> object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](http://go.microsoft.com/fwlink/?LinkId=161015) and [How to: Declare an Object by Using an Object Initializer](http://go.microsoft.com/fwlink/?LinkId=161016).</span></span>  
  
 <span data-ttu-id="8be99-120">在下列範例中，<xref:System.Activities.Statements.TryCatch> 活動會用於工作流程中。</span><span class="sxs-lookup"><span data-stu-id="8be99-120">In the following example, a <xref:System.Activities.Statements.TryCatch> activity is used in a workflow.</span></span> <span data-ttu-id="8be99-121"><xref:System.ApplicationException> 是由工作流程所擲回而且是由 <xref:System.Activities.Statements.Catch%601> 活動所處理。</span><span class="sxs-lookup"><span data-stu-id="8be99-121">An <xref:System.ApplicationException> is thrown by the workflow, and is handled by a <xref:System.Activities.Statements.Catch%601> activity.</span></span> <span data-ttu-id="8be99-122">處理常式<xref:System.Activities.Statements.Catch%601>活動的活動動作是<xref:System.Activities.Statements.WriteLine>活動和例外狀況詳細資料會流向它使用`ex` <xref:System.Activities.DelegateInArgument%601>。</span><span class="sxs-lookup"><span data-stu-id="8be99-122">The handler for the <xref:System.Activities.Statements.Catch%601> activity's activity action is a <xref:System.Activities.Statements.WriteLine> activity, and the exception detail is flowed through to it using the `ex` <xref:System.Activities.DelegateInArgument%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#33](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]  
  
 <span data-ttu-id="8be99-123">建立定義 <xref:System.Activities.ActivityAction%601> 的自訂活動時，請使用 <xref:System.Activities.Statements.InvokeAction%601> 來建立該 <xref:System.Activities.ActivityAction%601> 的引動過程模型。</span><span class="sxs-lookup"><span data-stu-id="8be99-123">When creating a custom activity that defines an <xref:System.Activities.ActivityAction%601>, use an <xref:System.Activities.Statements.InvokeAction%601> to model the invocation of that <xref:System.Activities.ActivityAction%601>.</span></span> <span data-ttu-id="8be99-124">在這個範例中，會定義自訂 `WriteLineWithNotification` 活動。</span><span class="sxs-lookup"><span data-stu-id="8be99-124">In this example, a custom `WriteLineWithNotification` activity is defined.</span></span> <span data-ttu-id="8be99-125">此活動是由包含 <xref:System.Activities.Statements.Sequence> 活動的 <xref:System.Activities.Statements.WriteLine> 所構成，此活動之後是採用一個字串引數來叫用 <xref:System.Activities.Statements.InvokeAction%601> 的 <xref:System.Activities.ActivityAction%601>。</span><span class="sxs-lookup"><span data-stu-id="8be99-125">This activity is composed of a <xref:System.Activities.Statements.Sequence> that contains a <xref:System.Activities.Statements.WriteLine> activity followed by an <xref:System.Activities.Statements.InvokeAction%601> that invokes an <xref:System.Activities.ActivityAction%601> that takes one string argument.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#1](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#1)]  
  
 <span data-ttu-id="8be99-126">使用 `WriteLineWithNotification` 活動建立工作流程時，工作流程作者會在活動動作的 <xref:System.Activities.ActivityDelegate.Handler%2A> 中指定想要的自訂邏輯。</span><span class="sxs-lookup"><span data-stu-id="8be99-126">When a workflow is created by using the `WriteLineWithNotification` activity, the workflow author specifies the desired custom logic in the activity action’s <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span> <span data-ttu-id="8be99-127">在此範例中，會使用 `WriteLineWithNotification` 活動建立工作流程，且 <xref:System.Activities.Statements.WriteLine> 活動會用來當做 <xref:System.Activities.ActivityDelegate.Handler%2A>。</span><span class="sxs-lookup"><span data-stu-id="8be99-127">In this example, a workflow is created that use the `WriteLineWithNotification` activity, and a <xref:System.Activities.Statements.WriteLine> activity is used as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#2](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#2)]  
  
 <span data-ttu-id="8be99-128">提供多個泛型版本的 <xref:System.Activities.Statements.InvokeAction%601> 和 <xref:System.Activities.ActivityAction%601>，以傳遞一個或多個引數。</span><span class="sxs-lookup"><span data-stu-id="8be99-128">There are multiple generic versions of <xref:System.Activities.Statements.InvokeAction%601> and <xref:System.Activities.ActivityAction%601> provided for passing one or more arguments.</span></span>  
  
## <a name="using-activityfunc"></a><span data-ttu-id="8be99-129">使用 ActivityFunc</span><span class="sxs-lookup"><span data-stu-id="8be99-129">Using ActivityFunc</span></span>  
 <span data-ttu-id="8be99-130">當活動沒有結果值時，<xref:System.Activities.ActivityAction%601> 會非常實用。當傳回結果值時，將會使用 <xref:System.Activities.ActivityFunc%601>。</span><span class="sxs-lookup"><span data-stu-id="8be99-130"><xref:System.Activities.ActivityAction%601> is useful when there is no result value from the activity, and <xref:System.Activities.ActivityFunc%601> is used when a result value is returned.</span></span> <span data-ttu-id="8be99-131">建立定義 <xref:System.Activities.ActivityFunc%601> 的自訂活動時，請使用 <xref:System.Activities.Expressions.InvokeFunc%601> 來建立該 <xref:System.Activities.ActivityFunc%601> 的引動過程模型。</span><span class="sxs-lookup"><span data-stu-id="8be99-131">When creating a custom activity that defines an <xref:System.Activities.ActivityFunc%601>, use an <xref:System.Activities.Expressions.InvokeFunc%601> to model the invocation of that <xref:System.Activities.ActivityFunc%601>.</span></span> <span data-ttu-id="8be99-132">在下列範例中，會定義 `WriteFillerText` 活動。</span><span class="sxs-lookup"><span data-stu-id="8be99-132">In the following example, a `WriteFillerText` activity is defined.</span></span> <span data-ttu-id="8be99-133">若要提供填入文字，應指定 <xref:System.Activities.Expressions.InvokeFunc%601> 採用整數引數，並具有字串結果。</span><span class="sxs-lookup"><span data-stu-id="8be99-133">To supply the filler text, an <xref:System.Activities.Expressions.InvokeFunc%601> is specified that takes an integer argument and has a string result.</span></span> <span data-ttu-id="8be99-134">一旦擷取了填入文字之後，就會使用 <xref:System.Activities.Statements.WriteLine> 活動將它顯示到主控台。</span><span class="sxs-lookup"><span data-stu-id="8be99-134">Once the filler text is retrieved, it is displayed to the console using a <xref:System.Activities.Statements.WriteLine> activity.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#3](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#3)]  
  
 <span data-ttu-id="8be99-135">若要提供文字，必須使用活動以採用一個 `int` 引數，並具有字串結果。</span><span class="sxs-lookup"><span data-stu-id="8be99-135">To supply the text, an activity must be used that takes one `int` argument and has a string result.</span></span> <span data-ttu-id="8be99-136">此範例顯示符合要求的 `TextGenerator` 活動。</span><span class="sxs-lookup"><span data-stu-id="8be99-136">This example shows a `TextGenerator` activity that meets these requirements.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#4](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#4)]  
  
 <span data-ttu-id="8be99-137">若要與 `TextGenerator` 活動共同使用 `WriteRandomText` 活動，請將它指定為 <xref:System.Activities.ActivityDelegate.Handler%2A>。</span><span class="sxs-lookup"><span data-stu-id="8be99-137">To use the `TextGenerator` activity with the `WriteRandomText` activity, specify it as the <xref:System.Activities.ActivityDelegate.Handler%2A>.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#5](../../../samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#5)]  
  
## <a name="see-also"></a><span data-ttu-id="8be99-138">另請參閱</span><span class="sxs-lookup"><span data-stu-id="8be99-138">See Also</span></span>  
 [<span data-ttu-id="8be99-139">公開及叫用 ActivityActions</span><span class="sxs-lookup"><span data-stu-id="8be99-139">Exposing and Invoking ActivityActions</span></span>](../../../docs/framework/windows-workflow-foundation/samples/exposing-and-invoking-activityactions.md)
