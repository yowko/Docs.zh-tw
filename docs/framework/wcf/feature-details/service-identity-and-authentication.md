---
title: 服務身分識別和驗證
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- authentication [WCF], specifying the identity of a service
ms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be
ms.openlocfilehash: f33144c320b3648f9e201505a34ed8f1ecd5965b
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/23/2019
ms.locfileid: "61748261"
---
# <a name="service-identity-and-authentication"></a><span data-ttu-id="b908b-102">服務身分識別和驗證</span><span class="sxs-lookup"><span data-stu-id="b908b-102">Service Identity and Authentication</span></span>
<span data-ttu-id="b908b-103">服務的*端點身分識別*是從服務 Web 服務描述語言 (WSDL) 產生的值。</span><span class="sxs-lookup"><span data-stu-id="b908b-103">A service's *endpoint identity* is a value generated from the service Web Services Description Language (WSDL).</span></span> <span data-ttu-id="b908b-104">這個值會傳播至任何用戶端上，用來驗證服務。</span><span class="sxs-lookup"><span data-stu-id="b908b-104">This value, propagated to any client, is used to authenticate the service.</span></span> <span data-ttu-id="b908b-105">在用戶端初始化對某個端點的通訊，且服務也向用戶端進行自我驗證之後，用戶端就會比較端點身分識別值與端點驗證處理序傳回的實際值。</span><span class="sxs-lookup"><span data-stu-id="b908b-105">After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned.</span></span> <span data-ttu-id="b908b-106">如果兩者相符，則可確定用戶端已聯繫所需的服務端點。</span><span class="sxs-lookup"><span data-stu-id="b908b-106">If they match, the client is assured it has contacted the expected service endpoint.</span></span> <span data-ttu-id="b908b-107">這可當作防範*網路釣魚*藉由防止用戶端重新導向至惡意服務所裝載的端點。</span><span class="sxs-lookup"><span data-stu-id="b908b-107">This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service.</span></span>  
  
 <span data-ttu-id="b908b-108">示範身分識別設定的範例應用程式，請參閱[服務身分識別範例](../../../../docs/framework/wcf/samples/service-identity-sample.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="b908b-109">如需有關端點與端點位址的詳細資訊，請參閱[地址](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-109">For more information about endpoints and endpoint addresses, see [Addresses](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b908b-110">當您使用 NT LanMan (NTLM) 進行驗證時，因為用戶端在 NTLM 協定下無法驗證伺服器，所以不會檢查服務身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-110">When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server.</span></span> <span data-ttu-id="b908b-111">當電腦是 Windows 工作群組的一部分，或者執行的是不支援 Kerberos 驗證的舊版 Windows 時，就會使用 NTLM。</span><span class="sxs-lookup"><span data-stu-id="b908b-111">NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.</span></span>  
  
 <span data-ttu-id="b908b-112">當用戶端初始化安全通道傳送訊息至服務，透過它時，Windows Communication Foundation (WCF) 基礎結構會驗證服務，並只會傳送訊息，如果服務身分識別符合指定的端點中的身分識別用戶端使用的位址。</span><span class="sxs-lookup"><span data-stu-id="b908b-112">When the client initiates a secure channel to send a message to a service over it, the Windows Communication Foundation (WCF) infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.</span></span>  
  
 <span data-ttu-id="b908b-113">身分識別處理包含下列階段：</span><span class="sxs-lookup"><span data-stu-id="b908b-113">Identity processing consists of the following stages:</span></span>  
  
- <span data-ttu-id="b908b-114">在設計階段，用戶端開發人員會從端點的中繼資料 (透過 WSDL 公開) 來決定服務的身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-114">At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).</span></span>  
  
- <span data-ttu-id="b908b-115">在執行階段，用戶端應用程式會先檢查服務安全性認證的宣告，再將訊息傳送至服務。</span><span class="sxs-lookup"><span data-stu-id="b908b-115">At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.</span></span>  
  
 <span data-ttu-id="b908b-116">用戶端上的身分識別處理與服務上的用戶端驗證很類似。</span><span class="sxs-lookup"><span data-stu-id="b908b-116">Identity processing on the client is analogous to client authentication on the service.</span></span> <span data-ttu-id="b908b-117">安全服務會等到用戶端認證經過驗證之後，才會執行程式碼。</span><span class="sxs-lookup"><span data-stu-id="b908b-117">A secure service does not execute code until the client's credentials have been authenticated.</span></span> <span data-ttu-id="b908b-118">同理，用戶端會等到服務認證根據事先從服務中繼資料得知的內容經過驗證之後，才會將訊息傳送至服務。</span><span class="sxs-lookup"><span data-stu-id="b908b-118">Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.</span></span>  
  
 <span data-ttu-id="b908b-119"><xref:System.ServiceModel.EndpointAddress.Identity%2A> 類別的 <xref:System.ServiceModel.EndpointAddress> 屬性代表用戶端所呼叫之服務的身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-119">The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client.</span></span> <span data-ttu-id="b908b-120">服務會在其中繼資料內發行 <xref:System.ServiceModel.EndpointAddress.Identity%2A>。</span><span class="sxs-lookup"><span data-stu-id="b908b-120">The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata.</span></span> <span data-ttu-id="b908b-121">當用戶端開發人員執行[ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)對服務端點，產生的組態會包含服務的價值<xref:System.ServiceModel.EndpointAddress.Identity%2A>屬性。</span><span class="sxs-lookup"><span data-stu-id="b908b-121">When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property.</span></span> <span data-ttu-id="b908b-122">（是否使用安全性設定），WCF 基礎結構會確認服務具有指定的身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-122">The WCF infrastructure (if configured with security) verifies that the service possesses the identity specified.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="b908b-123">中繼資料包含所需的服務身分識別，因此建議您透過安全方式來公開服務中繼資料，例如為服務建立 HTTPS 端點。</span><span class="sxs-lookup"><span data-stu-id="b908b-123">The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service.</span></span> <span data-ttu-id="b908b-124">如需詳細資訊，請參閱[如何：確保中繼資料端點的安全](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-124">For more information, see [How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).</span></span>  
  
## <a name="identity-types"></a><span data-ttu-id="b908b-125">身分識別類型</span><span class="sxs-lookup"><span data-stu-id="b908b-125">Identity Types</span></span>  
 <span data-ttu-id="b908b-126">服務可以提供六種身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-126">A service can provide six types of identities.</span></span> <span data-ttu-id="b908b-127">每種身分識別類型都會對應至可包含在組態 `<identity>` 項目中的某個項目。</span><span class="sxs-lookup"><span data-stu-id="b908b-127">Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration.</span></span> <span data-ttu-id="b908b-128">所使用的類型會隨情況和服務的安全性需求而有所不同，</span><span class="sxs-lookup"><span data-stu-id="b908b-128">The type used depends on the scenario and the service's security requirements.</span></span> <span data-ttu-id="b908b-129">下表說明每種身分識別類型。</span><span class="sxs-lookup"><span data-stu-id="b908b-129">The following table describes each identity type.</span></span>  
  
|<span data-ttu-id="b908b-130">身分識別類型</span><span class="sxs-lookup"><span data-stu-id="b908b-130">Identity type</span></span>|<span data-ttu-id="b908b-131">描述</span><span class="sxs-lookup"><span data-stu-id="b908b-131">Description</span></span>|<span data-ttu-id="b908b-132">典型案例</span><span class="sxs-lookup"><span data-stu-id="b908b-132">Typical scenario</span></span>|  
|-------------------|-----------------|----------------------|  
|<span data-ttu-id="b908b-133">網域名稱系統 (DNS)</span><span class="sxs-lookup"><span data-stu-id="b908b-133">Domain Name System (DNS)</span></span>|<span data-ttu-id="b908b-134">您可以使用此項目來搭配 X.509 憑證或 Windows 帳戶，</span><span class="sxs-lookup"><span data-stu-id="b908b-134">Use this element with X.509 certificates or Windows accounts.</span></span> <span data-ttu-id="b908b-135">它會比較認證中指定的 DNS 名稱與此項目中指定的值。</span><span class="sxs-lookup"><span data-stu-id="b908b-135">It compares the DNS name specified in the credential with the value specified in this element.</span></span>|<span data-ttu-id="b908b-136">DNS 檢查可讓您使用包含 DNS 或主體名稱的憑證。</span><span class="sxs-lookup"><span data-stu-id="b908b-136">A DNS check enables you to use certificates with DNS or subject names.</span></span> <span data-ttu-id="b908b-137">如果重新發行的憑證包含相同的 DNS 或主體名稱，則身分識別檢查仍舊有效。</span><span class="sxs-lookup"><span data-stu-id="b908b-137">If a certificate is reissued with the same DNS or subject name, then the identity check is still valid.</span></span> <span data-ttu-id="b908b-138">重新發行憑證時，憑證會取得新的 RSA 金鑰，但會保留相同的 DNS 或主體名稱，</span><span class="sxs-lookup"><span data-stu-id="b908b-138">When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name.</span></span> <span data-ttu-id="b908b-139">表示用戶端不需要更新與服務相關的用戶端身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="b908b-139">This means that clients do not have to update their identity information about the service.</span></span>|  
|<span data-ttu-id="b908b-140">憑證。</span><span class="sxs-lookup"><span data-stu-id="b908b-140">Certificate.</span></span> <span data-ttu-id="b908b-141">當 `ClientCredentialType` 設為 Certificate 時的預設值。</span><span class="sxs-lookup"><span data-stu-id="b908b-141">The default when `ClientCredentialType` is set to Certificate.</span></span>|<span data-ttu-id="b908b-142">此項目會指定 Base64 編碼格式的 X.509 憑證值，以便與用戶端進行比較。</span><span class="sxs-lookup"><span data-stu-id="b908b-142">This element specifies a Base64-encoded X.509 certificate value to compare with the client.</span></span><br /><br /> <span data-ttu-id="b908b-143">如果您使用 [!INCLUDE[infocard](../../../../includes/infocard-md.md)] 做為驗證服務的認證，也要使用此項目。</span><span class="sxs-lookup"><span data-stu-id="b908b-143">Also use this element when using a [!INCLUDE[infocard](../../../../includes/infocard-md.md)] as a credential to authenticate the service.</span></span>|<span data-ttu-id="b908b-144">此項目會根據憑證的指紋值將驗證限制為單一憑證，</span><span class="sxs-lookup"><span data-stu-id="b908b-144">This element restricts authentication to a single certificate based upon its thumbprint value.</span></span> <span data-ttu-id="b908b-145">因為指紋值是唯一的，所以這麼做可以讓驗證更加嚴格，</span><span class="sxs-lookup"><span data-stu-id="b908b-145">This enables stricter authentication because thumbprint values are unique.</span></span> <span data-ttu-id="b908b-146">這是隨附有一點要注意：如果憑證使用相同的主體名稱重新發出，它也會有新的指紋。</span><span class="sxs-lookup"><span data-stu-id="b908b-146">This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint.</span></span> <span data-ttu-id="b908b-147">因此，用戶端必須先知道新的指紋，才能驗證服務。</span><span class="sxs-lookup"><span data-stu-id="b908b-147">Therefore, clients are not able to validate the service unless the new thumbprint is known.</span></span> <span data-ttu-id="b908b-148">如需尋找憑證指紋的詳細資訊，請參閱[How to:擷取憑證的指紋](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-148">For more information about finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md).</span></span>|  
|<span data-ttu-id="b908b-149">憑證參考</span><span class="sxs-lookup"><span data-stu-id="b908b-149">Certificate Reference</span></span>|<span data-ttu-id="b908b-150">與先前所述之「憑證」選項相同。</span><span class="sxs-lookup"><span data-stu-id="b908b-150">Identical to the Certificate option described previously.</span></span> <span data-ttu-id="b908b-151">但是，這個項目可讓您指定憑證名稱與存放區位置，以便從中擷取憑證。</span><span class="sxs-lookup"><span data-stu-id="b908b-151">However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.</span></span>|<span data-ttu-id="b908b-152">與先前所述之「憑證」案例相同。</span><span class="sxs-lookup"><span data-stu-id="b908b-152">Same as the Certificate scenario described previously.</span></span><br /><br /> <span data-ttu-id="b908b-153">好處是憑證存放區位置可以變更。</span><span class="sxs-lookup"><span data-stu-id="b908b-153">The benefit is that the certificate store location can change.</span></span>|  
|<span data-ttu-id="b908b-154">RSA</span><span class="sxs-lookup"><span data-stu-id="b908b-154">RSA</span></span>|<span data-ttu-id="b908b-155">此項目會指定 RSA 金鑰值，以便與用戶端進行比較。</span><span class="sxs-lookup"><span data-stu-id="b908b-155">This element specifies an RSA key value to compare with the client.</span></span> <span data-ttu-id="b908b-156">此選項與憑證選項很類似，但不是使用憑證的指紋，而是改為使用憑證的 RSA 金鑰。</span><span class="sxs-lookup"><span data-stu-id="b908b-156">This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.</span></span>|<span data-ttu-id="b908b-157">RSA 檢查可讓您根據憑證的 RSA 金鑰將驗證限制為單一憑證，</span><span class="sxs-lookup"><span data-stu-id="b908b-157">An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key.</span></span> <span data-ttu-id="b908b-158">雖然這個做法可以更嚴格地驗證 RSA 金鑰，但是如果 RSA 金鑰值改變，服務就再也無法與現有的用戶端一起使用。</span><span class="sxs-lookup"><span data-stu-id="b908b-158">This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.</span></span>|  
|<span data-ttu-id="b908b-159">使用者主要名稱 (UPN)。</span><span class="sxs-lookup"><span data-stu-id="b908b-159">User principal name (UPN).</span></span> <span data-ttu-id="b908b-160">當 `ClientCredentialType` 設為 Windows，且服務處理序不是以其中一個系統帳戶執行時的預設值。</span><span class="sxs-lookup"><span data-stu-id="b908b-160">The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts.</span></span>|<span data-ttu-id="b908b-161">此項目會指定用來執行服務的 UPN。</span><span class="sxs-lookup"><span data-stu-id="b908b-161">This element specifies the UPN that the service is running under.</span></span> <span data-ttu-id="b908b-162">請參閱 Kerberos 通訊協定和身分識別一節[覆寫來進行驗證的服務身分識別](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-162">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="b908b-163">這樣可確保服務在特定 Windows 使用者帳戶底下執行。</span><span class="sxs-lookup"><span data-stu-id="b908b-163">This ensures that the service is running under a specific Windows user account.</span></span> <span data-ttu-id="b908b-164">使用者帳戶可以是目前登入的使用者或是在特定使用者帳戶底下執行的服務。</span><span class="sxs-lookup"><span data-stu-id="b908b-164">The user account can be either the current logged-on user or the service running under a particular user account.</span></span><br /><br /> <span data-ttu-id="b908b-165">如果服務是在 Active Directory 環境中的網域帳戶底下執行，此設定便能充分善用 Windows Kerberos 安全性的優勢。</span><span class="sxs-lookup"><span data-stu-id="b908b-165">This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.</span></span>|  
|<span data-ttu-id="b908b-166">服務主要名稱 (SPN)。</span><span class="sxs-lookup"><span data-stu-id="b908b-166">Service principal name (SPN).</span></span> <span data-ttu-id="b908b-167">當 `ClientCredentialType` 設為 Windows，且服務處理序在 LocalService、LocalSystem 或 NetworkService 系統帳戶底下執行時的預設值。</span><span class="sxs-lookup"><span data-stu-id="b908b-167">The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accounts—LocalService, LocalSystem, or NetworkService.</span></span>|<span data-ttu-id="b908b-168">此項目會指定與服務帳戶關聯的 SPN。</span><span class="sxs-lookup"><span data-stu-id="b908b-168">This element specifies the SPN associated with the service's account.</span></span> <span data-ttu-id="b908b-169">請參閱 Kerberos 通訊協定和身分識別一節[覆寫來進行驗證的服務身分識別](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-169">See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>|<span data-ttu-id="b908b-170">這樣可確保 SPN 及與其關聯之特定 Windows 帳戶都能識別服務。</span><span class="sxs-lookup"><span data-stu-id="b908b-170">This ensures that the SPN and the specific Windows account associated with the SPN identify the service.</span></span><br /><br /> <span data-ttu-id="b908b-171">您可以使用 Setspn.exe 工具讓電腦帳戶與服務的使用者帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="b908b-171">You can use the Setspn.exe tool to associate a machine account for the service's user account.</span></span><br /><br /> <span data-ttu-id="b908b-172">如果服務是在其中一個系統帳戶或具有相關 SPN 名稱的網域帳戶底下執行，而且電腦是 Active Directory 環境中的網域成員時，此設定便能充分善用 Windows Kerberos 安全性的優勢。</span><span class="sxs-lookup"><span data-stu-id="b908b-172">This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.</span></span>|  
  
## <a name="specifying-identity-at-the-service"></a><span data-ttu-id="b908b-173">指定服務端的身分識別</span><span class="sxs-lookup"><span data-stu-id="b908b-173">Specifying Identity at the Service</span></span>  
 <span data-ttu-id="b908b-174">一般來說，您不需要在服務上設定身分識別，因為選擇用戶端認證類型，即表示服務中繼資料中公開的身分識別類型。</span><span class="sxs-lookup"><span data-stu-id="b908b-174">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="b908b-175">如需如何覆寫或指定服務身分識別的詳細資訊，請參閱[覆寫來進行驗證的服務身分識別](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-175">For more information about how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).</span></span>  
  
## <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="b908b-176">使用\<身分識別 > 組態中的項目</span><span class="sxs-lookup"><span data-stu-id="b908b-176">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="b908b-177">如果您在先前對 `Certificate,` 顯示的繫結中變更用戶端認證類型，則產生的 WSDL 會包含 Base64 序列化 X.509 憑證做為身分識別值，如下列程式碼所示。</span><span class="sxs-lookup"><span data-stu-id="b908b-177">If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="b908b-178">這是 Windows 以外所有用戶端認證類型的預設值。</span><span class="sxs-lookup"><span data-stu-id="b908b-178">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="b908b-179">您可以變更預設服務身分識別的值，或變更身分識別類型使用`<identity>`組態中或在程式碼中設定身分識別的項目。</span><span class="sxs-lookup"><span data-stu-id="b908b-179">You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="b908b-180">下列組態程式碼會以 `contoso.com` 這個值來設定網域名稱系統 (DNS) 身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-180">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

## <a name="setting-identity-programmatically"></a><span data-ttu-id="b908b-181">以程式設計方式設定身分識別</span><span class="sxs-lookup"><span data-stu-id="b908b-181">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="b908b-182">您的服務並沒有明確指定身分識別，因為 WCF 會自動決定。</span><span class="sxs-lookup"><span data-stu-id="b908b-182">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="b908b-183">不過，WCF 可讓您指定的身分識別的端點，如有必要。</span><span class="sxs-lookup"><span data-stu-id="b908b-183">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="b908b-184">下列程式碼會新增具有特定 DNS 身分識別的新服務端點。</span><span class="sxs-lookup"><span data-stu-id="b908b-184">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="specifying-identity-at-the-client"></a><span data-ttu-id="b908b-185">指定用戶端的身分識別</span><span class="sxs-lookup"><span data-stu-id="b908b-185">Specifying Identity at the Client</span></span>  
 <span data-ttu-id="b908b-186">在設計階段，用戶端開發人員通常會使用[ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)來產生用戶端組態。</span><span class="sxs-lookup"><span data-stu-id="b908b-186">At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration.</span></span> <span data-ttu-id="b908b-187">產生的組態檔 (供用戶端使用) 會包含伺服器的身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-187">The generated configuration file (intended for use by the client) contains the server's identity.</span></span> <span data-ttu-id="b908b-188">例如，下列由服務產生的程式碼會指定 DNS 身分識別，如先前範例所示。</span><span class="sxs-lookup"><span data-stu-id="b908b-188">For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example.</span></span> <span data-ttu-id="b908b-189">請注意，用戶端的端點身分識別值符合服務的身分識別值。</span><span class="sxs-lookup"><span data-stu-id="b908b-189">Note that the client's endpoint identity value matches that of the service.</span></span> <span data-ttu-id="b908b-190">此時，如果用戶端接收服務的 Windows (Kerberos) 認證，值應該會是 `contoso.com`。</span><span class="sxs-lookup"><span data-stu-id="b908b-190">In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`.</span></span>  

 <span data-ttu-id="b908b-191">如果，服務 (而不是 Windows) 將憑證指定為用戶端認證類型，則憑證的 DNS 屬性應該會是 `contoso.com`</span><span class="sxs-lookup"><span data-stu-id="b908b-191">If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`.</span></span> <span data-ttu-id="b908b-192">(或者，如果 DNS 屬性為 `null`，則憑證的主體名稱必須是 `contoso.com`)。</span><span class="sxs-lookup"><span data-stu-id="b908b-192">(Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)</span></span>  
  
#### <a name="using-a-specific-value-for-identity"></a><span data-ttu-id="b908b-193">使用特定的身分識別值</span><span class="sxs-lookup"><span data-stu-id="b908b-193">Using a Specific Value for Identity</span></span>  
 <span data-ttu-id="b908b-194">下列用戶端組態檔說明服務的身分識別值如何成為所需的特定值。</span><span class="sxs-lookup"><span data-stu-id="b908b-194">The following client configuration file shows how the service's identity is expected to be a specific value.</span></span> <span data-ttu-id="b908b-195">在下列範例中，用戶端可與兩個端點進行通訊。</span><span class="sxs-lookup"><span data-stu-id="b908b-195">In the following example, the client can communicate with two endpoints.</span></span> <span data-ttu-id="b908b-196">第一個端點是使用憑證指紋進行識別，而第二個則是使用憑證 RSA 金鑰。</span><span class="sxs-lookup"><span data-stu-id="b908b-196">The first is identified with a certificate thumbprint and the second with a certificate RSA key.</span></span> <span data-ttu-id="b908b-197">也就是說，這個憑證只包含公用金鑰/私用金鑰組，不是由受信任的授權單位發行。</span><span class="sxs-lookup"><span data-stu-id="b908b-197">That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.</span></span>  

## <a name="identity-checking-at-run-time"></a><span data-ttu-id="b908b-198">執行階段的身分識別檢查</span><span class="sxs-lookup"><span data-stu-id="b908b-198">Identity Checking at Run Time</span></span>  
 <span data-ttu-id="b908b-199">在設計階段，用戶端開發人員會透過伺服器的中繼資料來決定其身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-199">At design time, a client developer determines the server's identity through its metadata.</span></span> <span data-ttu-id="b908b-200">在執行階段，系統會先執行身分識別檢查，然後再呼叫服務的任何端點。</span><span class="sxs-lookup"><span data-stu-id="b908b-200">At runtime, the identity check is performed before calling any endpoints on the service.</span></span>  
  
 <span data-ttu-id="b908b-201">身分識別值與中繼資料指定的驗證類型有關，換句話說，就是服務使用的認證類型。</span><span class="sxs-lookup"><span data-stu-id="b908b-201">The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.</span></span>  
  
 <span data-ttu-id="b908b-202">如果通道已設為使用具有 X.509 憑證的訊息層級或傳輸層級 Secure Sockets Layer (SSL) 來進行驗證，則下列身分識別值有效：</span><span class="sxs-lookup"><span data-stu-id="b908b-202">If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="b908b-203">DNS：</span><span class="sxs-lookup"><span data-stu-id="b908b-203">DNS.</span></span> <span data-ttu-id="b908b-204">WCF 可確保在 SSL 交換期間提供的憑證包含 DNS 或`CommonName`(CN) 屬性等於在用戶端之 DNS 身分識別中指定的值。</span><span class="sxs-lookup"><span data-stu-id="b908b-204">WCF ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client.</span></span> <span data-ttu-id="b908b-205">請注意，除了判斷伺服器憑證是否有效，系統也會進行這些檢查。</span><span class="sxs-lookup"><span data-stu-id="b908b-205">Note that these checks are done in addition to determining the validity of the server certificate.</span></span> <span data-ttu-id="b908b-206">根據預設，WCF 會驗證伺服器憑證由受信任的根授權單位發出。</span><span class="sxs-lookup"><span data-stu-id="b908b-206">By default, WCF validates that the server certificate is issued by a trusted root authority.</span></span>  
  
- <span data-ttu-id="b908b-207">憑證。</span><span class="sxs-lookup"><span data-stu-id="b908b-207">Certificate.</span></span> <span data-ttu-id="b908b-208">在 SSL 交握期間，WCF 可確保遠端端點提供身分識別中指定正確的憑證值。</span><span class="sxs-lookup"><span data-stu-id="b908b-208">During the SSL handshake, WCF ensures that the remote endpoint provides the exact certificate value specified in the identity.</span></span>  
  
- <span data-ttu-id="b908b-209">憑證參考：</span><span class="sxs-lookup"><span data-stu-id="b908b-209">Certificate Reference.</span></span> <span data-ttu-id="b908b-210">與「憑證」相同。</span><span class="sxs-lookup"><span data-stu-id="b908b-210">Same as Certificate.</span></span>  
  
- <span data-ttu-id="b908b-211">RSA：</span><span class="sxs-lookup"><span data-stu-id="b908b-211">RSA.</span></span> <span data-ttu-id="b908b-212">在 SSL 交握期間，WCF 可確保遠端端點提供正確的身分識別中指定的 RSA 金鑰。</span><span class="sxs-lookup"><span data-stu-id="b908b-212">During the SSL handshake, WCF ensures that the remote endpoint provides the exact RSA key specified in the identity.</span></span>  
  
 <span data-ttu-id="b908b-213">如果服務使用具有 Windows 認證的訊息層級或傳輸層級 SSL 來進行驗證並交涉認證，則下列身分識別值有效：</span><span class="sxs-lookup"><span data-stu-id="b908b-213">If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:</span></span>  
  
- <span data-ttu-id="b908b-214">DNS：</span><span class="sxs-lookup"><span data-stu-id="b908b-214">DNS.</span></span> <span data-ttu-id="b908b-215">交涉會傳遞服務的 SPN，以便檢查 DNS 名稱。</span><span class="sxs-lookup"><span data-stu-id="b908b-215">The negotiation passes the service's SPN so that the DNS name can be checked.</span></span> <span data-ttu-id="b908b-216">SPN 的形式為 `host/<dns name>`。</span><span class="sxs-lookup"><span data-stu-id="b908b-216">The SPN is in the form `host/<dns name>`.</span></span>  
  
- <span data-ttu-id="b908b-217">SPN：</span><span class="sxs-lookup"><span data-stu-id="b908b-217">SPN.</span></span> <span data-ttu-id="b908b-218">會傳回明確的服務 SPN，例如 `host/myservice`。</span><span class="sxs-lookup"><span data-stu-id="b908b-218">An explicit service SPN is returned, for example, `host/myservice`.</span></span>  
  
- <span data-ttu-id="b908b-219">UPN：</span><span class="sxs-lookup"><span data-stu-id="b908b-219">UPN.</span></span> <span data-ttu-id="b908b-220">服務帳戶的 UPN。</span><span class="sxs-lookup"><span data-stu-id="b908b-220">The UPN of the service account.</span></span> <span data-ttu-id="b908b-221">UPN 的格式`username` @ `domain`。</span><span class="sxs-lookup"><span data-stu-id="b908b-221">The UPN is in the form `username`@`domain`.</span></span> <span data-ttu-id="b908b-222">例如，當服務在使用者帳戶底下執行時，UPN 可能為 `username@contoso.com`。</span><span class="sxs-lookup"><span data-stu-id="b908b-222">For example, when the service is running in a user account, it may be `username@contoso.com`.</span></span>  
  
 <span data-ttu-id="b908b-223">您可以選擇以程式設計方式指定身分識別 (透過 <xref:System.ServiceModel.EndpointAddress.Identity%2A> 屬性)。</span><span class="sxs-lookup"><span data-stu-id="b908b-223">Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional.</span></span> <span data-ttu-id="b908b-224">如果未指定任何身分識別，且用戶端認證類型為 Windows，則預設值為 SPN (其值設為服務端點位址的主機名稱部分，並於前面加上 "host/" 常值)。</span><span class="sxs-lookup"><span data-stu-id="b908b-224">If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the "host/" literal.</span></span> <span data-ttu-id="b908b-225">如果未指定任何身分識別，且用戶端認證類型為憑證，則預設為 `Certificate`，</span><span class="sxs-lookup"><span data-stu-id="b908b-225">If no identity is specified, and the client credential type is a certificate, the default is `Certificate`.</span></span> <span data-ttu-id="b908b-226">訊息層級與傳輸層級安全性都適用這個預設值。</span><span class="sxs-lookup"><span data-stu-id="b908b-226">This applies to both message- and transport-level security.</span></span>  
  
## <a name="identity-and-custom-bindings"></a><span data-ttu-id="b908b-227">身分識別與自訂繫結</span><span class="sxs-lookup"><span data-stu-id="b908b-227">Identity and Custom Bindings</span></span>  
 <span data-ttu-id="b908b-228">由於服務的身分識別取決於使用的繫結型別，所以建立自訂繫結時一定要公開適當的身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-228">Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding.</span></span> <span data-ttu-id="b908b-229">例如，在下列程式碼範例中，公開的身分識別與安全性類型不相容，因為安全對話啟動安裝繫結的身分識別與端點上的繫結身分識別不符。</span><span class="sxs-lookup"><span data-stu-id="b908b-229">For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint.</span></span> <span data-ttu-id="b908b-230">安全對話繫結會設定 DNS 身分識別，而 <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> 則會設定 UPN 或 SPN 身分識別。</span><span class="sxs-lookup"><span data-stu-id="b908b-230">The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity.</span></span>  
  
 [!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]
 [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]  
  
 <span data-ttu-id="b908b-231">如需有關如何堆疊繫結項目正確地自訂繫結，請參閱[Creating User-Defined 繫結](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-231">For more information about how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md).</span></span> <span data-ttu-id="b908b-232">如需有關建立自訂繫結與<xref:System.ServiceModel.Channels.SecurityBindingElement>，請參閱[How to:為指定的驗證模式建立 SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)。</span><span class="sxs-lookup"><span data-stu-id="b908b-232">For more information about creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b908b-233">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b908b-233">See also</span></span>

- [<span data-ttu-id="b908b-234">如何：建立自訂繫結使用 SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="b908b-234">How to: Create a Custom Binding Using the SecurityBindingElement</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)
- [<span data-ttu-id="b908b-235">如何：為指定的驗證模式建立 SecurityBindingElement</span><span class="sxs-lookup"><span data-stu-id="b908b-235">How to: Create a SecurityBindingElement for a Specified Authentication Mode</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)
- [<span data-ttu-id="b908b-236">如何：建立自訂用戶端身分識別驗證器</span><span class="sxs-lookup"><span data-stu-id="b908b-236">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="b908b-237">選取認證類型</span><span class="sxs-lookup"><span data-stu-id="b908b-237">Selecting a Credential Type</span></span>](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md)
- [<span data-ttu-id="b908b-238">使用憑證</span><span class="sxs-lookup"><span data-stu-id="b908b-238">Working with Certificates</span></span>](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)
- [<span data-ttu-id="b908b-239">ServiceModel 中繼資料公用程式工具 (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="b908b-239">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)
- [<span data-ttu-id="b908b-240">建立使用者定義繫結</span><span class="sxs-lookup"><span data-stu-id="b908b-240">Creating User-Defined Bindings</span></span>](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)
- [<span data-ttu-id="b908b-241">如何：擷取憑證的指紋</span><span class="sxs-lookup"><span data-stu-id="b908b-241">How to: Retrieve the Thumbprint of a Certificate</span></span>](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)
