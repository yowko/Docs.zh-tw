---
title: "以 Web 裝載佇列應用程式"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88
caps.latest.revision: "18"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 38edfcb1363e538295e1fb1a8b8fe0c5b2d34691
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/21/2017
---
# <a name="web-hosting-a-queued-application"></a><span data-ttu-id="1b608-102">以 Web 裝載佇列應用程式</span><span class="sxs-lookup"><span data-stu-id="1b608-102">Web Hosting a Queued Application</span></span>
<span data-ttu-id="1b608-103">Windows Process Activation Service (WAS) 管理背景工作處理序 (其中包含裝載 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 服務的應用程式) 的啟動與存留期。</span><span class="sxs-lookup"><span data-stu-id="1b608-103">The Windows Process Activation Service (WAS) manages the activation and lifetime of the worker processes that contain applications that host [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services.</span></span> <span data-ttu-id="1b608-104">WAS 處理序模型會藉由移除 HTTP 上的相依性，將 HTTP 伺服器的 [!INCLUDE[iis601](../../../../includes/iis601-md.md)] 處理序模型一般化。</span><span class="sxs-lookup"><span data-stu-id="1b608-104">The WAS process model generalizes the [!INCLUDE[iis601](../../../../includes/iis601-md.md)] process model for the HTTP server by removing the dependency on HTTP.</span></span> <span data-ttu-id="1b608-105">如此可讓 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 服務能在支援訊息啟動以及提供可在指定電腦上裝載大量應用程式之能力的裝載環境中，同時使用 HTTP 和非 HTTP 通訊協定，例如 net.msmq 和 msmq.formatname。</span><span class="sxs-lookup"><span data-stu-id="1b608-105">This allows [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services to use both HTTP and non-HTTP protocols, such as net.msmq and msmq.formatname, in a hosting environment that supports message-based activation and offers the ability to host a large number of applications on a given computer.</span></span>  
  
 <span data-ttu-id="1b608-106">WAS 包括訊息佇列 (MSMQ) 啟動服務，該服務會在佇列的應用程式所使用的其中一個佇列內置放一個或多個訊息時，啟動佇列的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1b608-106">WAS includes a Message Queuing (MSMQ) activation service that activates a queued application when one or more messages are placed in one of the queues used by the application.</span></span> <span data-ttu-id="1b608-107">MSMQ 啟動服務是 NT 服務，預設為自動啟動。</span><span class="sxs-lookup"><span data-stu-id="1b608-107">The MSMQ activation service is an NT service that is automatically started by default.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="1b608-108">WAS 和它的優點，請參閱[Windows Process Activation Service 中裝載](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md)。</span><span class="sxs-lookup"><span data-stu-id="1b608-108"> WAS and its benefits, see [Hosting in Windows Process Activation Service](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="1b608-109">MSMQ 中，請參閱[佇列概觀](../../../../docs/framework/wcf/feature-details/queues-overview.md)</span><span class="sxs-lookup"><span data-stu-id="1b608-109"> MSMQ, see [Queues Overview](../../../../docs/framework/wcf/feature-details/queues-overview.md)</span></span>  
  
## <a name="queue-addressing-in-was"></a><span data-ttu-id="1b608-110">WAS 中的佇列定址</span><span class="sxs-lookup"><span data-stu-id="1b608-110">Queue Addressing in WAS</span></span>  
 <span data-ttu-id="1b608-111">WAS 應用程式擁有統一資源識別元 (URI) 位址。</span><span class="sxs-lookup"><span data-stu-id="1b608-111">WAS applications have Uniform Resource Identifier (URI) addresses.</span></span> <span data-ttu-id="1b608-112">應用程式位址包含兩個部分：基底 URI 前置詞和應用程式專屬的相對位址 (路徑)。</span><span class="sxs-lookup"><span data-stu-id="1b608-112">Application addresses have two parts: a base URI prefix and an application-specific, relative address (path).</span></span> <span data-ttu-id="1b608-113">這兩個部分合在一起，便提供了應用程式的外部位址。</span><span class="sxs-lookup"><span data-stu-id="1b608-113">These two parts provide the external address for an application when joined together.</span></span> <span data-ttu-id="1b608-114">基底 URI 前置詞根據網站繫結所建構，並使用網站，例如"net.msmq: //localhost"、"msmq.formatname: //localhost"或"net.tcp: //localhost"下的所有應用程式。</span><span class="sxs-lookup"><span data-stu-id="1b608-114">The base URI prefix is constructed from the site binding and is used for all the applications under the site, for example, "net.msmq://localhost", "msmq.formatname://localhost", or "net.tcp://localhost".</span></span> <span data-ttu-id="1b608-115">然後會由特定應用程式的路徑片段建構應用程式位址 (例如"/ /applicationone") 並將它們附加至基底 URI 前置詞完整的應用程式的 URI，例如"net.msmq: //localhost/applicationone"。</span><span class="sxs-lookup"><span data-stu-id="1b608-115">Application addresses are then constructed by taking application-specific path fragments (such as "/applicationOne") and appending them to the base URI prefix to arrive at the full application URI, for example, "net.msmq://localhost/applicationOne".</span></span>  
  
 <span data-ttu-id="1b608-116">MSMQ 啟動服務會使用應用程式 URI，比對 MSMQ 啟動服務必須監視的訊息佇列。</span><span class="sxs-lookup"><span data-stu-id="1b608-116">The MSMQ activation service uses the application URI to match the queue that the MSMQ activation service must monitor for messages.</span></span> <span data-ttu-id="1b608-117">當 MSMQ 啟動服務啟動時，便會在設定為訊息接收來源的電腦上，列舉其所有的公用和私用佇列，並且監視佇列中是否有訊息。</span><span class="sxs-lookup"><span data-stu-id="1b608-117">When the MSMQ activation service starts, it enumerates all public and private queues on the computer it is configured to receive from and monitors them for messages.</span></span> <span data-ttu-id="1b608-118">MSMQ 啟動服務每 10 分鐘會更新一次監視的佇列清單。</span><span class="sxs-lookup"><span data-stu-id="1b608-118">Every 10 minutes, the MSMQ activation service refreshes the list of queues to monitor.</span></span> <span data-ttu-id="1b608-119">若在佇列中找到訊息，啟動服務就會將訊息名稱與 net.msmq 繫結中相符程度最高的應用程式 URI 進行比對，並啟動應用程式。</span><span class="sxs-lookup"><span data-stu-id="1b608-119">When a message is found in a queue, the activation service matches the queue name to the longest matching application URI for the net.msmq binding and activates the application.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1b608-120">啟動的應用程式必須符合 (相符程度最高) 佇列名稱的前置詞。</span><span class="sxs-lookup"><span data-stu-id="1b608-120">The application being activated must match (longest match) the prefix of the queue name.</span></span>  
  
 <span data-ttu-id="1b608-121">例如，佇列名稱為：msmqWebHost/orderProcessing/service.svc。</span><span class="sxs-lookup"><span data-stu-id="1b608-121">For example, a queue name is: msmqWebHost/orderProcessing/service.svc.</span></span> <span data-ttu-id="1b608-122">如果應用程式 1 擁有虛擬目錄 /msmqWebHost/orderProcessing，而且其中有一個 service.svc 檔案，而應用程式 2 擁有虛擬目錄 /msmqWebHost，而其中有一個 orderProcessing.svc 檔案，則會啟動應用程式 1。</span><span class="sxs-lookup"><span data-stu-id="1b608-122">If Application 1 has a virtual directory /msmqWebHost/orderProcessing with a service.svc under it, and Application 2 has a virtual directory /msmqWebHost with an orderProcessing.svc under it, Application 1 is activated.</span></span> <span data-ttu-id="1b608-123">如果應用程式 1 被刪除，則會啟動應用程式 2。</span><span class="sxs-lookup"><span data-stu-id="1b608-123">If Application 1 is deleted, Application 2 is activated.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="1b608-124">當建立佇列時，任何傳送到該佇列的訊息都不會啟動應用程式，除非 MSMQ 啟動服務重新整理佇列清單，也就是自建立佇列起算最多 10 分鐘。</span><span class="sxs-lookup"><span data-stu-id="1b608-124">When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created.</span></span> <span data-ttu-id="1b608-125">重新啟動啟動服務也同時會重新整理佇列清單。</span><span class="sxs-lookup"><span data-stu-id="1b608-125">Restarting the activation service refreshes the queue list as well.</span></span>  
  
### <a name="the-effect-of-private-and-public-queues-on-addressing"></a><span data-ttu-id="1b608-126">私用和公用佇列在定址上的影響</span><span class="sxs-lookup"><span data-stu-id="1b608-126">The Effect of Private and Public Queues on Addressing</span></span>  
 <span data-ttu-id="1b608-127">MSMQ 啟動服務並不會區分私用和公用佇列監視。</span><span class="sxs-lookup"><span data-stu-id="1b608-127">The MSMQ activation service does not distinguish between private and public queue monitoring.</span></span> <span data-ttu-id="1b608-128">因此，您不能以相同名稱使用公用和私用佇列。</span><span class="sxs-lookup"><span data-stu-id="1b608-128">As such, you cannot have public and private queues with the same name.</span></span> <span data-ttu-id="1b608-129">如果您這樣做，Web 裝載的應用程式可能會啟動，並從其中一個佇列讀取。</span><span class="sxs-lookup"><span data-stu-id="1b608-129">If you do, a Web-hosted application may get activated reading from either of the queues.</span></span>  
  
### <a name="queue-configuration-for-activation"></a><span data-ttu-id="1b608-130">啟動的佇列組態</span><span class="sxs-lookup"><span data-stu-id="1b608-130">Queue Configuration for Activation</span></span>  
 <span data-ttu-id="1b608-131">MSMQ 啟動服務會以 NETWORK SERVICE 執行。</span><span class="sxs-lookup"><span data-stu-id="1b608-131">The MSMQ activation service runs as NETWORK SERVICE.</span></span> <span data-ttu-id="1b608-132">它是監視佇列以啟動應用程式的服務。</span><span class="sxs-lookup"><span data-stu-id="1b608-132">It is the service that monitors queues to activate applications.</span></span> <span data-ttu-id="1b608-133">若要讓它從佇列啟動應用程式，則必須提供佇列，讓 NETWORK SERVICE 存取查看其存取控制清單 (ACL) 中的訊息。</span><span class="sxs-lookup"><span data-stu-id="1b608-133">For it to activate applications from the queue, the queue must provide for NETWORK SERVICE access to peek for messages in its access control list (ACL).</span></span>  
  
### <a name="poison-messaging"></a><span data-ttu-id="1b608-134">有害訊息</span><span class="sxs-lookup"><span data-stu-id="1b608-134">Poison Messaging</span></span>  
 <span data-ttu-id="1b608-135">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的有害訊息是由通道所處理，不僅會偵測訊息是否有害，還會根據使用者組態選取處置方法。</span><span class="sxs-lookup"><span data-stu-id="1b608-135">Poison message handling in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is handled by the channel, which not only detects that a message is poisoned but selects a disposition based on user configuration.</span></span> <span data-ttu-id="1b608-136">因此，佇列中會有單一訊息。</span><span class="sxs-lookup"><span data-stu-id="1b608-136">As a result, there is a single message in the queue.</span></span> <span data-ttu-id="1b608-137">Web 裝載的應用程式會中止後續的次數，而且該訊息會移到重試佇列中。</span><span class="sxs-lookup"><span data-stu-id="1b608-137">The Web-hosted application aborts successive times and the message is moved to a retry queue.</span></span> <span data-ttu-id="1b608-138">在重試週期延遲所指定的時間點上，該訊息會從重試佇列移到主要佇列並再次嘗試。</span><span class="sxs-lookup"><span data-stu-id="1b608-138">At a point dictated by the retry cycle delay, the message is moved from the retry queue to the main queue to try again.</span></span> <span data-ttu-id="1b608-139">但是這個動作需要佇列通道為使用中的狀態。</span><span class="sxs-lookup"><span data-stu-id="1b608-139">But this requires the queued channel to be active.</span></span> <span data-ttu-id="1b608-140">如果應用程式由 WAS 回收，那麼訊息就會留在重試佇列中，除非另一個訊息到達主要佇列並啟動佇列的應用程式。</span><span class="sxs-lookup"><span data-stu-id="1b608-140">If the application is recycled by WAS, then the message remains in the retry queue until another message arrives in the main queue to activate the queued application.</span></span> <span data-ttu-id="1b608-141">這個情況的解決方法是手動將訊息從重試佇列移回主要佇列，以重新啟動應用程式。</span><span class="sxs-lookup"><span data-stu-id="1b608-141">The workaround in this case is to move the message manually from the retry queue back to the main queue to reactivate the application.</span></span>  
  
### <a name="subqueue-and-system-queue-caveat"></a><span data-ttu-id="1b608-142">子佇列和系統佇列警告</span><span class="sxs-lookup"><span data-stu-id="1b608-142">Subqueue and System Queue Caveat</span></span>  
 <span data-ttu-id="1b608-143">WAS 裝載的應用程式無法根據系統佇列中的訊息啟動，例如整個系統寄不出的信件佇列，或是子佇列，例如有害子佇列。</span><span class="sxs-lookup"><span data-stu-id="1b608-143">A WAS-hosted application cannot be activated based on messages in a system queue, such as the system-wide dead-letter queue, or sub-queues, such as poison sub-queues.</span></span> <span data-ttu-id="1b608-144">這是這個產品版本的限制。</span><span class="sxs-lookup"><span data-stu-id="1b608-144">This is a limitation for this version of the product.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1b608-145">另請參閱</span><span class="sxs-lookup"><span data-stu-id="1b608-145">See Also</span></span>  
 [<span data-ttu-id="1b608-146">有害訊息處理</span><span class="sxs-lookup"><span data-stu-id="1b608-146">Poison Message Handling</span></span>](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)  
 [<span data-ttu-id="1b608-147">服務端點與佇列定址</span><span class="sxs-lookup"><span data-stu-id="1b608-147">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)
