---
title: 以 Web 裝載佇列應用程式
ms.date: 03/30/2017
ms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88
ms.openlocfilehash: 36c35fe0590ad9fc728641313d4175a432d7ccaa
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/22/2019
ms.locfileid: "69951569"
---
# <a name="web-hosting-a-queued-application"></a><span data-ttu-id="a0a0c-102">以 Web 裝載佇列應用程式</span><span class="sxs-lookup"><span data-stu-id="a0a0c-102">Web Hosting a Queued Application</span></span>
<span data-ttu-id="a0a0c-103">Windows 進程啟用服務 (WAS) 會管理包含裝載 Windows Communication Foundation (WCF) 服務之應用程式的工作者進程的啟用和存留期。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-103">The Windows Process Activation Service (WAS) manages the activation and lifetime of the worker processes that contain applications that host Windows Communication Foundation (WCF) services.</span></span> <span data-ttu-id="a0a0c-104">WAS 進程模型會藉由移除對 HTTP 的相依性, 來一般化 HTTP 伺服器的 IIS 6.0 進程模型。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-104">The WAS process model generalizes the IIS 6.0 process model for the HTTP server by removing the dependency on HTTP.</span></span> <span data-ttu-id="a0a0c-105">這可讓 WCF 服務在支援以訊息為基礎之啟用的主控環境中, 使用 HTTP 和非 HTTP 通訊協定 (例如 net.tcp 和 msmq.formatname), 並提供在指定電腦上裝載大量應用程式的功能。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-105">This allows WCF services to use both HTTP and non-HTTP protocols, such as net.msmq and msmq.formatname, in a hosting environment that supports message-based activation and offers the ability to host a large number of applications on a given computer.</span></span>  
  
 <span data-ttu-id="a0a0c-106">WAS 包括訊息佇列 (MSMQ) 啟動服務，該服務會在佇列的應用程式所使用的其中一個佇列內置放一個或多個訊息時，啟動佇列的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-106">WAS includes a Message Queuing (MSMQ) activation service that activates a queued application when one or more messages are placed in one of the queues used by the application.</span></span> <span data-ttu-id="a0a0c-107">MSMQ 啟動服務是 NT 服務，預設為自動啟動。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-107">The MSMQ activation service is an NT service that is automatically started by default.</span></span>  
  
 <span data-ttu-id="a0a0c-108">如需 WAS 及其優點的詳細資訊, 請參閱[在 Windows 進程啟用服務中裝載](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md)。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-108">For more information about WAS and its benefits, see [Hosting in Windows Process Activation Service](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md).</span></span> <span data-ttu-id="a0a0c-109">如需有關 MSMQ 的詳細資訊, 請參閱[佇列總覽](../../../../docs/framework/wcf/feature-details/queues-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-109">For more information about MSMQ, see [Queues Overview](../../../../docs/framework/wcf/feature-details/queues-overview.md).</span></span>
  
## <a name="queue-addressing-in-was"></a><span data-ttu-id="a0a0c-110">WAS 中的佇列定址</span><span class="sxs-lookup"><span data-stu-id="a0a0c-110">Queue Addressing in WAS</span></span>  
 <span data-ttu-id="a0a0c-111">WAS 應用程式擁有統一資源識別元 (URI) 位址。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-111">WAS applications have Uniform Resource Identifier (URI) addresses.</span></span> <span data-ttu-id="a0a0c-112">應用程式位址包含兩個部分：基底 URI 前置詞和應用程式專屬的相對位址 (路徑)。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-112">Application addresses have two parts: a base URI prefix and an application-specific, relative address (path).</span></span> <span data-ttu-id="a0a0c-113">這兩個部分合在一起，便提供了應用程式的外部位址。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-113">These two parts provide the external address for an application when joined together.</span></span> <span data-ttu-id="a0a0c-114">基底 URI 前置詞是由網站系結所組成, 並用於網站下的所有應用程式, 例如 "net.tcp://localhost"、"msmq. msmq.formatname://localhost" 或 "net.tcp://localhost"。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-114">The base URI prefix is constructed from the site binding and is used for all the applications under the site, for example, "net.msmq://localhost", "msmq.formatname://localhost", or "net.tcp://localhost".</span></span> <span data-ttu-id="a0a0c-115">接著會藉由取得應用程式特定的路徑片段 (例如 "/applicationOne") 來建立應用程式位址, 並將它們附加至基底 URI 前置詞, 以抵達完整的應用程式 URI, 例如 "net.tcp://localhost/applicationOne"。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-115">Application addresses are then constructed by taking application-specific path fragments (such as "/applicationOne") and appending them to the base URI prefix to arrive at the full application URI, for example, "net.msmq://localhost/applicationOne".</span></span>  
  
 <span data-ttu-id="a0a0c-116">MSMQ 啟動服務會使用應用程式 URI，比對 MSMQ 啟動服務必須監視的訊息佇列。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-116">The MSMQ activation service uses the application URI to match the queue that the MSMQ activation service must monitor for messages.</span></span> <span data-ttu-id="a0a0c-117">當 MSMQ 啟動服務啟動時，便會在設定為訊息接收來源的電腦上，列舉其所有的公用和私用佇列，並且監視佇列中是否有訊息。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-117">When the MSMQ activation service starts, it enumerates all public and private queues on the computer it is configured to receive from and monitors them for messages.</span></span> <span data-ttu-id="a0a0c-118">MSMQ 啟動服務每 10 分鐘會更新一次監視的佇列清單。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-118">Every 10 minutes, the MSMQ activation service refreshes the list of queues to monitor.</span></span> <span data-ttu-id="a0a0c-119">若在佇列中找到訊息，啟動服務就會將訊息名稱與 net.msmq 繫結中相符程度最高的應用程式 URI 進行比對，並啟動應用程式。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-119">When a message is found in a queue, the activation service matches the queue name to the longest matching application URI for the net.msmq binding and activates the application.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a0a0c-120">啟動的應用程式必須符合 (相符程度最高) 佇列名稱的前置詞。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-120">The application being activated must match (longest match) the prefix of the queue name.</span></span>  
  
 <span data-ttu-id="a0a0c-121">例如，佇列名稱為：msmqWebHost/orderProcessing/service.svc。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-121">For example, a queue name is: msmqWebHost/orderProcessing/service.svc.</span></span> <span data-ttu-id="a0a0c-122">如果應用程式 1 擁有虛擬目錄 /msmqWebHost/orderProcessing，而且其中有一個 service.svc 檔案，而應用程式 2 擁有虛擬目錄 /msmqWebHost，而其中有一個 orderProcessing.svc 檔案，則會啟動應用程式 1。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-122">If Application 1 has a virtual directory /msmqWebHost/orderProcessing with a service.svc under it, and Application 2 has a virtual directory /msmqWebHost with an orderProcessing.svc under it, Application 1 is activated.</span></span> <span data-ttu-id="a0a0c-123">如果應用程式 1 被刪除，則會啟動應用程式 2。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-123">If Application 1 is deleted, Application 2 is activated.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a0a0c-124">當建立佇列時，任何傳送到該佇列的訊息都不會啟動應用程式，除非 MSMQ 啟動服務重新整理佇列清單，也就是自建立佇列起算最多 10 分鐘。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-124">When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created.</span></span> <span data-ttu-id="a0a0c-125">重新啟動啟動服務也同時會重新整理佇列清單。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-125">Restarting the activation service refreshes the queue list as well.</span></span>  
  
### <a name="the-effect-of-private-and-public-queues-on-addressing"></a><span data-ttu-id="a0a0c-126">私用和公用佇列在定址上的影響</span><span class="sxs-lookup"><span data-stu-id="a0a0c-126">The Effect of Private and Public Queues on Addressing</span></span>  
 <span data-ttu-id="a0a0c-127">MSMQ 啟動服務並不會區分私用和公用佇列監視。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-127">The MSMQ activation service does not distinguish between private and public queue monitoring.</span></span> <span data-ttu-id="a0a0c-128">因此，您不能以相同名稱使用公用和私用佇列。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-128">As such, you cannot have public and private queues with the same name.</span></span> <span data-ttu-id="a0a0c-129">如果您這樣做，Web 裝載的應用程式可能會啟動，並從其中一個佇列讀取。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-129">If you do, a Web-hosted application may get activated reading from either of the queues.</span></span>  
  
### <a name="queue-configuration-for-activation"></a><span data-ttu-id="a0a0c-130">啟動的佇列組態</span><span class="sxs-lookup"><span data-stu-id="a0a0c-130">Queue Configuration for Activation</span></span>  
 <span data-ttu-id="a0a0c-131">MSMQ 啟動服務會以 NETWORK SERVICE 執行。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-131">The MSMQ activation service runs as NETWORK SERVICE.</span></span> <span data-ttu-id="a0a0c-132">它是監視佇列以啟動應用程式的服務。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-132">It is the service that monitors queues to activate applications.</span></span> <span data-ttu-id="a0a0c-133">若要讓它從佇列啟動應用程式，則必須提供佇列，讓 NETWORK SERVICE 存取查看其存取控制清單 (ACL) 中的訊息。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-133">For it to activate applications from the queue, the queue must provide for NETWORK SERVICE access to peek for messages in its access control list (ACL).</span></span>  
  
### <a name="poison-messaging"></a><span data-ttu-id="a0a0c-134">有害訊息</span><span class="sxs-lookup"><span data-stu-id="a0a0c-134">Poison Messaging</span></span>  
 <span data-ttu-id="a0a0c-135">WCF 中的有害訊息處理是由通道處理, 這不只會偵測到訊息已有害, 而是根據使用者設定來選取處置。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-135">Poison message handling in WCF is handled by the channel, which not only detects that a message is poisoned but selects a disposition based on user configuration.</span></span> <span data-ttu-id="a0a0c-136">因此，佇列中會有單一訊息。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-136">As a result, there is a single message in the queue.</span></span> <span data-ttu-id="a0a0c-137">Web 裝載的應用程式會中止後續的次數，而且該訊息會移到重試佇列中。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-137">The Web-hosted application aborts successive times and the message is moved to a retry queue.</span></span> <span data-ttu-id="a0a0c-138">在重試週期延遲所指定的時間點上，該訊息會從重試佇列移到主要佇列並再次嘗試。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-138">At a point dictated by the retry cycle delay, the message is moved from the retry queue to the main queue to try again.</span></span> <span data-ttu-id="a0a0c-139">但是這個動作需要佇列通道為使用中的狀態。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-139">But this requires the queued channel to be active.</span></span> <span data-ttu-id="a0a0c-140">如果應用程式由 WAS 回收，那麼訊息就會留在重試佇列中，除非另一個訊息到達主要佇列並啟動佇列的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-140">If the application is recycled by WAS, then the message remains in the retry queue until another message arrives in the main queue to activate the queued application.</span></span> <span data-ttu-id="a0a0c-141">這個情況的解決方法是手動將訊息從重試佇列移回主要佇列，以重新啟動應用程式。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-141">The workaround in this case is to move the message manually from the retry queue back to the main queue to reactivate the application.</span></span>  
  
### <a name="subqueue-and-system-queue-caveat"></a><span data-ttu-id="a0a0c-142">子佇列和系統佇列警告</span><span class="sxs-lookup"><span data-stu-id="a0a0c-142">Subqueue and System Queue Caveat</span></span>  
 <span data-ttu-id="a0a0c-143">WAS 裝載的應用程式無法根據系統佇列中的訊息啟動，例如整個系統寄不出的信件佇列，或是子佇列，例如有害子佇列。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-143">A WAS-hosted application cannot be activated based on messages in a system queue, such as the system-wide dead-letter queue, or sub-queues, such as poison sub-queues.</span></span> <span data-ttu-id="a0a0c-144">這是這個產品版本的限制。</span><span class="sxs-lookup"><span data-stu-id="a0a0c-144">This is a limitation for this version of the product.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a0a0c-145">另請參閱</span><span class="sxs-lookup"><span data-stu-id="a0a0c-145">See also</span></span>

- [<span data-ttu-id="a0a0c-146">有害訊息處理</span><span class="sxs-lookup"><span data-stu-id="a0a0c-146">Poison Message Handling</span></span>](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)
- [<span data-ttu-id="a0a0c-147">服務端點與佇列定址</span><span class="sxs-lookup"><span data-stu-id="a0a0c-147">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)
