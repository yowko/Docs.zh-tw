---
title: HTTP 傳輸安全性
ms.date: 03/30/2017
ms.assetid: d3439262-c58e-4d30-9f2b-a160170582bb
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: cc284f82f974d9b34ff1cf6732d2ee7b95528c44
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/04/2018
ms.locfileid: "33495918"
---
# <a name="http-transport-security"></a><span data-ttu-id="59c65-102">HTTP 傳輸安全性</span><span class="sxs-lookup"><span data-stu-id="59c65-102">HTTP Transport Security</span></span>
<span data-ttu-id="59c65-103">使用 HTTP 來傳輸時，會由安全通訊端層 (SSL) 實作提供安全性。</span><span class="sxs-lookup"><span data-stu-id="59c65-103">When using HTTP as the transport, security is provided by a Secure Sockets Layer (SSL) implementation.</span></span> <span data-ttu-id="59c65-104">在網際網路上會廣泛使用 SSL 以對用戶端驗證服務，進而對通道提供機密性 (加密)。</span><span class="sxs-lookup"><span data-stu-id="59c65-104">SSL is widely used on the Internet to authenticate a service to a client, and then to provide confidentiality (encryption) to the channel.</span></span> <span data-ttu-id="59c65-105">本主題會說明 SSL 的運作方式以及如何實作 Windows Communication Foundation (WCF)。</span><span class="sxs-lookup"><span data-stu-id="59c65-105">This topic explains how SSL works and how it is implemented in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="basic-ssl"></a><span data-ttu-id="59c65-106">基本 SSL</span><span class="sxs-lookup"><span data-stu-id="59c65-106">Basic SSL</span></span>  
 <span data-ttu-id="59c65-107">利用銀行網站這個典型案例，就可以明白解釋 SSL 的運作方式。</span><span class="sxs-lookup"><span data-stu-id="59c65-107">How SSL works is best explained through a typical scenario, in this case, a bank's Web site.</span></span> <span data-ttu-id="59c65-108">這些銀行網站可讓客戶透過使用者名稱和密碼進行登入。</span><span class="sxs-lookup"><span data-stu-id="59c65-108">The site allows a customer to log on with a user name and password.</span></span> <span data-ttu-id="59c65-109">在通過驗證之後，使用者就可以開始執行異動，例如檢閱帳戶結餘、付款以及將存款從某個帳戶移到其他帳戶等。</span><span class="sxs-lookup"><span data-stu-id="59c65-109">After being authenticated, the user can perform transactions, such as view account balances, pay bills, and move money from one account to another.</span></span>  
  
 <span data-ttu-id="59c65-110">當使用者第一次造訪的網站時，SSL 機制會開始一系列的交涉，呼叫*交握*，與使用者的用戶端 （在此情況下，Internet Explorer）。</span><span class="sxs-lookup"><span data-stu-id="59c65-110">When a user first visits the site, the SSL mechanism begins a series of negotiations, called a *handshake*, with the user's client (in this case, Internet Explorer).</span></span> <span data-ttu-id="59c65-111">SSL 會先對客戶驗證銀行網站。</span><span class="sxs-lookup"><span data-stu-id="59c65-111">SSL first authenticates the bank site to the customer.</span></span> <span data-ttu-id="59c65-112">這是很重要的一點，因為客戶必須先確定所進行通訊的網站是真正的網站，而不是嘗試誘惑他們輸入使用者名稱和密碼的詐騙網站。</span><span class="sxs-lookup"><span data-stu-id="59c65-112">This is an essential step because customers must first know that they are communicating with the actual site, and not a spoof that tries to lure them into typing in their user name and password.</span></span> <span data-ttu-id="59c65-113">SSL 會使用 VeriSign 這類信任授權單位所提供的 SSL 憑證來進行此驗證。</span><span class="sxs-lookup"><span data-stu-id="59c65-113">SSL does this authentication by using an SSL certificate provided by a trusted authority, such as VeriSign.</span></span> <span data-ttu-id="59c65-114">這種驗證方式的邏輯如下：VeriSign 會擔保銀行網站的身分識別。</span><span class="sxs-lookup"><span data-stu-id="59c65-114">The logic goes like this: VeriSign vouches for the identity of the bank site.</span></span> <span data-ttu-id="59c65-115">由於 Internet Explorer 信任 VeriSign，就表示也會信任該網站。</span><span class="sxs-lookup"><span data-stu-id="59c65-115">Because Internet Explorer trusts VeriSign, the site is trusted.</span></span> <span data-ttu-id="59c65-116">如果您要聯繫 VeriSign，只要按一下 VeriSign 標誌即可。</span><span class="sxs-lookup"><span data-stu-id="59c65-116">If you want to check with VeriSign, you can do so as well by clicking on the VeriSign logo.</span></span> <span data-ttu-id="59c65-117">接著就會顯示真實性聲明，其中並有到期日和發出的對象 (銀行網站) 等資訊。</span><span class="sxs-lookup"><span data-stu-id="59c65-117">That presents a statement of authenticity with its expiration date and who it is issued to (the bank site).</span></span>  
  
 <span data-ttu-id="59c65-118">要初始化安全工作階段時，用戶端會將同等於 "hello" 的訊息傳送至伺服器，其中並有用戶端可用來簽署、產生雜湊並用來加密和解密的密碼編譯演算法清單。</span><span class="sxs-lookup"><span data-stu-id="59c65-118">To initiate a secure session, the client sends the equivalent of a "hello" to the server along with a list of cryptographic algorithms it can use to sign, generate hashes, and encrypt and decrypt with.</span></span> <span data-ttu-id="59c65-119">而網站的回應，則是將認可和所選擇的其中一個演算法套件傳回用戶端。</span><span class="sxs-lookup"><span data-stu-id="59c65-119">In response, the site sends back an acknowledgment and its choice of one of the algorithms suites.</span></span> <span data-ttu-id="59c65-120">在此初始信號交換期間，雙方都會傳送和接收 Nonce。</span><span class="sxs-lookup"><span data-stu-id="59c65-120">During this initial handshake, both parties send and receive nonces.</span></span> <span data-ttu-id="59c65-121">A *nonce*是隨機產生的一種，搭配使用具有站台的公開金鑰，來建立雜湊的資料。</span><span class="sxs-lookup"><span data-stu-id="59c65-121">A *nonce* is a randomly generated piece of data that is used, in combination with the site's public key, to create a hash.</span></span> <span data-ttu-id="59c65-122">A*雜湊*是衍生自使用標準演算法，例如 SHA1 兩個數字的新數字。</span><span class="sxs-lookup"><span data-stu-id="59c65-122">A *hash* is a new number that is derived from the two numbers using a standard algorithm, such as SHA1.</span></span> <span data-ttu-id="59c65-123">(用戶端和網站也會交換訊息，以同意要使用的雜湊演算法)。雜湊是獨一無二的，而且只能用於用戶端和網站之間的工作階段，以加密和解密訊息。</span><span class="sxs-lookup"><span data-stu-id="59c65-123">(The client and the site also exchange messages to agree which hash algorithm to use.) The hash is unique and is used only for the session between the client and the site to encrypt and decrypt messages.</span></span> <span data-ttu-id="59c65-124">用戶端和服務都擁有原始 Nonce 和憑證的公開金鑰，因此這兩端才會產生相同的雜湊。</span><span class="sxs-lookup"><span data-stu-id="59c65-124">Both client and service have the original nonce and the certificate's public key, so both sides can generate the same hash.</span></span> <span data-ttu-id="59c65-125">因此，用戶端可透過 (a) 使用同意的演算法從資料計算雜湊，以及 (b) 與服務傳送的雜湊相比較的方式，驗證服務所傳送的雜湊；如果兩者相符，用戶端就可以確定雜湊未遭受竄改。</span><span class="sxs-lookup"><span data-stu-id="59c65-125">Therefore, the client validates the hash sent by the service by (a) using the agreed upon algorithm to calculate the hash from the data, and (b) comparing it to the hash sent by the service; if the two match, then the client has assurance that the hash has not been tampered with.</span></span> <span data-ttu-id="59c65-126">用戶端接著會使用此雜湊做為金鑰，以加密其中還含有其他新雜湊的訊息。</span><span class="sxs-lookup"><span data-stu-id="59c65-126">The client can then use this hash as a key to encrypt a message that contains yet another new hash.</span></span> <span data-ttu-id="59c65-127">服務可以使用雜湊來解密訊息，並復原這個所謂的第二到最後的雜湊。</span><span class="sxs-lookup"><span data-stu-id="59c65-127">The service can decrypt the message using the hash, and recover this second-to-final hash.</span></span> <span data-ttu-id="59c65-128">現在這兩端都明確知道此累積資訊 (Nonce、公開金鑰和其他資料)，就可以建立最終雜湊 (或主要金鑰)。</span><span class="sxs-lookup"><span data-stu-id="59c65-128">The accumulated information (nonces, public key, and other data) is now known to both sides, and a final hash (or master key) can be created.</span></span> <span data-ttu-id="59c65-129">將使用下一個到最後一個雜湊，並以加密形式傳送這個最終金鑰。</span><span class="sxs-lookup"><span data-stu-id="59c65-129">This final key is sent encrypted using the next-to-last hash.</span></span> <span data-ttu-id="59c65-130">接著會使用主要金鑰來加密和解密訊息，以重設工作階段。</span><span class="sxs-lookup"><span data-stu-id="59c65-130">The master key is then used to encrypt and decrypt messages for the reset of the session.</span></span> <span data-ttu-id="59c65-131">由於用戶端和服務使用相同的索引鍵，這也稱為*工作階段金鑰*。</span><span class="sxs-lookup"><span data-stu-id="59c65-131">Because both client and service use the same key, this is also called a *session key*.</span></span>  
  
 <span data-ttu-id="59c65-132">工作階段金鑰也可以稱為對稱金鑰，或者「共用密碼」。</span><span class="sxs-lookup"><span data-stu-id="59c65-132">The session key is also characterized as a symmetric key, or a "shared secret."</span></span> <span data-ttu-id="59c65-133">對稱金鑰相當重要，因為它可以減少交易兩端所需的計算。</span><span class="sxs-lookup"><span data-stu-id="59c65-133">Having a symmetric key is important because it reduces the computation required by both sides of the transaction.</span></span> <span data-ttu-id="59c65-134">如果每則訊息都要求重新交換 Nonce 和雜湊，就會降低效能。</span><span class="sxs-lookup"><span data-stu-id="59c65-134">If every message demanded a new exchange of nonces and hashes, performance would deteriorate.</span></span> <span data-ttu-id="59c65-135">因此，SSL 的終極目標就是使用對稱金鑰，讓訊息在擁有極佳的安全性和有效性之下，仍可自由地在這兩端之間傳送。</span><span class="sxs-lookup"><span data-stu-id="59c65-135">Therefore, the ultimate goal of SSL is to use a symmetric key that allows messages to flow freely between the two sides with a greater degree of security and efficiency.</span></span>  
  
 <span data-ttu-id="59c65-136">之前的描述只要概要說明，因為每個網站所使用的通訊協定都不盡相同。</span><span class="sxs-lookup"><span data-stu-id="59c65-136">The previous description is a simplified version of what happens, because the protocol may vary from site to site.</span></span> <span data-ttu-id="59c65-137">也可能用戶端和網站都會產生在信號交換期間以演算法系統結合的 Nonce，在交換資料期間一方面增加了複雜度但也提供更優良的保護方法。</span><span class="sxs-lookup"><span data-stu-id="59c65-137">It is also possible that both the client and the site both generate nonces that are algorithmically combined during the handshake to add more complexity, and therefore protection, to the process of exchanging data.</span></span>  
  
### <a name="certificates-and-public-key-infrastructure"></a><span data-ttu-id="59c65-138">憑證和公開金鑰基礎結構</span><span class="sxs-lookup"><span data-stu-id="59c65-138">Certificates and Public Key Infrastructure</span></span>  
 <span data-ttu-id="59c65-139">在信號交換期間，服務也會將其 SSL 憑證傳送至用戶端。</span><span class="sxs-lookup"><span data-stu-id="59c65-139">During the handshake, the service also sends its SSL certificate to the client.</span></span> <span data-ttu-id="59c65-140">憑證所含的資訊為：到期日、發行授權單位和網站的統一資源識別元 (URI)。</span><span class="sxs-lookup"><span data-stu-id="59c65-140">The certificate contains information, such as its expiration date, issuing authority, and the site's Uniform Resource Identifier (URI).</span></span> <span data-ttu-id="59c65-141">用戶端會比較此 URI 以及之前連絡時所用的原始 URI，確定相符之後也會檢查日期和發行授權單位。</span><span class="sxs-lookup"><span data-stu-id="59c65-141">The client compares the URI to the URI it had originally contacted to ensure a match, and also checks the date and issuing authority.</span></span>  
  
 <span data-ttu-id="59c65-142">每個憑證有兩個索引鍵、 私密金鑰與公開金鑰，而且兩個稱為*交換金鑰組*。</span><span class="sxs-lookup"><span data-stu-id="59c65-142">Every certificate has two keys, a private key and a public key, and the two are known as an *exchange key pair*.</span></span> <span data-ttu-id="59c65-143">簡而言之，只有憑證擁有者才知道私密金鑰，而公開金鑰則可以從憑證中讀取。</span><span class="sxs-lookup"><span data-stu-id="59c65-143">In brief, the private key is known only to the owner of the certificate while the public key is readable from the certificate.</span></span> <span data-ttu-id="59c65-144">您可以使用任一金鑰來加密或解密摘要、雜湊或其他金鑰，不過前提是這兩個金鑰的作業必須為相反。</span><span class="sxs-lookup"><span data-stu-id="59c65-144">Either key can be used to encrypt or decrypt a digest, hash, or other key, but only as contrary operations.</span></span> <span data-ttu-id="59c65-145">舉例來說，如果用戶端使用公開金鑰進行加密，則只有網站可以使用私密金鑰來解密訊息。</span><span class="sxs-lookup"><span data-stu-id="59c65-145">For example, if the client encrypts with the public key, only the site can decrypt the message using the private key.</span></span> <span data-ttu-id="59c65-146">同樣地，如果網站使用私密金鑰進行加密，則用戶端可以透過公開金鑰來解密。</span><span class="sxs-lookup"><span data-stu-id="59c65-146">Similarly, if the site encrypts with the private key, the client can decrypt with the public key.</span></span> <span data-ttu-id="59c65-147">如此一來，用戶端便可確定只有私密金鑰的處理者可以交換訊息，因為只有以私密金鑰加密的訊息可以透過公開金鑰來解密。</span><span class="sxs-lookup"><span data-stu-id="59c65-147">This provides assurance to the client that the messages are being exchanged only with the possessor of the private key because only messages encrypted with the private key can be decrypted with the public key.</span></span> <span data-ttu-id="59c65-148">網站會確定是與使用公開金鑰進行加密的用戶端來交換訊息。</span><span class="sxs-lookup"><span data-stu-id="59c65-148">The site is assured that it is exchanging messages with a client that has encrypted using the public key.</span></span> <span data-ttu-id="59c65-149">這樣的交換只對初始信號交換來說是安全的，這也說明了何以我們較常透過建立實際的對稱金鑰來執行。</span><span class="sxs-lookup"><span data-stu-id="59c65-149">This exchange is secure only for an initial handshake, however, which is why much more is done to create the actual symmetric key.</span></span> <span data-ttu-id="59c65-150">無論如何，所有通訊都會依據具有有效 SSL 憑證的服務。</span><span class="sxs-lookup"><span data-stu-id="59c65-150">Nevertheless, all communications depend on the service having a valid SSL certificate.</span></span>  
  
## <a name="implementing-ssl-with-wcf"></a><span data-ttu-id="59c65-151">以 WCF 實作 SSL</span><span class="sxs-lookup"><span data-stu-id="59c65-151">Implementing SSL with WCF</span></span>  
 <span data-ttu-id="59c65-152">HTTP 傳輸安全性 （SSL） 所提供或外部至 WCF。</span><span class="sxs-lookup"><span data-stu-id="59c65-152">HTTP transport security (or SSL) is provided externally to WCF.</span></span> <span data-ttu-id="59c65-153">您可以使用這兩種方法實作 SSL；決定的因素則視裝載您應用程式的方式而定：</span><span class="sxs-lookup"><span data-stu-id="59c65-153">You can implement SSL in one of two ways; the deciding factor is how your application is hosted:</span></span>  
  
-   <span data-ttu-id="59c65-154">如果您使用網際網路資訊服務 (IIS) 為 WCF 主機，使用 IIS 基礎結構來設定 SSL 服務。</span><span class="sxs-lookup"><span data-stu-id="59c65-154">If you are using Internet Information Services (IIS) as your WCF host, use the IIS infrastructure to set up an SSL service.</span></span>  
  
-   <span data-ttu-id="59c65-155">如果您要建立自我裝載的 WCF 應用程式，您可以使用 HttpCfg.exe 工具的位址來繫結 SSL 憑證。</span><span class="sxs-lookup"><span data-stu-id="59c65-155">If you are creating a self-hosted WCF application, you can bind an SSL certificate to the address using the HttpCfg.exe tool.</span></span>  
  
### <a name="using-iis-for-transport-security"></a><span data-ttu-id="59c65-156">在傳輸安全性中使用 IIS</span><span class="sxs-lookup"><span data-stu-id="59c65-156">Using IIS for Transport Security</span></span>  
  
#### <a name="iis-70"></a><span data-ttu-id="59c65-157">IIS 7.0</span><span class="sxs-lookup"><span data-stu-id="59c65-157">IIS 7.0</span></span>  
 <span data-ttu-id="59c65-158">若要設定[!INCLUDE[iisver](../../../../includes/iisver-md.md)]為安全主機 （使用 SSL），請參閱[IIS 7.0 Beta： 在 IIS 7.0 中設定安全通訊端層](http://go.microsoft.com/fwlink/?LinkId=88600)。</span><span class="sxs-lookup"><span data-stu-id="59c65-158">To set up [!INCLUDE[iisver](../../../../includes/iisver-md.md)] as a secure host (using SSL), see [IIS 7.0 Beta: Configuring Secure Sockets Layer in IIS 7.0](http://go.microsoft.com/fwlink/?LinkId=88600).</span></span>  
  
 <span data-ttu-id="59c65-159">若要設定用於憑證[!INCLUDE[iisver](../../../../includes/iisver-md.md)]，請參閱[IIS 7.0 Beta： 在 IIS 7.0 中設定伺服器憑證](http://go.microsoft.com/fwlink/?LinkID=88595)。</span><span class="sxs-lookup"><span data-stu-id="59c65-159">To configure certificates for use with [!INCLUDE[iisver](../../../../includes/iisver-md.md)], see [IIS 7.0 Beta: Configuring Server Certificates in IIS 7.0](http://go.microsoft.com/fwlink/?LinkID=88595).</span></span>  
  
#### <a name="iis-60"></a><span data-ttu-id="59c65-160">IIS 6.0</span><span class="sxs-lookup"><span data-stu-id="59c65-160">IIS 6.0</span></span>  
 <span data-ttu-id="59c65-161">若要設定[!INCLUDE[iis601](../../../../includes/iis601-md.md)]為安全主機 （使用 SSL），請參閱[設定安全通訊端層](http://go.microsoft.com/fwlink/?LinkId=88601)。</span><span class="sxs-lookup"><span data-stu-id="59c65-161">To set up [!INCLUDE[iis601](../../../../includes/iis601-md.md)] as a secure host (using SSL), see [Configuring Secure Sockets Layer](http://go.microsoft.com/fwlink/?LinkId=88601).</span></span>  
  
 <span data-ttu-id="59c65-162">若要設定用於憑證[!INCLUDE[iis601](../../../../includes/iis601-md.md)]，請參閱[Certificates_IIS_SP1_Ops](http://go.microsoft.com/fwlink/?LinkId=88602)。</span><span class="sxs-lookup"><span data-stu-id="59c65-162">To configure certificates for use with [!INCLUDE[iis601](../../../../includes/iis601-md.md)], see [Certificates_IIS_SP1_Ops](http://go.microsoft.com/fwlink/?LinkId=88602).</span></span>  
  
### <a name="using-httpcfg-for-ssl"></a><span data-ttu-id="59c65-163">對 SSL 使用 HttpCfg</span><span class="sxs-lookup"><span data-stu-id="59c65-163">Using HttpCfg for SSL</span></span>  
 <span data-ttu-id="59c65-164">如果您要建立自我裝載的 WCF 應用程式，下載 HttpCfg.exe 工具，可在[Windows XP Service Pack 2 支援工具網站](http://go.microsoft.com/fwlink/?LinkId=29002)。</span><span class="sxs-lookup"><span data-stu-id="59c65-164">If you are creating a self-hosted WCF application, download the HttpCfg.exe tool, available at the [Windows XP Service Pack 2 Support Tools site](http://go.microsoft.com/fwlink/?LinkId=29002).</span></span>  
  
 <span data-ttu-id="59c65-165">如需有關使用 HttpCfg.exe 工具來設定連接埠使用 X.509 憑證的詳細資訊，請參閱[How to： 使用 SSL 憑證設定連接埠](../../../../docs/framework/wcf/feature-details/how-to-configure-a-port-with-an-ssl-certificate.md)。</span><span class="sxs-lookup"><span data-stu-id="59c65-165">For more information about using the HttpCfg.exe tool to set up a port with an X.509 certificate, see [How to: Configure a Port with an SSL Certificate](../../../../docs/framework/wcf/feature-details/how-to-configure-a-port-with-an-ssl-certificate.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="59c65-166">另請參閱</span><span class="sxs-lookup"><span data-stu-id="59c65-166">See Also</span></span>  
 [<span data-ttu-id="59c65-167">傳輸安全性</span><span class="sxs-lookup"><span data-stu-id="59c65-167">Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/transport-security.md)  
 [<span data-ttu-id="59c65-168">訊息安全性</span><span class="sxs-lookup"><span data-stu-id="59c65-168">Message Security</span></span>](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)
