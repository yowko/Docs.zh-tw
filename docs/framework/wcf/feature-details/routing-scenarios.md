---
title: 路由案例
ms.date: 03/30/2017
helpviewer_keywords:
- routing [WCF], scenarios
ms.assetid: ec22f308-665a-413e-9f94-7267cb665dab
ms.openlocfilehash: 334e9fe7ca6931f87c75023f3322638b36001b6a
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/22/2019
ms.locfileid: "69923059"
---
# <a name="routing-scenarios"></a><span data-ttu-id="306e7-102">路由案例</span><span class="sxs-lookup"><span data-stu-id="306e7-102">Routing Scenarios</span></span>
<span data-ttu-id="306e7-103">若路由服務的自訂性相當高，在從頭建立新組態時設計足夠的路由邏輯可能會相當困難。</span><span class="sxs-lookup"><span data-stu-id="306e7-103">While the Routing Service is highly customizable, it can be a challenge to design efficient routing logic when creating a new configuration from scratch.</span></span>  <span data-ttu-id="306e7-104">不過，大多數路由服務組態會遵循數種常見案例。</span><span class="sxs-lookup"><span data-stu-id="306e7-104">However, there are several common scenarios that most Routing Service configurations follow.</span></span> <span data-ttu-id="306e7-105">雖然這些案例可能無法直接套用於特定的組態，但若了解如何設定路由服務處理這些案例，就能協助您了解路由服務。</span><span class="sxs-lookup"><span data-stu-id="306e7-105">While these scenarios may not apply directly to your specific configuration, understanding how the Routing Service can be configured to handle these scenarios will aid you in understanding the Routing Service.</span></span>  
  
## <a name="common-scenarios"></a><span data-ttu-id="306e7-106">常見案例</span><span class="sxs-lookup"><span data-stu-id="306e7-106">Common Scenarios</span></span>  
 <span data-ttu-id="306e7-107">路由服務最基本的用法是彙總多個目的地端點，以減少對用戶端應用程式公開的端點數目，然後使用訊息篩選條件，將每個訊息路由至正確的目的地。</span><span class="sxs-lookup"><span data-stu-id="306e7-107">The most basic use of the Routing Service is to aggregate multiple destination endpoints to reduce the number of endpoints exposed to the client applications, and then use message filters to route each message to the correct destination.</span></span> <span data-ttu-id="306e7-108">訊息可以根據邏輯或實體處理需求進行路由 (例如必須由特定服務處理的訊息類型)，也可以根據任何商務需求進行路由 (例如優先處理來自特定來源的訊息)。</span><span class="sxs-lookup"><span data-stu-id="306e7-108">Messages may be routed based on logical or physical processing requirements, such as a message type that must be processed by a specific service, or based on arbitrary business needs such as providing priority processing of messages from a specific source.</span></span> <span data-ttu-id="306e7-109">下表列出一些常見的案例，以及發生這些案例的時機。</span><span class="sxs-lookup"><span data-stu-id="306e7-109">The following table lists some of the common scenarios and when they are encountered:</span></span>  
  
|<span data-ttu-id="306e7-110">狀況</span><span class="sxs-lookup"><span data-stu-id="306e7-110">Scenario</span></span>|<span data-ttu-id="306e7-111">使用時機</span><span class="sxs-lookup"><span data-stu-id="306e7-111">Use when</span></span>|  
|--------------|--------------|  
|<span data-ttu-id="306e7-112">服務版本控制</span><span class="sxs-lookup"><span data-stu-id="306e7-112">Service versioning</span></span>|<span data-ttu-id="306e7-113">您需要支援服務的多種版本，或者未來可能會需要部署更新服務</span><span class="sxs-lookup"><span data-stu-id="306e7-113">You need to support multiple versions of a service or may deploy an updated service in the future</span></span>|  
|<span data-ttu-id="306e7-114">服務資料分割</span><span class="sxs-lookup"><span data-stu-id="306e7-114">Service data partitioning</span></span>|<span data-ttu-id="306e7-115">您必須跨多個主機分割服務</span><span class="sxs-lookup"><span data-stu-id="306e7-115">You must partition a service across multiple hosts</span></span>|  
|<span data-ttu-id="306e7-116">動態更新</span><span class="sxs-lookup"><span data-stu-id="306e7-116">Dynamic update</span></span>|<span data-ttu-id="306e7-117">您必須在執行階段動態重新設定路由邏輯，以處理多變的服務部署</span><span class="sxs-lookup"><span data-stu-id="306e7-117">You must dynamically reconfigure routing logic at runtime to handle changing service deployments</span></span>|  
|<span data-ttu-id="306e7-118">多點傳送</span><span class="sxs-lookup"><span data-stu-id="306e7-118">Multicast</span></span>|<span data-ttu-id="306e7-119">您必須將一則訊息傳送至多個端點</span><span class="sxs-lookup"><span data-stu-id="306e7-119">You must send one message to multiple endpoints</span></span>|  
|<span data-ttu-id="306e7-120">通訊協定橋接</span><span class="sxs-lookup"><span data-stu-id="306e7-120">Protocol bridging</span></span>|<span data-ttu-id="306e7-121">您透過傳輸通訊協定接收訊息，而目的地端點使用不同的通訊協定</span><span class="sxs-lookup"><span data-stu-id="306e7-121">You receive messages over one transport protocol, and the destination endpoint uses a different protocol</span></span>|  
|<span data-ttu-id="306e7-122">錯誤處理</span><span class="sxs-lookup"><span data-stu-id="306e7-122">Error Handling</span></span>|<span data-ttu-id="306e7-123">您需要提供恢復網路中斷與通訊失敗的能力</span><span class="sxs-lookup"><span data-stu-id="306e7-123">You need to provide resilience to network outages and communication failures</span></span>|  
  
> [!NOTE]
> <span data-ttu-id="306e7-124">以上許多案例適用於特定商務需求或處理條件，但規劃支援動態更新及利用錯誤處理往往會是最佳做法，因為這麼做可以讓您在執行階段修改路由邏輯，並且從暫時性的網路及通訊錯誤復原。</span><span class="sxs-lookup"><span data-stu-id="306e7-124">While many of the scenarios presented are specific to certain business needs or processing requirements, planning to support dynamic updates and utilizing error handling can often be considered as best practices as they allow you to modify routing logic at runtime and recover from transient network and communication failures.</span></span>  
  
### <a name="service-versioning"></a><span data-ttu-id="306e7-125">服務版本控制</span><span class="sxs-lookup"><span data-stu-id="306e7-125">Service Versioning</span></span>  
 <span data-ttu-id="306e7-126">導入新版本的服務時，您往往必須維護舊版本，直到用戶端轉換至新服務為止。</span><span class="sxs-lookup"><span data-stu-id="306e7-126">When introducing a new version of a service, you must often maintain the previous version until all clients have transitioned to the new service.</span></span> <span data-ttu-id="306e7-127">如果服務是需要數天、數星期、甚或數個月才能完成的長期執行處理序，這一點更是重要。</span><span class="sxs-lookup"><span data-stu-id="306e7-127">This is especially critical if the service is a long-running process that takes days, weeks, or even months to complete.</span></span> <span data-ttu-id="306e7-128">此時往往需要為新服務實作新的端點位址，同時又要保留原本用於舊版的端點。</span><span class="sxs-lookup"><span data-stu-id="306e7-128">Usually this requires implementing a new endpoint address for the new service while maintaining the original endpoint for the previous version.</span></span>  
  
 <span data-ttu-id="306e7-129">透過使用路由服務，您可以公開一個端點以接收來自用戶端應用程式的訊息，然後再根據訊息的內容，將每個訊息路由到正確的服務版本。</span><span class="sxs-lookup"><span data-stu-id="306e7-129">By using the Routing Service, you can expose one endpoint to receive messages from client applications and then route each message to the correct service version based on the message content.</span></span> <span data-ttu-id="306e7-130">最基本的實作包括在訊息中加入自訂標頭，指出用於處理訊息的服務版本。</span><span class="sxs-lookup"><span data-stu-id="306e7-130">The most basic implementation involves adding a custom header to the message that indicates the version of the service that the message is to be processed by.</span></span> <span data-ttu-id="306e7-131">路由服務可以利用 XPathMessageFilter 檢查訊息中是否具有自訂標頭，並且將訊息路由至適當的目的地端點。</span><span class="sxs-lookup"><span data-stu-id="306e7-131">The Routing Service can use the XPathMessageFilter to inspect each message for the presence of the custom header and route the message to the appropriate destination endpoint.</span></span>  
  
 <span data-ttu-id="306e7-132">如需用來建立服務版本設定設定的步驟, [請參閱如何:服務版本](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)設定。</span><span class="sxs-lookup"><span data-stu-id="306e7-132">For the steps used to create a service versioning configuration, see [How To: Service Versioning](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md).</span></span>
  
### <a name="service-data-partitioning"></a><span data-ttu-id="306e7-133">服務資料分割</span><span class="sxs-lookup"><span data-stu-id="306e7-133">Service Data Partitioning</span></span>  
 <span data-ttu-id="306e7-134">設計分散式環境時，通常最好能夠跨多個電腦散播處理負載，以便提供高可用性、減少個別電腦的處理負載，或是針對特定的訊息子集提供專用資源。</span><span class="sxs-lookup"><span data-stu-id="306e7-134">When designing a distributed environment, it is often desirable to spread processing load across multiple computers in order to provide high availability, decrease processing load on individual computers, or to provide dedicated resources for a specific subset of messages.</span></span> <span data-ttu-id="306e7-135">雖然路由服務無法取代專用負載平衡解決方案，但它具備根據內容執行路由的能力，因此可用於將類似的訊息路由至特定的目的地。</span><span class="sxs-lookup"><span data-stu-id="306e7-135">While the Routing Service does not replace a dedicated load balancing solution, its ability to perform content based routing can be used to route otherwise similar messages to specific destinations.</span></span> <span data-ttu-id="306e7-136">例如，您可能必須將來自特定用戶端的訊息與來自其他用戶端的訊息分開處理。</span><span class="sxs-lookup"><span data-stu-id="306e7-136">For example, you may have a requirement to process messages from a specific client separately from messages received from other clients.</span></span>  
  
 <span data-ttu-id="306e7-137">如需用來建立服務資料分割設定的步驟, 請[參閱如何:服務資料分割](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)。</span><span class="sxs-lookup"><span data-stu-id="306e7-137">For the steps used to create a service data partitioning configuration, see [How To: Service Data Partitioning](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md).</span></span>  
  
### <a name="dynamic-routing"></a><span data-ttu-id="306e7-138">動態路由</span><span class="sxs-lookup"><span data-stu-id="306e7-138">Dynamic Routing</span></span>  
 <span data-ttu-id="306e7-139">通常最好可以根據多變的商務需求修改路由組態，例如將路由加入至較新版的服務、變更路由準則，或者是變更篩選條件路由特定訊息的目的地端點。</span><span class="sxs-lookup"><span data-stu-id="306e7-139">Often it is desirable to modify the routing configuration to satisfy changing business needs, such as adding a route to a newer version of a service, changing routing criteria, or changing the destination endpoint a specific message that the filter routes to.</span></span> <span data-ttu-id="306e7-140">路由服務可透過 <xref:System.ServiceModel.Routing.RoutingExtension>，讓您在執行階段提供新的 RoutingConfiguration，以達到這個目的。</span><span class="sxs-lookup"><span data-stu-id="306e7-140">The Routing Service allows you to do this through the <xref:System.ServiceModel.Routing.RoutingExtension>, which allows you to provide a new RoutingConfiguration during run time.</span></span> <span data-ttu-id="306e7-141">新的組態會立即生效，但只會影響路由服務所處理的所有新工作階段。</span><span class="sxs-lookup"><span data-stu-id="306e7-141">The new configuration takes effect immediately, but only affects any new sessions processed by the Routing Service.</span></span>  
  
 <span data-ttu-id="306e7-142">如需用來執行動態路由的步驟, [請參閱如何:動態更新](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)。</span><span class="sxs-lookup"><span data-stu-id="306e7-142">For the steps used to implement dynamic routing, see [How To: Dynamic Update](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md).</span></span>
  
### <a name="multicast"></a><span data-ttu-id="306e7-143">多點傳送</span><span class="sxs-lookup"><span data-stu-id="306e7-143">Multicast</span></span>  
 <span data-ttu-id="306e7-144">路由訊息時，您通常會將每個訊息路由至一個特定的目的地端點。</span><span class="sxs-lookup"><span data-stu-id="306e7-144">When routing messages, usually you routing each message to one specific destination endpoint.</span></span>  <span data-ttu-id="306e7-145">不過，您偶爾可能需要將訊息複本路由至多個目的地端點。</span><span class="sxs-lookup"><span data-stu-id="306e7-145">However, you may occasionally need to route a copy of the message to multiple destination endpoints.</span></span> <span data-ttu-id="306e7-146">若要執行多點傳送路由，必須滿足下列條件：</span><span class="sxs-lookup"><span data-stu-id="306e7-146">To perform multicast routing, the following conditions must be true:</span></span>  
  
- <span data-ttu-id="306e7-147">通道類型不得為要求-回覆 (但可以是單向或雙向)，因為查詢-回覆會命令回應要求的用戶端應用程式只接收一個回覆。</span><span class="sxs-lookup"><span data-stu-id="306e7-147">The channel shape must not be request-reply (though it may be one-way or duplex,) because request-reply mandates that only one reply can be received by the client application in response to the request.</span></span>  
  
- <span data-ttu-id="306e7-148">評估訊息時, 多個篩選準則必須傳回**true** 。</span><span class="sxs-lookup"><span data-stu-id="306e7-148">Multiple filters must return **true** when evaluating the message.</span></span>  
  
 <span data-ttu-id="306e7-149">如果符合這些條件，每個與傳回 true 的篩選條件相關的端點都會收到一份訊息複本。</span><span class="sxs-lookup"><span data-stu-id="306e7-149">If these conditions are met, each destination endpoint that is associated with a filter that returns true will receive a copy of the message.</span></span>  
  
### <a name="protocol-bridging"></a><span data-ttu-id="306e7-150">通訊協定橋接</span><span class="sxs-lookup"><span data-stu-id="306e7-150">Protocol Bridging</span></span>  
 <span data-ttu-id="306e7-151">在不同的 SOAP 通訊協定之間路由訊息時，路由服務會利用 WCF API 來轉換在通訊協定之間傳遞的訊息。</span><span class="sxs-lookup"><span data-stu-id="306e7-151">When routing messages between dissimilar SOAP protocols, the Routing Service uses WCF APIs to convert the message from one protocol to the other.</span></span> <span data-ttu-id="306e7-152">當路由服務所公開的服務端點使用與用戶端端點 (訊息傳送的位置) 不同的通訊協定時，此情形便會自動發生。</span><span class="sxs-lookup"><span data-stu-id="306e7-152">This occurs automatically when the service endpoint(s) exposed by the Routing Service use a different protocol than the client endpoint(s) that messages are routed to.</span></span> <span data-ttu-id="306e7-153">如果使用中的通訊協定不是標準通訊協定，就可以停用這個行為。不過，停用此行為後，您必須自行提供橋接程式碼。</span><span class="sxs-lookup"><span data-stu-id="306e7-153">It is possible to disable this behavior if the protocols in use are not standard; however, you must then provide your own bridging code.</span></span>
  
### <a name="error-handling"></a><span data-ttu-id="306e7-154">錯誤處理</span><span class="sxs-lookup"><span data-stu-id="306e7-154">Error Handling</span></span>  
 <span data-ttu-id="306e7-155">在分散式環境中，經常會發生暫時性的網路或通訊錯誤。</span><span class="sxs-lookup"><span data-stu-id="306e7-155">In a distributed environment, it is not uncommon to encounter transient network or communication failures.</span></span> <span data-ttu-id="306e7-156">若未使用路由服務之類的媒介服務，就必須由用戶端應用程式負責處理此類錯誤。</span><span class="sxs-lookup"><span data-stu-id="306e7-156">Without an intermediary service such as the Routing Service, the burden of handling such failures falls on the client application.</span></span> <span data-ttu-id="306e7-157">如果用戶端應用程式不包含在網路或通訊失敗時重試的特定邏輯，也不具替代位置的知識，使用者可能會發生必須重新送出訊息多次，目的地服務才能順利處理該訊息的情形。</span><span class="sxs-lookup"><span data-stu-id="306e7-157">If the client application does not include specific logic to retry in the event of network or communication failures and knowledge of alternate locations, the user may encounter scenarios where a message must be submitted multiple times before it is successfully processed by the destination service.</span></span> <span data-ttu-id="306e7-158">這種情形會讓客戶認為應用程式不可靠，進而感到不滿意。</span><span class="sxs-lookup"><span data-stu-id="306e7-158">This can lead to customer dissatisfaction with the application, as it may be perceived as unreliable.</span></span>  
  
 <span data-ttu-id="306e7-159">路由服務會嘗試針對發生網路或通訊相關失敗的訊息提供強大的錯誤處理功能，以嘗試補救這種情形。</span><span class="sxs-lookup"><span data-stu-id="306e7-159">The Routing Service attempts to remedy this scenario by providing robust error handling capabilities for messages that encounter network or communication-related failures.</span></span> <span data-ttu-id="306e7-160">透過建立可能的目的地端點清單，並且將這份清單與每個訊息篩選條件產生關聯，您就可以排除因為只有一個可能的目的地所導致的單點錯誤。</span><span class="sxs-lookup"><span data-stu-id="306e7-160">By creating a list of possible destination endpoints and associating this list with each message filter, you remove the single point of failure incurred by having only one possible destination.</span></span> <span data-ttu-id="306e7-161">一旦出現錯誤，路由服務會嘗試將訊息傳遞至清單中的下一個端點，直到順利傳遞訊息、發生非通訊錯誤，或者所有端點皆已用盡為止。</span><span class="sxs-lookup"><span data-stu-id="306e7-161">In the event of a failure, the Routing Service will attempt to deliver the message to the next endpoint in the list until the message has been delivered, a non-communication failure occurs, or all endpoints have been exhausted.</span></span>  
  
 <span data-ttu-id="306e7-162">如需用來設定錯誤處理的步驟, [請參閱如何:錯誤處理](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="306e7-162">For the steps used to configure error handling, see [How To: Error Handling](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md).</span></span>
  
### <a name="in-this-section"></a><span data-ttu-id="306e7-163">本節內容</span><span class="sxs-lookup"><span data-stu-id="306e7-163">In This Section</span></span>  
 [<span data-ttu-id="306e7-164">如何：服務版本控制</span><span class="sxs-lookup"><span data-stu-id="306e7-164">How To: Service Versioning</span></span>](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)  
  
 [<span data-ttu-id="306e7-165">如何：服務資料分割</span><span class="sxs-lookup"><span data-stu-id="306e7-165">How To: Service Data Partitioning</span></span>](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)  
  
 [<span data-ttu-id="306e7-166">如何：動態更新</span><span class="sxs-lookup"><span data-stu-id="306e7-166">How To: Dynamic Update</span></span>](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)  
  
 [<span data-ttu-id="306e7-167">如何：錯誤處理</span><span class="sxs-lookup"><span data-stu-id="306e7-167">How To: Error Handling</span></span>](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)  
  
## <a name="see-also"></a><span data-ttu-id="306e7-168">另請參閱</span><span class="sxs-lookup"><span data-stu-id="306e7-168">See also</span></span>

- [<span data-ttu-id="306e7-169">路由簡介</span><span class="sxs-lookup"><span data-stu-id="306e7-169">Routing Introduction</span></span>](../../../../docs/framework/wcf/feature-details/routing-introduction.md)
