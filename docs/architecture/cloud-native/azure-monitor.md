---
title: Azure 監視器
description: 使用 Azure 監視器來取得系統的可見度。
ms.date: 09/23/2019
ms.openlocfilehash: 89c27ffc3ba13194baf7b05e75920bf33dc6c5f3
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/23/2019
ms.locfileid: "71183571"
---
# <a name="azure-monitor"></a><span data-ttu-id="8cbc0-103">Azure 監視器</span><span class="sxs-lookup"><span data-stu-id="8cbc0-103">Azure Monitor</span></span> 

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="8cbc0-104">沒有其他雲端提供者的雲端應用程式監視解決方案成熟，如同在 Azure 中找到的一樣。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-104">No other cloud provider has as mature of a cloud application monitoring solution as that found in Azure.</span></span> <span data-ttu-id="8cbc0-105">Azure 監視器是一組工具集合的資訊，其設計目的是要提供系統狀態的可見度，並深入瞭解您的應用程式的任何問題與優化。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-105">Azure Monitor is an umbrella name for a collection of tools designed to provide visibility into the state of your system, insights into any problems and optimization of your application.</span></span> 

<span data-ttu-id="8cbc0-106">![Azure 監視器，這是工具的集合，可讓您深入瞭解雲端原生應用程式的運作方式。**圖 7-9**。 ](./media/azure-monitor.png)
</span><span class="sxs-lookup"><span data-stu-id="8cbc0-106">![Azure Monitor, a collection to tools to provide insight into how a cloud-native application is functioning.](./media/azure-monitor.png)
**Figure 7-9**.</span></span> <span data-ttu-id="8cbc0-107">Azure 監視器，這是工具的集合，可讓您深入瞭解雲端原生應用程式的運作方式。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-107">Azure Monitor, a collection to tools to provide insight into how a cloud-native application is functioning.</span></span>

## <a name="gathering-logs-and-metrics"></a><span data-ttu-id="8cbc0-108">收集記錄和計量</span><span class="sxs-lookup"><span data-stu-id="8cbc0-108">Gathering logs and metrics</span></span>

<span data-ttu-id="8cbc0-109">任何監視解決方案中的第一個步驟，是盡可能收集最多的資料。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-109">The first step in any monitoring solution is to gather as much data as possible.</span></span> <span data-ttu-id="8cbc0-110">可以收集的資料愈多，可取得的深入解析就愈深入。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-110">The more data that can be gathered, the deeper the insights that can be obtained.</span></span> <span data-ttu-id="8cbc0-111">在傳統上，檢測系統並不容易。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-111">Instrumenting systems has traditionally been difficult.</span></span> <span data-ttu-id="8cbc0-112">簡易網路管理通訊協定（SNMP）是用來收集機器層級資訊的黃金標準通訊協定，但它需要大量的知識和設定。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-112">Simple Network Management Protocol (SNMP) was the gold standard protocol for collecting machine level information but it required a great deal of knowledge and configuring.</span></span> <span data-ttu-id="8cbc0-113">幸好，大部分的這項困難的工作都已消除，因為最常見的計量會由 Azure 監視器自動收集。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-113">Fortunately, much of this hard work has been eliminated as the most common metrics are gathered automatically by Azure Monitor.</span></span>

<span data-ttu-id="8cbc0-114">應用層級計量和事件無法自動檢測，因為它們是在要部署之應用程式的本機。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-114">Application level metrics and events aren't possible to instrument automatically because they're local to the application being deployed.</span></span> <span data-ttu-id="8cbc0-115">為了收集這些計量，有可用來直接報告這類資訊的[sdk 和 api](https://docs.microsoft.com/azure/azure-monitor/app/api-custom-events-metrics) ，例如當客戶註冊或完成訂單時。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-115">In order to gather these metrics, there are [SDKs and APIs available](https://docs.microsoft.com/azure/azure-monitor/app/api-custom-events-metrics) to directly report such information, such as when a customer signs up or completes an order.</span></span> <span data-ttu-id="8cbc0-116">例外狀況也可以透過 Application Insights 加以捕捉並回報給 Azure 監視器。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-116">Exceptions can also be captured and reported back into Azure Monitor via Application Insights.</span></span> <span data-ttu-id="8cbc0-117">Sdk 支援最多在雲端原生應用程式（包括 Go、Python、JavaScript 和 .NET 語言）中找到的所有語言。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-117">The SDKs support most every language found in Cloud Native Applications including Go, Python, JavaScript, and the .NET languages.</span></span>

<span data-ttu-id="8cbc0-118">收集應用程式狀態相關資訊的最終目標，是要確保您的終端使用者擁有良好的體驗。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-118">The ultimate goal of gathering information about the state of your application is to ensure that your end users have a good experience.</span></span> <span data-ttu-id="8cbc0-119">判斷使用者是否遇到問題的更好方法，比[在外部 web 測試中](https://docs.microsoft.com/azure/azure-monitor/app/monitor-web-app-availability)執行？</span><span class="sxs-lookup"><span data-stu-id="8cbc0-119">What better way to tell if users are experiencing issues than doing [outside-in web tests](https://docs.microsoft.com/azure/azure-monitor/app/monitor-web-app-availability)?</span></span> <span data-ttu-id="8cbc0-120">這些測試可以像是從世界各地 ping 網站，或讓代理程式登入網站並執行動作一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-120">These tests can be as simple as pinging your website from locations around the world or as involved as having agents log into the site and do actions.</span></span>

## <a name="reporting-data"></a><span data-ttu-id="8cbc0-121">報告資料</span><span class="sxs-lookup"><span data-stu-id="8cbc0-121">Reporting data</span></span>

<span data-ttu-id="8cbc0-122">收集資料之後，就可以操作、摘要，並將其繪製成圖表，讓使用者可以在發生問題時立即查看。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-122">Once the data is gathered, it can be manipulated, summarized, and plotted into charts, which allow users to instantly see when there are problems.</span></span> <span data-ttu-id="8cbc0-123">這些圖表可以收集到儀表板或活頁簿中，這是一種多頁報表，設計用來告訴有關系統某些層面的故事。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-123">These charts can be gathered into dashboards or into Workbooks, a multi-page report designed to tell a story about some aspect of the system.</span></span>

<span data-ttu-id="8cbc0-124">不需要某些人工智慧或機器學習，即可完成現代化應用程式。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-124">No modern application would be complete without some artificial intelligence or machine learning.</span></span> <span data-ttu-id="8cbc0-125">為此，您[可以將資料傳遞](https://www.youtube.com/watch?v=Cuza-I1g9tw)至 Azure 中的各種機器學習工具，讓您可以將其他隱藏的趨勢和資訊解壓縮。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-125">To this end, data [can be passed](https://www.youtube.com/watch?v=Cuza-I1g9tw) to the various machine learning tools in Azure to allow you to extract trends and information that would otherwise be hidden.</span></span>

<span data-ttu-id="8cbc0-126">Application Insights 提供一種強大的查詢語言，稱為 Kusto，可用來尋找記錄、匯總它們，甚至繪製圖表。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-126">Application Insights provides a powerful query language called Kusto that can be used to find records, summarize them, and even plot charts.</span></span> <span data-ttu-id="8cbc0-127">例如，此查詢會找出2007年11月的所有記錄、依州/省分組，然後將前10個圖繪製為圓形圖。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-127">For instance, this query will locate all the records for the month of November 2007, group them by state, and plot the top 10 as a pie chart.</span></span>

```
StormEvents 
| where StartTime >= datetime(2007-11-01) and StartTime < datetime(2007-12-01)
| summarize count() by State
| top 10 by count_
| render piechart 
```

<span data-ttu-id="8cbc0-128">![Application Insights 查詢](./media/azure-monitor.png)
的結果**圖 7-10**。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-128">![The result of the Application Insights Query](./media/azure-monitor.png)
**Figure 7-10**.</span></span> <span data-ttu-id="8cbc0-129">Application Insights 查詢的結果。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-129">The result of the Application Insights Query.</span></span>

<span data-ttu-id="8cbc0-130">有一個[遊樂場可用於實驗 Kusto](https://dataexplorer.azure.com/clusters/help/databases/Samples)查詢，這是一個很棒的地方來花上一小時或兩個。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-130">There is a [playground for experimenting with Kusto](https://dataexplorer.azure.com/clusters/help/databases/Samples) queries, which is a fantastic place to spend an hour or two.</span></span> <span data-ttu-id="8cbc0-131">閱讀[範例查詢](https://docs.microsoft.com/azure/kusto/query/samples)也會有意義。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-131">Reading [sample queries](https://docs.microsoft.com/azure/kusto/query/samples) can also be instructive.</span></span>

## <a name="dashboards"></a><span data-ttu-id="8cbc0-132">儀表板</span><span class="sxs-lookup"><span data-stu-id="8cbc0-132">Dashboards</span></span>

<span data-ttu-id="8cbc0-133">有數種不同的儀表板技術可用來呈現 Azure 監視器的資訊。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-133">There are several different dashboard technologies that may be used to surface the information from Azure Monitor.</span></span> <span data-ttu-id="8cbc0-134">最簡單的方式，就是只在 Application Insights 中執行查詢，並將[資料繪製到圖表](https://docs.microsoft.com/azure/azure-monitor/learn/tutorial-app-dashboards)中。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-134">Perhaps the simplest is to just run queries in Application Insights and [plot the data into a chart](https://docs.microsoft.com/azure/azure-monitor/learn/tutorial-app-dashboards).</span></span> 

<span data-ttu-id="8cbc0-135">![內嵌在主要 Azure 儀表板](./media/azure-monitor.png)
**圖 7-11**中 Application Insights 圖表的範例。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-135">![An example of Application Insights charts embedded in the main Azure Dashboard](./media/azure-monitor.png)
**Figure 7-11**.</span></span> <span data-ttu-id="8cbc0-136">內嵌在主要 Azure 儀表板中 Application Insights 圖表的範例。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-136">An example of Application Insights charts embedded in the main Azure Dashboard.</span></span>

<span data-ttu-id="8cbc0-137">然後您可以使用儀表板功能，將這些圖表內嵌在 Azure 入口網站中。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-137">These charts can then be embedded in the Azure portal proper through use of the dashboard feature.</span></span> <span data-ttu-id="8cbc0-138">對於具有更嚴格需求的使用者，例如能夠向下切入到數個資料層 Azure 監視器資料可供[Power BI](https://powerbi.microsoft.com/)。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-138">For users with more exacting requirements such as being able to drill down into several tiers of data Azure Monitor data is available to [Power BI](https://powerbi.microsoft.com/).</span></span> <span data-ttu-id="8cbc0-139">Power BI 是業界領先的企業級商業智慧工具，可以從許多不同的資料來源匯總資料。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-139">Power BI is an industry-leading, enterprise class, business intelligence tool that can aggregate data from many different data sources.</span></span>

<span data-ttu-id="8cbc0-140">![Power BI 儀表板](./media/azure-monitor.png)
**圖 7-12**的範例。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-140">![An example Power BI dashboard](./media/azure-monitor.png)
**Figure 7-12**.</span></span> <span data-ttu-id="8cbc0-141">Power BI 儀表板範例。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-141">An example Power BI dashboard.</span></span>

## <a name="alerts"></a><span data-ttu-id="8cbc0-142">警示</span><span class="sxs-lookup"><span data-stu-id="8cbc0-142">Alerts</span></span>

<span data-ttu-id="8cbc0-143">有時候，擁有資料儀表板的空間不足。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-143">Sometimes, having data dashboards is insufficient.</span></span> <span data-ttu-id="8cbc0-144">如果沒有人進行喚醒來監看儀表板，則在問題解決或甚至偵測到之前，仍然可能需要數小時的時間。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-144">If nobody is awake to watch the dashboards, then it can still be many hours before a problem is addressed, or even detected.</span></span> <span data-ttu-id="8cbc0-145">為此，Azure 監視器也會提供最高的槽口[警示解決方案](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview)。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-145">To this end, Azure Monitor also provides a top notch [alerting solution](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview).</span></span> <span data-ttu-id="8cbc0-146">警示可由各種不同的條件觸發，包括：</span><span class="sxs-lookup"><span data-stu-id="8cbc0-146">Alerts can be triggered by a wide range of conditions including:</span></span>

* <span data-ttu-id="8cbc0-147">度量值</span><span class="sxs-lookup"><span data-stu-id="8cbc0-147">Metric values</span></span>
* <span data-ttu-id="8cbc0-148">記錄搜尋查詢</span><span class="sxs-lookup"><span data-stu-id="8cbc0-148">Log search queries</span></span>
* <span data-ttu-id="8cbc0-149">活動記錄事件</span><span class="sxs-lookup"><span data-stu-id="8cbc0-149">Activity Log events</span></span>
* <span data-ttu-id="8cbc0-150">基礎 Azure 平臺的健全狀況</span><span class="sxs-lookup"><span data-stu-id="8cbc0-150">Health of the underlying Azure platform</span></span>
* <span data-ttu-id="8cbc0-151">網站可用性的測試</span><span class="sxs-lookup"><span data-stu-id="8cbc0-151">Tests for web site availability</span></span>

<span data-ttu-id="8cbc0-152">觸發時，警示可以執行各種不同的工作。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-152">When triggered, the alerts can perform a wide variety of tasks.</span></span> <span data-ttu-id="8cbc0-153">在簡單的情況下，警示可能只會傳送電子郵件通知給郵寄清單或文字訊息給個人。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-153">On the simple side, the alerts may just send an e-mail notification to a mailing list or a text message to an individual.</span></span> <span data-ttu-id="8cbc0-154">更多相關警示可能會在 PagerDuty 之類的工具中觸發工作流程，這知道誰正在呼叫特定應用程式。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-154">More involved alerts might trigger a workflow in a tool such as PagerDuty, which is aware of who is on call for a particular application.</span></span> <span data-ttu-id="8cbc0-155">警示可以在[Microsoft Flow](https://flow.microsoft.com/)解除鎖定工作流程幾乎無限制的可能性中觸發動作。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-155">Alerts can trigger actions in [Microsoft Flow](https://flow.microsoft.com/) unlocking near limitless possibilities for workflows.</span></span>

<span data-ttu-id="8cbc0-156">當識別出常見的警示原因時，可以利用警示的常見原因和解決這些警示的步驟，來增強警示。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-156">As common causes of alerts are identified, the alerts can be enhanced with details about the common causes of the alerts and the steps to take to resolve them.</span></span> <span data-ttu-id="8cbc0-157">成熟的雲端原生應用程式部署可能會選擇啟動自我修復工作，這些工作會執行一些動作，例如從擴展集移除失敗的節點或觸發自動調整活動。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-157">Highly mature Cloud Native Application deployments may opt to kick off self-healing tasks, which perform actions such as removing failing nodes from a scale set or triggering an autoscaling activity.</span></span> <span data-ttu-id="8cbc0-158">最後，您可能不再需要在12AM-2AM 喚醒待命人員以解決即時網站問題，因為系統能夠自行調整以補償或至少 limp，直到有人在下一個早上抵達工作為止。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-158">Eventually it may no longer be necessary to wake up on-call personnel at 2AM to resolve a live-site issue as the system will be able to adjust itself to compensate or at least limp along until somebody arrives at work the next morning.</span></span> 

<span data-ttu-id="8cbc0-159">Azure 監視器會自動利用機器學習服務來瞭解已部署應用程式的一般指令引數。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-159">Azure Monitor automatically leverages machine learning to understand the normal operating parameters of deployed applications.</span></span> <span data-ttu-id="8cbc0-160">這可讓它偵測在其一般參數之外運作的服務。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-160">This enables it to detect services that are operating outside of their normal parameters.</span></span> <span data-ttu-id="8cbc0-161">例如，網站上的一般工作日流量可能是每分鐘10000個要求。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-161">For instance, the typical weekday traffic on the site might be 10,000 requests per minute.</span></span> <span data-ttu-id="8cbc0-162">然後，在指定的一周，突然要求數達到每分鐘非常不尋常的20000要求。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-162">And then, on a given week, suddenly the number of requests hits a highly unusual 20,000 requests per minute.</span></span> <span data-ttu-id="8cbc0-163">[智慧型偵測](https://docs.microsoft.com/azure/azure-monitor/app/proactive-diagnostics)會注意到此偏差與標準，並觸發警示。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-163">[Smart Detection](https://docs.microsoft.com/azure/azure-monitor/app/proactive-diagnostics) will notice this deviation from the norm and trigger an alert.</span></span> <span data-ttu-id="8cbc0-164">同時，趨勢分析的智慧足以避免在預期流量負載時引發誤報。</span><span class="sxs-lookup"><span data-stu-id="8cbc0-164">At the same time, the trend analysis is smart enough to avoid firing false positives when the traffic load is expected.</span></span>  

>[!div class="step-by-step"]
><span data-ttu-id="8cbc0-165">[上一頁](monitoring-azure-kubernetes.md)
>[下一頁](identity.md)</span><span class="sxs-lookup"><span data-stu-id="8cbc0-165">[Previous](monitoring-azure-kubernetes.md)
[Next](identity.md)</span></span> <!-- Next Chapter -->
