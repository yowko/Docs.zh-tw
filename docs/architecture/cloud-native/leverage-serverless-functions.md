---
title: 利用無伺服器函式
description: 利用雲端原生應用程式中的無伺服器和 Azure Functions
ms.date: 04/13/2020
ms.openlocfilehash: 176499e3cd0349cd689b9d13d1c237a6343d13f3
ms.sourcegitcommit: 5988e9a29cedb8757320817deda3c08c6f44a6aa
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/28/2020
ms.locfileid: "82199738"
---
# <a name="leveraging-serverless-functions"></a><span data-ttu-id="bcdef-103">利用無伺服器函式</span><span class="sxs-lookup"><span data-stu-id="bcdef-103">Leveraging serverless functions</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="bcdef-104">在管理實體機器以利用雲端功能的範圍中，無伺服器存在於極致端。</span><span class="sxs-lookup"><span data-stu-id="bcdef-104">In the spectrum from managing physical machines to leveraging cloud capabilities, serverless lives at the extreme end.</span></span> <span data-ttu-id="bcdef-105">您的程式碼是唯一的責任，而您只需支付程式碼的執行時間。</span><span class="sxs-lookup"><span data-stu-id="bcdef-105">Your only responsibility is your code, and you only pay when your code runs.</span></span> <span data-ttu-id="bcdef-106">Azure Functions 提供在雲端原生應用程式中建立無伺服器功能的方式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-106">Azure Functions provides a way to build serverless capabilities into your cloud-native applications.</span></span>

## <a name="what-is-serverless"></a><span data-ttu-id="bcdef-107">什麼是無伺服器？</span><span class="sxs-lookup"><span data-stu-id="bcdef-107">What is serverless?</span></span>

<span data-ttu-id="bcdef-108">無伺服器是雲端運算的相對新服務模型。</span><span class="sxs-lookup"><span data-stu-id="bcdef-108">Serverless is a relatively new service model of cloud computing.</span></span> <span data-ttu-id="bcdef-109">這並不表示伺服器是選擇性的，您的程式碼仍會在某個伺服器上執行。</span><span class="sxs-lookup"><span data-stu-id="bcdef-109">It doesn't mean that servers are optional - your code still runs on a server somewhere.</span></span> <span data-ttu-id="bcdef-110">差別在於應用程式小組不再關心管理伺服器基礎結構的問題。</span><span class="sxs-lookup"><span data-stu-id="bcdef-110">The distinction is that the application team no longer concerns itself with managing server infrastructure.</span></span> <span data-ttu-id="bcdef-111">取而代之的是，雲端廠商擁有此責任。</span><span class="sxs-lookup"><span data-stu-id="bcdef-111">Instead, the cloud vendor own this responsibility.</span></span> <span data-ttu-id="bcdef-112">開發小組供應商務解決方案給客戶，而不是配管，以提高生產力。</span><span class="sxs-lookup"><span data-stu-id="bcdef-112">The development team increases its productivity by delivering business solutions to customers, not plumbing.</span></span>

<span data-ttu-id="bcdef-113">無伺服器運算會使用事件觸發的無狀態容器來裝載您的服務。</span><span class="sxs-lookup"><span data-stu-id="bcdef-113">Serverless computing uses event-triggered stateless containers to host your services.</span></span> <span data-ttu-id="bcdef-114">他們可以視需要相應放大和縮小以符合需求。</span><span class="sxs-lookup"><span data-stu-id="bcdef-114">They can scale out and in to meet demand as-needed.</span></span> <span data-ttu-id="bcdef-115">無伺服器平臺（如 Azure Functions）與其他 Azure 服務（例如佇列、事件和儲存體）緊密整合。</span><span class="sxs-lookup"><span data-stu-id="bcdef-115">Serverless platforms like Azure Functions have tight integration with other Azure services like queues, events, and storage.</span></span>

## <a name="what-challenges-are-solved-by-serverless"></a><span data-ttu-id="bcdef-116">無伺服器可解決哪些挑戰？</span><span class="sxs-lookup"><span data-stu-id="bcdef-116">What challenges are solved by serverless?</span></span>

<span data-ttu-id="bcdef-117">無伺服器平臺會解決許多耗時且昂貴的問題：</span><span class="sxs-lookup"><span data-stu-id="bcdef-117">Serverless platforms address many time-consuming and expensive concerns:</span></span>

- <span data-ttu-id="bcdef-118">購買機器和軟體授權</span><span class="sxs-lookup"><span data-stu-id="bcdef-118">Purchasing machines and software licenses</span></span>
- <span data-ttu-id="bcdef-119">存放、保護、設定和維護電腦及其網路功能、電源和 A/C 需求</span><span class="sxs-lookup"><span data-stu-id="bcdef-119">Housing, securing, configuring, and maintaining the machines and their networking, power, and A/C requirements</span></span>
- <span data-ttu-id="bcdef-120">修補和升級作業系統與軟體</span><span class="sxs-lookup"><span data-stu-id="bcdef-120">Patching and upgrading operating systems and software</span></span>
- <span data-ttu-id="bcdef-121">設定網頁伺服器或機器服務來裝載應用程式軟體</span><span class="sxs-lookup"><span data-stu-id="bcdef-121">Configuring web servers or machine services to host application software</span></span>
- <span data-ttu-id="bcdef-122">在其平臺中設定應用程式軟體</span><span class="sxs-lookup"><span data-stu-id="bcdef-122">Configuring application software within its platform</span></span>

<span data-ttu-id="bcdef-123">許多公司會配置大型預算來支援硬體基礎結構的考慮。</span><span class="sxs-lookup"><span data-stu-id="bcdef-123">Many companies allocate large budgets to support hardware infrastructure concerns.</span></span> <span data-ttu-id="bcdef-124">移至雲端有助於降低這些成本;將應用程式轉移到無伺服器有助於排除它們。</span><span class="sxs-lookup"><span data-stu-id="bcdef-124">Moving to the cloud can help reduce these costs; shifting applications to serverless can help eliminate them.</span></span>

## <a name="what-is-the-difference-between-a-microservice-and-a-serverless-function"></a><span data-ttu-id="bcdef-125">微服務與無伺服器函式之間的差異為何？</span><span class="sxs-lookup"><span data-stu-id="bcdef-125">What is the difference between a microservice and a serverless function?</span></span>

<span data-ttu-id="bcdef-126">一般來說，微服務會封裝商務功能，例如線上電子商務網站的購物車。</span><span class="sxs-lookup"><span data-stu-id="bcdef-126">Typically, a microservice encapsulates a business capability, such as a shopping cart for an online eCommerce site.</span></span> <span data-ttu-id="bcdef-127">它會公開多個可讓使用者管理其購物體驗的作業。</span><span class="sxs-lookup"><span data-stu-id="bcdef-127">It exposes multiple operations that enable a user to manage their shopping experience.</span></span> <span data-ttu-id="bcdef-128">不過，函式是一個小型、輕量的程式碼區塊，會執行單一用途的作業來回應事件。</span><span class="sxs-lookup"><span data-stu-id="bcdef-128">A function, however, is a small, lightweight block of code that executes a single-purpose operation in response to an event.</span></span>
<span data-ttu-id="bcdef-129">微服務通常是用來回應要求，通常是來自介面。</span><span class="sxs-lookup"><span data-stu-id="bcdef-129">Microservices are typically constructed to respond to requests, often from an interface.</span></span> <span data-ttu-id="bcdef-130">要求可以是 HTTP Rest，或以 gRPC 為基礎。</span><span class="sxs-lookup"><span data-stu-id="bcdef-130">Requests can be HTTP Rest- or gRPC-based.</span></span> <span data-ttu-id="bcdef-131">無伺服器服務會回應事件。</span><span class="sxs-lookup"><span data-stu-id="bcdef-131">Serverless services respond to events.</span></span> <span data-ttu-id="bcdef-132">其事件驅動架構適合用來處理簡短執行的背景工作。</span><span class="sxs-lookup"><span data-stu-id="bcdef-132">Its event-driven architecture is ideal for processing short-running, background tasks.</span></span>

## <a name="what-scenarios-are-appropriate-for-serverless"></a><span data-ttu-id="bcdef-133">什麼是適用于無伺服器的案例？</span><span class="sxs-lookup"><span data-stu-id="bcdef-133">What scenarios are appropriate for serverless?</span></span>

<span data-ttu-id="bcdef-134">無伺服器會公開針對回應觸發程式而叫用的個別短期執行函數。</span><span class="sxs-lookup"><span data-stu-id="bcdef-134">Serverless exposes individual short-running functions that are invoked in response to a trigger.</span></span> <span data-ttu-id="bcdef-135">這讓它們適合用來處理背景工作。</span><span class="sxs-lookup"><span data-stu-id="bcdef-135">This makes them ideal for processing background tasks.</span></span>

<span data-ttu-id="bcdef-136">應用程式可能需要傳送電子郵件，做為工作流程中的步驟。</span><span class="sxs-lookup"><span data-stu-id="bcdef-136">An application might need to send an email as a step in a workflow.</span></span> <span data-ttu-id="bcdef-137">將訊息詳細資料放在佇列上，而不是在微服務要求中傳送通知。</span><span class="sxs-lookup"><span data-stu-id="bcdef-137">Instead of sending the notification as part of a microservice request, place the message details onto a queue.</span></span> <span data-ttu-id="bcdef-138">Azure 函數可以清除佇列訊息，並以非同步方式傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="bcdef-138">An Azure Function can dequeue the message and asynchronously send the email.</span></span> <span data-ttu-id="bcdef-139">這麼做可以改善微服務的效能和擴充性。</span><span class="sxs-lookup"><span data-stu-id="bcdef-139">Doing so could improve the performance and scalability of the microservice.</span></span> <span data-ttu-id="bcdef-140">以[佇列為基礎的負載調節](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling)可以執行，以避免與傳送電子郵件相關的瓶頸。</span><span class="sxs-lookup"><span data-stu-id="bcdef-140">[Queue-based load leveling](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling) can be implemented to avoid bottlenecks related to sending the emails.</span></span> <span data-ttu-id="bcdef-141">此外，您可以在許多不同的應用程式中重複使用此獨立服務作為公用程式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-141">Additionally, this stand-alone service could be reused as a utility across many different applications.</span></span>

<span data-ttu-id="bcdef-142">佇列和主題的非同步訊息是觸發無伺服器函式的常見模式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-142">Asynchronous messaging from queues and topics is a common pattern to trigger serverless functions.</span></span> <span data-ttu-id="bcdef-143">不過，Azure Functions 可以由其他事件觸發，例如 Azure Blob 儲存體的變更。</span><span class="sxs-lookup"><span data-stu-id="bcdef-143">However, Azure Functions can be triggered by other events, such as changes to Azure Blob Storage.</span></span> <span data-ttu-id="bcdef-144">支援影像上傳的服務可能會有負責優化影像大小的 Azure 函數。</span><span class="sxs-lookup"><span data-stu-id="bcdef-144">A service that supports image uploads could have an Azure Function responsible for optimizing the image size.</span></span> <span data-ttu-id="bcdef-145">函式可以透過插入 Azure Blob 儲存體直接觸發，讓微服務作業的複雜性變得更複雜。</span><span class="sxs-lookup"><span data-stu-id="bcdef-145">The function could be triggered directly by inserts into Azure Blob Storage, keeping complexity out of the microservice operations.</span></span>

<span data-ttu-id="bcdef-146">許多服務在其工作流程中都有長時間執行的進程。</span><span class="sxs-lookup"><span data-stu-id="bcdef-146">Many services have long-running processes as part of their workflows.</span></span> <span data-ttu-id="bcdef-147">這些工作通常會在使用者與應用程式互動的過程中完成。</span><span class="sxs-lookup"><span data-stu-id="bcdef-147">Often these tasks are done as part of the user's interaction with the application.</span></span> <span data-ttu-id="bcdef-148">這些工作可以強制使用者等待，對他們的體驗造成負面影響。</span><span class="sxs-lookup"><span data-stu-id="bcdef-148">These tasks can force the user to wait, negatively impacting their experience.</span></span> <span data-ttu-id="bcdef-149">無伺服器運算提供絕佳的方式，在使用者互動迴圈之外移動較慢的工作。</span><span class="sxs-lookup"><span data-stu-id="bcdef-149">Serverless computing provides a great way to move slower tasks outside of the user interaction loop.</span></span> <span data-ttu-id="bcdef-150">這些工作可以隨需求調整，而不需要調整整個應用程式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-150">These tasks can scale with demand without requiring the entire application to scale.</span></span>

## <a name="when-should-you-avoid-serverless"></a><span data-ttu-id="bcdef-151">何時應該避免無伺服器？</span><span class="sxs-lookup"><span data-stu-id="bcdef-151">When should you avoid serverless?</span></span>

<span data-ttu-id="bcdef-152">無伺服器解決方案會依需求布建和調整。</span><span class="sxs-lookup"><span data-stu-id="bcdef-152">Serverless solutions provision and scale on demand.</span></span> <span data-ttu-id="bcdef-153">叫用新的實例時，冷啟動是常見的問題。</span><span class="sxs-lookup"><span data-stu-id="bcdef-153">When a new instance is invoked, cold starts are a common issue.</span></span> <span data-ttu-id="bcdef-154">冷啟動是布建這個實例所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="bcdef-154">A cold start is the period of time it takes to provision this instance.</span></span> <span data-ttu-id="bcdef-155">一般來說，此延遲可能是幾秒鐘，但可能會因為各種因素而較長。</span><span class="sxs-lookup"><span data-stu-id="bcdef-155">Normally, this delay might be a few seconds, but can be longer depending on various factors.</span></span> <span data-ttu-id="bcdef-156">一旦布建之後，只要單一實例收到定期要求，就會保持運作狀態。</span><span class="sxs-lookup"><span data-stu-id="bcdef-156">Once provisioned, a single instance is kept alive as long as it receives periodic requests.</span></span> <span data-ttu-id="bcdef-157">但是，如果服務的呼叫頻率較低，Azure 可能會將它從記憶體中移除，並在 reinvoked 時要求冷啟動。</span><span class="sxs-lookup"><span data-stu-id="bcdef-157">But, if a service is called less frequently, Azure may remove it from memory and require a cold start when reinvoked.</span></span> <span data-ttu-id="bcdef-158">當函數向外延展至新的實例時，也需要冷啟動。</span><span class="sxs-lookup"><span data-stu-id="bcdef-158">Cold starts are also required when a function scales out to a new instance.</span></span>

<span data-ttu-id="bcdef-159">圖3-10 顯示冷啟動模式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-159">Figure 3-10 shows a cold-start pattern.</span></span> <span data-ttu-id="bcdef-160">請注意，應用程式冷時所需的額外步驟。</span><span class="sxs-lookup"><span data-stu-id="bcdef-160">Note the extra steps required when the app is cold.</span></span>

<span data-ttu-id="bcdef-161">![冷與暖開機](./media/cold-start-warm-start.png)
**圖 3-10**。</span><span class="sxs-lookup"><span data-stu-id="bcdef-161">![Cold versus warm start](./media/cold-start-warm-start.png)
**Figure 3-10**.</span></span> <span data-ttu-id="bcdef-162">冷啟動和暖開機。</span><span class="sxs-lookup"><span data-stu-id="bcdef-162">Cold start versus warm start.</span></span>

<span data-ttu-id="bcdef-163">若要避免冷啟動，您可以從取用[方案切換至專用方案](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)。</span><span class="sxs-lookup"><span data-stu-id="bcdef-163">To avoid cold starts entirely, you might switch from a [consumption plan to a dedicated plan](https://azure.microsoft.com/blog/understanding-serverless-cold-start/).</span></span> <span data-ttu-id="bcdef-164">您也可以使用 premium 方案升級來設定一個或多個[預先準備就緒的實例](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances)。</span><span class="sxs-lookup"><span data-stu-id="bcdef-164">You can also configure one or more [pre-warmed instances](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances) with the premium plan upgrade.</span></span> <span data-ttu-id="bcdef-165">在這些情況下，當您需要加入另一個實例時，它已經啟動並準備好了。</span><span class="sxs-lookup"><span data-stu-id="bcdef-165">In these cases, when you need to add another instance, it's already up and ready to go.</span></span> <span data-ttu-id="bcdef-166">這些選項可協助降低與無伺服器運算相關聯的冷啟動問題。</span><span class="sxs-lookup"><span data-stu-id="bcdef-166">These options can help mitigate the cold start issue associated with serverless computing.</span></span>

<span data-ttu-id="bcdef-167">雲端提供者會根據計算執行時間和耗用的記憶體，為無伺服器計費。</span><span class="sxs-lookup"><span data-stu-id="bcdef-167">Cloud providers bill for serverless based on compute execution time and consumed memory.</span></span> <span data-ttu-id="bcdef-168">長時間執行的作業或高記憶體耗用量工作負載不一定是無伺服器的最佳候選項目。</span><span class="sxs-lookup"><span data-stu-id="bcdef-168">Long running operations or high memory consumption workloads aren't always the best candidates for serverless.</span></span> <span data-ttu-id="bcdef-169">無伺服器函式偏好可快速完成的小型工作區塊。</span><span class="sxs-lookup"><span data-stu-id="bcdef-169">Serverless functions favor small chunks of work that can complete quickly.</span></span> <span data-ttu-id="bcdef-170">大部分的無伺服器平臺都需要在幾分鐘內完成個別的函式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-170">Most serverless platforms require individual functions to complete within a few minutes.</span></span> <span data-ttu-id="bcdef-171">Azure Functions 預設為5分鐘的超時期間，最多可設定10分鐘。</span><span class="sxs-lookup"><span data-stu-id="bcdef-171">Azure Functions defaults to a 5-minute time-out duration, which can be configured up to 10 minutes.</span></span> <span data-ttu-id="bcdef-172">Azure Functions premium 方案也可以緩和此問題，並將超時時間設定為30分鐘，而此限制可加以設定。</span><span class="sxs-lookup"><span data-stu-id="bcdef-172">The Azure Functions premium plan can mitigate this issue as well, defaulting time-outs to 30 minutes with an unbounded higher limit that can be configured.</span></span> <span data-ttu-id="bcdef-173">計算時間不是行事歷時間。</span><span class="sxs-lookup"><span data-stu-id="bcdef-173">Compute time isn't calendar time.</span></span> <span data-ttu-id="bcdef-174">使用[Azure Durable Functions 架構](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp)的更多先進函式可能會在數天的期間暫停執行。</span><span class="sxs-lookup"><span data-stu-id="bcdef-174">More advanced functions using the [Azure Durable Functions framework](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp) may pause execution over a course of several days.</span></span> <span data-ttu-id="bcdef-175">計費是以實際執行時間為基礎-當函式喚醒並繼續處理時。</span><span class="sxs-lookup"><span data-stu-id="bcdef-175">The billing is based on actual execution time - when the function wakes up and resumes processing.</span></span>

<span data-ttu-id="bcdef-176">最後，利用 Azure Functions 的應用程式工作會增加複雜度。</span><span class="sxs-lookup"><span data-stu-id="bcdef-176">Finally, leveraging Azure Functions for application tasks adds complexity.</span></span> <span data-ttu-id="bcdef-177">最好先使用模組化、鬆散結合的設計來架構您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="bcdef-177">It's wise to first architect your application with a modular, loosely coupled design.</span></span> <span data-ttu-id="bcdef-178">然後，找出無伺服器可提供的優點，以證明額外的複雜性。</span><span class="sxs-lookup"><span data-stu-id="bcdef-178">Then, identify if there are benefits serverless would offer that justify the additional complexity.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="bcdef-179">[上一頁](leverage-containers-orchestrators.md)
>[下一頁](combine-containers-serverless-approaches.md)</span><span class="sxs-lookup"><span data-stu-id="bcdef-179">[Previous](leverage-containers-orchestrators.md)
[Next](combine-containers-serverless-approaches.md)</span></span>
